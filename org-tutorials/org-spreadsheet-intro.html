<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-06-15 Tue 18:25 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Org as a spreadsheet system: a short introduction</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Worg people" />
<link rel="stylesheet" type="text/css" href="src/readtheorg_theme/css/htmlize.css"/>
 <link rel="stylesheet" type="text/css" href="src/readtheorg_theme/css/readtheorg.css"/>
 <script type="text/javascript" src="src/lib/js/jquery.min.js"></script>
 <script type="text/javascript" src="src/lib/js/bootstrap.min.js"></script>
 <script type="text/javascript" src="src/lib/js/jquery.stickytableheaders.min.js"></script>
 <script type="text/javascript" src="src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.cacheClassElem = elem.className;
         elem.cacheClassTarget = target.className;
         target.className = "code-highlighted";
         elem.className   = "code-highlighted";
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(elem.cacheClassElem)
         elem.className = elem.cacheClassElem;
       if(elem.cacheClassTarget)
         target.className = elem.cacheClassTarget;
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">Org as a spreadsheet system: a short introduction</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org0ba424a">Introduction</a></li>
<li><a href="#orgd63d4bc">Getting acquainted with references</a></li>
<li><a href="#orga7ad221">Your first formula</a></li>
<li><a href="#orgb17a7f5">Column formulas and field formulas</a></li>
<li><a href="#org53269bd">Interactively edit formulas</a></li>
<li><a href="#org6a674cf">Calc and Elisp formulas</a></li>
<li><a href="#org050202b">Debugging formulas</a></li>
<li><a href="#org0520fec">Much, much more&#x2026;</a></li>
<li><a href="#org703f6a2">Comments</a></li>
</ul>
</div>
</div>
<p>
<a href="../index.html">{Back to Worg&rsquo;s index}</a> &#x2013; <a href="org-tableur-tutoriel.html">{Ce tutoriel en <b>fran√ßais</b>}</a>
</p>

<div id="outline-container-org0ba424a" class="outline-2">
<h2 id="org0ba424a">Introduction</h2>
<div class="outline-text-2" id="text-org0ba424a">
<p>
This short tutorial will go through the basics that you need to know
if you want to use Org as a spreadsheet system.
</p>

<p>
Let&rsquo;s start with a this very simple table:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Student</th>
<th scope="col" class="org-right">Maths</th>
<th scope="col" class="org-right">Physics</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Bertrand</td>
<td class="org-right">13</td>
<td class="org-right">09</td>
</tr>

<tr>
<td class="org-left">Henri</td>
<td class="org-right">15</td>
<td class="org-right">14</td>
</tr>

<tr>
<td class="org-left">Arnold</td>
<td class="org-right">17</td>
<td class="org-right">13</td>
</tr>
</tbody>
</table>

<p>
Which is the output of this table in Org:
</p>

<pre class="example">
| Student  | Maths | Physics |
|----------+-------+---------|
| Bertrand |    13 |      09 |
| Henri    |    15 |      14 |
| Arnold   |    17 |      13 |
</pre>


<p>
The purpose of this tutorial is to understand how to get from this
simple table to this one, where we have the mean per student and per
discipline:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Student</th>
<th scope="col" class="org-right">Maths</th>
<th scope="col" class="org-right">Physics</th>
<th scope="col" class="org-right">Mean</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Bertrand</td>
<td class="org-right">13</td>
<td class="org-right">09</td>
<td class="org-right">11</td>
</tr>

<tr>
<td class="org-left">Henri</td>
<td class="org-right">15</td>
<td class="org-right">14</td>
<td class="org-right">14.5</td>
</tr>

<tr>
<td class="org-left">Arnold</td>
<td class="org-right">17</td>
<td class="org-right">13</td>
<td class="org-right">15</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Means</td>
<td class="org-right">15</td>
<td class="org-right">12</td>
<td class="org-right">13.5</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgd63d4bc" class="outline-2">
<h2 id="orgd63d4bc">Getting acquainted with references</h2>
<div class="outline-text-2" id="text-orgd63d4bc">
<p>
Let&rsquo;s start with the mean per student.
</p>

<pre class="example">
| Student  | Maths | Physics | Mean      |
|----------+-------+---------+-----------|
| Bertrand |    13 |      09 | [Formula] |
| Henri    |    15 |      14 |           |
| Arnold   |    17 |      13 |           |
</pre>


<p>
Before being able to insert a formula in <code>[Formula]</code>, you need to know
how to <b>refer</b> to a row, a column or a single field.
</p>

<p>
The easiest way to learn about references is to type <code>C-c ?</code> while you
are in a field.
</p>

<p>
For example, if you are in the <code>[Formula]</code> field, <code>C-c ?</code> will tell
you: <code>line @2, col $4, ref @2$4 or D2</code>, meaning that you are on the
second row (or line) of the fourth column, and the reference for this
field is either <code>@2$4</code> or <code>D2</code>.
</p>

<p>
At any moment, if you are lost in rows and columns, you can always
turn on the reference visualization grid with <code>C-c }</code>:
</p>


<div class="figure">
<p><img src="../images/bzg/reference_visualization.jpg" alt="reference_visualization.jpg" />
</p>
</div>
</div>
</div>

<div id="outline-container-orga7ad221" class="outline-2">
<h2 id="orga7ad221">Your first formula</h2>
<div class="outline-text-2" id="text-orga7ad221">
<p>
Put the cursor in the (empty) <code>[Formula]</code> field.  Now type
<code>:=vmean($2..$3)</code> in this field.  This formula means: calculate the
<i>mean</i> for fields from the second (<code>$2</code>) to the third (<code>$3</code>) field <i>in
this row</i>.  If you prefer to use the other notation, type
<code>:=vmean(B&amp;..C&amp;)</code> &#x2013; where the <code>&amp;</code> character stands for &ldquo;in this row&rdquo;,
which is implicit in the previous notation.
</p>

<p>
While still in the row, hit <code>C-c C-c</code> &#x2013; you should observe two
things: 1) the formula has been replaced by the result of the
calculation and 2) a new line starting with <code>#+TBLFM</code> has been
inserted at the bottom of the table.
</p>

<p>
The <code>#+TBLFM</code> line contains all the formulas for the table above, and
you should be careful while editing it manually.
</p>
</div>
</div>

<div id="outline-container-orgb17a7f5" class="outline-2">
<h2 id="orgb17a7f5">Column formulas and field formulas</h2>
<div class="outline-text-2" id="text-orgb17a7f5">
<p>
Ok, so now we have this table:
</p>

<pre class="example">
| Student  | Maths | Physics | Mean |
|----------+-------+---------+------|
| Bertrand |    13 |      09 |   11 |
| Henri    |    15 |      14 |      |
| Arnold   |    17 |      13 |      |
#+TBLFM: @2$4=vmean($2..$3)
</pre>


<p>
But what we really want is to compute the formulas for <i>all fields in
the column</i> named &ldquo;Mean&rdquo;.  In other words, we really want a <code>column
formula</code>, not a <code>field formula</code>.
</p>

<p>
To replace the formula with a column formula, go back to the field
where it has been defined and type <code>=vmean($2..$3)</code>.  Note that the
only difference with what you&rsquo;ve inserted previously is that the
formula is prefixed by <code>=</code> instead of <code>:=</code>.  When you&rsquo;re done, do a
<code>C-c C-c</code> in the field: you should be prompted whether you want to
replace the formula with a column formula, which is precisely what we
want.
</p>

<p>
Once you agree with this, the value in the field should be the same
than before (namely <code>11</code>) and you can now update all the fields in
this column by reapplying all formulas with <code>C-u C-c *</code> (or <code>C-c
C-c</code> if you&rsquo;re on the <code>#+TBLFM</code> line.)
</p>

<p>
So now we have this table:
</p>

<pre class="example">
| Student  | Maths | Physics | Mean |
|----------+-------+---------+------|
| Bertrand |    13 |      09 |   11 |
| Henri    |    15 |      14 | 14.5 |
| Arnold   |    17 |      13 |   15 |
#+TBLFM: $4=vmean($2..$3)
</pre>


<p>
As our single formula in <code>#+TBLFM</code> now applies to the entire column,
it doesn&rsquo;t contain any reference to a row.  The formula was previously
applied for the <code>@2$4</code> field, and it is now applied for the <code>$4</code>
column.
</p>

<p>
Finally, we can add the row for the means per discipline.  This row
contains two <i>field formulas</i>, each one calculating the mean for the
fields above in the same column:
</p>

<pre class="example">
| Student  | Maths | Physics | Mean |
|----------+-------+---------+------|
| Bertrand |    13 |      09 |   11 |
| Henri    |    15 |      14 | 14.5 |
| Arnold   |    17 |      13 |   15 |
|----------+-------+---------+------|
| Means    |    15 |      12 |      |
#+TBLFM: $4=vmean($2..$3)::@5$2=vmean(@2$2..@4$2)::@5$3=vmean(@2$3..@4$3)
</pre>


<p>
Which brings up this table:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Student</th>
<th scope="col" class="org-right">Maths</th>
<th scope="col" class="org-right">Physics</th>
<th scope="col" class="org-right">Mean</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Bertrand</td>
<td class="org-right">13</td>
<td class="org-right">09</td>
<td class="org-right">11</td>
</tr>

<tr>
<td class="org-left">Henri</td>
<td class="org-right">15</td>
<td class="org-right">14</td>
<td class="org-right">14.5</td>
</tr>

<tr>
<td class="org-left">Arnold</td>
<td class="org-right">17</td>
<td class="org-right">13</td>
<td class="org-right">15</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Means</td>
<td class="org-right">15</td>
<td class="org-right">12</td>
<td class="org-right">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org53269bd" class="outline-2">
<h2 id="org53269bd">Interactively edit formulas</h2>
<div class="outline-text-2" id="text-org53269bd">
<p>
For now we have been defining formulas by inserting them directly in
the table cells: typing <code>=</code> in a field starts the definition for a
column formula and typing <code>:=</code> starts a definition for a field
formula.  
</p>

<p>
If you prefer, you can edit formulas <i>in the minibuffer</i>: use <code>C-c =</code>
for editing column formulas or <code>C-u C-c =</code> for field formulas.
</p>

<p>
But you can also edit formulas more interactively in a dedicated
buffer by typing C-c &rsquo;.  This new buffer lists all the formulas for
the table at point and provides facilities to edit the references.
</p>

<p>
When the cursor is above a reference, the corresponding field in the
table get highlighted.  Nice!  But you can do more than that: you can
actually select the reference by using the <code>S-&lt;left/right/up/down&gt;</code>
keys.
</p>


<div class="figure">
<p><img src="../images/bzg/formulas_editor.jpg" alt="formulas_editor.jpg" />
</p>
</div>

<p>
Note: you might worry that moving a table&rsquo;s column with
<code>M-&lt;left/right&gt;</code> or a table&rsquo;s row with <code>M-&lt;up/down&gt;</code> might confuse the
references in the <code>#+TBLFM</code> line, but each move automagically updates
the references in this line.
</p>
</div>
</div>

<div id="outline-container-org6a674cf" class="outline-2">
<h2 id="org6a674cf">Calc and Elisp formulas</h2>
<div class="outline-text-2" id="text-org6a674cf">
<p>
The default syntax for formulas is the one of Calc, the GNU Emacs
package for doing computations.
</p>

<p>
Here is an excerpt from the <a href="http://www.delorie.com/gnu/docs/calc/calc_21.html">Calc manual</a> about algebraic-style
formulas:
</p>

<pre class="example">
Algebraic formulas use the operators `+', `-', `*', `/', and `^'. You
can use parentheses to make the order of evaluation clear. In the
absence of parentheses, `^' is evaluated first, then `*', then `/',
then finally `+' and `-'. For example, the expression

2 + 3*4*5 / 6*7^8 - 9

is equivalent to

2 + ((3*4*5) / (6*(7^8)) - 9
</pre>


<p>
In org tables, you can use references instead of values for performing
the computation.  Pretty simple.
</p>

<p>
But what if you want to use Emacs lisp code instead of Calc?  
</p>

<p>
Lets say for example that you want to associate each student with a
decimal of the Pi number, depending on their mean across maths and
physics.
</p>

<p>
For this you need to tell Org about the value you consider to be the
value of the Pi number.  You can do this by adding this line:
</p>

<pre class="example">
#+CONSTANTS: pi=3.14159265358979323846
</pre>


<p>
(Don&rsquo;t forget to hit <code>C-c C-c</code> on the <code>#+CONSTANTS</code> line so that
org-mode knows about it.)
</p>

<p>
Then you can define an Emacs lisp formula like this one:
</p>

<pre class="example">
$5='(substring (number-to-string $pi) (round $4) (1+ (round $4)));N
</pre>


<p>
Ahem.  Let&rsquo;s parse this: 
</p>

<ul class="org-ul">
<li><code>(substring S A B)</code>: get a substring of string <code>S</code> between <code>A</code> and
<code>B</code></li>
<li><code>(number-to-string $pi)</code>: convert the constant &ldquo;Pi&rdquo; into a string</li>
<li><code>(round $4)</code>: get the rounded value of the value in column <code>$4</code></li>
<li><code>;N</code>: consider the values of fields to be numeric values, not strings.</li>
</ul>

<p>
If the mean of a student is 10, this formula returns the tenth decimal
of Pi.
</p>
</div>
</div>

<div id="outline-container-org050202b" class="outline-2">
<h2 id="org050202b">Debugging formulas</h2>
<div class="outline-text-2" id="text-org050202b">
<p>
So now our table is this one:
</p>

<pre class="example">
| Student  | Maths | Physics | Mean | Pi number |
|----------+-------+---------+------+-----------|
| Bertrand |    13 |      09 |   11 |         5 |
| Henri    |    15 |      14 | 14.5 |         7 |
| Arnold   |    17 |      13 |   15 |         9 |
#+TBLFM: $4=vmean($2..$3)::$5='(substring (number-to-string $pi) (round $4) (1+ (round $4)));N
</pre>


<p>
If you come back to this table but feel a bit lazy trying to
understand what the Emacs Lisp function does, you might as well want
to <b>debug</b> the formula and follow the computation step by step.
</p>

<p>
Turn the formulas debugger on with <code>C-c {</code> and hit <code>C-c C-c</code> in a
field (or <code>C-u C-c *</code> anywhere on this table.)  This will perform the
computations of the formulas one by one, and display details about the
steps of the computation for each formula in a separate buffer.
</p>

<p>
Here is what such a buffer looks like:
</p>

<pre class="example">
Substitution history of formula
Orig:   '(substring (number-to-string $pi) (round $4) (1+ (round $4)));N
$xyz-&gt;  '(substring (number-to-string 3.14159265358979323846) (round $4) (1+ (round $4)))
@r$c-&gt;  '(substring (number-to-string 3.14159265358979323846) (round $4) (1+ (round $4)))
$1-&gt;    '(substring (number-to-string 3.14159265358979323846) (round 11) (1+ (round 11)))
Result: 5
Format: NONE
Final:  5
</pre>


<p>
Once you&rsquo;re done checking the formulas, you can switch the debugger
off by hitting <code>C-c {</code> again.
</p>
</div>
</div>

<div id="outline-container-org0520fec" class="outline-2">
<h2 id="org0520fec">Much, much more&#x2026;</h2>
<div class="outline-text-2" id="text-org0520fec">
<p>
Using Org as a spreadsheet system turns to be really handy.
</p>

<p>
But you can do a lot more than that!  You can use relative references,
define names for columns and parameters for formulas, define fields that
should be automatically recalculated, etc.  You can also use Emacs lisp in
formulas (<a href="org-spreadsheet-lisp-formulas.html">read this tutorial</a>).
</p>

<p>
Have a look to the <a href="https://orgmode.org/org.html#Advanced-features">advanced features</a> in Org-mode manual, it will give you a
quick overlook on this&#x2026;
</p>
</div>
</div>















<div id="outline-container-org703f6a2" class="outline-2">
<h2 id="org703f6a2">Comments</h2>
<div class="outline-text-2" id="text-org703f6a2">
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'worg'; // required: replace example with your forum shortname
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Worg people</p>
<p class="date">Created: 2021-06-15 Tue 18:25</p>
</div>
</body>
</html>
