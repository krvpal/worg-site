<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
<head>
<!-- 2021-06-15 Tue 18:25 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Utiliser Org comme tableur: une courte introduction</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Worg" />
<link rel="stylesheet" type="text/css" href="src/readtheorg_theme/css/htmlize.css"/>
 <link rel="stylesheet" type="text/css" href="src/readtheorg_theme/css/readtheorg.css"/>
 <script type="text/javascript" src="src/lib/js/jquery.min.js"></script>
 <script type="text/javascript" src="src/lib/js/bootstrap.min.js"></script>
 <script type="text/javascript" src="src/lib/js/jquery.stickytableheaders.min.js"></script>
 <script type="text/javascript" src="src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.cacheClassElem = elem.className;
         elem.cacheClassTarget = target.className;
         target.className = "code-highlighted";
         elem.className   = "code-highlighted";
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(elem.cacheClassElem)
         elem.className = elem.cacheClassElem;
       if(elem.cacheClassTarget)
         target.className = elem.cacheClassTarget;
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">Utiliser Org comme tableur: une courte introduction</h1>
<div id="table-of-contents">
<h2>Table des matières</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org9d12479">Introduction</a></li>
<li><a href="#org4a019e5">Se familiariser avec les références</a></li>
<li><a href="#orge147404">Votre première formule</a></li>
<li><a href="#orge435d56">Formules pour les colonnes et pour les champs</a></li>
<li><a href="#orgbaaeb6a">Éditer des formules de manière interactive</a></li>
<li><a href="#org2551bad">Calc et les formules Elisp</a></li>
<li><a href="#org1c12462">Déboguer les formules</a></li>
<li><a href="#org558ba44">Et beaucoup, beaucoup plus&#x2026;</a></li>
</ul>
</div>
</div>
<p>
<a href="../index.html">{Retour à l&rsquo;index de Worg}</a> &#x2013; <a href="org-spreadsheet-intro.html">{This tutorial in <b>english</b>}</a>
</p>

<div id="outline-container-org9d12479" class="outline-2">
<h2 id="org9d12479">Introduction</h2>
<div class="outline-text-2" id="text-org9d12479">
<p>
Ce court tutorial expose les connaissances de base à acquérir pour utiliser
Org comme tableur.
</p>

<p>
Démarrons avec un tableau très simple :
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Étudiant</th>
<th scope="col" class="org-right">Maths</th>
<th scope="col" class="org-right">Physique</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Bertrand</td>
<td class="org-right">13</td>
<td class="org-right">09</td>
</tr>

<tr>
<td class="org-left">Henri</td>
<td class="org-right">15</td>
<td class="org-right">14</td>
</tr>

<tr>
<td class="org-left">Arnold</td>
<td class="org-right">17</td>
<td class="org-right">13</td>
</tr>
</tbody>
</table>

<p>
Au format Org, ce tableau s&rsquo;écrit ainsi :
</p>

<pre class="example">
| Student  | Maths | Physics |
|----------+-------+---------|
| Bertrand |    13 |      09 |
| Henri    |    15 |      14 |
| Arnold   |    17 |      13 |
</pre>


<p>
Le but de ce tutoriel est de comprendre comment aller de ce simple tableau 
à celui-ci, où nous calculons les moyennes par étudiant et par discipline:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Étudiant</th>
<th scope="col" class="org-right">Maths</th>
<th scope="col" class="org-right">Physique</th>
<th scope="col" class="org-right">Moyenne</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Bertrand</td>
<td class="org-right">13</td>
<td class="org-right">09</td>
<td class="org-right">11</td>
</tr>

<tr>
<td class="org-left">Henri</td>
<td class="org-right">15</td>
<td class="org-right">14</td>
<td class="org-right">14.5</td>
</tr>

<tr>
<td class="org-left">Arnold</td>
<td class="org-right">17</td>
<td class="org-right">13</td>
<td class="org-right">15</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Moyennes</td>
<td class="org-right">15</td>
<td class="org-right">12</td>
<td class="org-right">13.5</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org4a019e5" class="outline-2">
<h2 id="org4a019e5">Se familiariser avec les références</h2>
<div class="outline-text-2" id="text-org4a019e5">
<p>
Commençons par la moyenne de chaque étudiants.
</p>

<pre class="example">
| Étudiant | Maths | Physique | Moyenne   |
|----------+-------+----------+-----------|
| Bertrand |    13 |       09 | [Formule] |
| Henri    |    15 |       14 |           |
| Arnold   |    17 |       13 |           |
</pre>


<p>
Avant de pouvoir insérer une formule dans <code>[Formule]</code>, vous devez savoir
comment vous <b>référer</b> à une rangée, une colonne ou à une cellule.
</p>

<p>
La manière la plus simple d&rsquo;apprendre la façon dont fonctionne les
références est de taper <code>C-c ?</code> quand vous êtes dans une cellule.
</p>

<p>
Par exemple, si vous êtes dans la cellule contenant <code>[Formule]</code>, <code>C-c ?</code>
vous indiquera <code>line @2, col $4, ref @2$4 or D2</code>, ce qui signifie que vous
êtes dans la seconde rangée (ou ligne) de la quatrième colonne, et la
référence à cette cellule est soit <code>@2$4</code> soit <code>D2</code>.
</p>

<p>
À tout moment, si vous êtes perdu dans les rangées et les colonnes, vous
pouvez toujours activer une grille de visualisation des références avec le
raccourci <code>C-c }</code>:
</p>


<div class="figure">
<p><img src="../images/bzg/reference_visualization.jpg" alt="reference_visualization.jpg" />
</p>
</div>
</div>
</div>

<div id="outline-container-orge147404" class="outline-2">
<h2 id="orge147404">Votre première formule</h2>
<div class="outline-text-2" id="text-orge147404">
<p>
Placez le curseur dans le champ (vide) <code>[Formule]</code>.  Maintenant tapez
<code>:=vmean($2..$3)</code> dans ce champ.  Cette formule signifie: calculer la
moyenne (<i>mean</i> en anglais) pour les champs compris entre la deuxième
cellule (<code>$2</code>) et la troisième cellule (<code>$3</code>) <i>dans cette rangée</i>.  Si vous
préférez utiliser une autre notation, tapez <code>:=vmean(B&amp;..C&amp;)</code> &#x2013; dans ce
cas, le caractère <code>&amp;</code> signifie &laquo;&nbsp;dans cette rangée&nbsp;&raquo;, ce qui est implicite
dans la notation précédente.
</p>

<p>
Toujours dans cette rangée, tapez <code>C-c C-c</code> - vous devriez observer deux
choses : 1) la formule est remplacée par le résultat du calcul et 2) une
nouvelle ligne commençant par <code>#+TBLFM</code> est insérée en bas du tableau.
</p>

<p>
La ligne <code>#+TBLFM</code> contient toutes les formules pour la table située
au-dessus &#x2013; faites attention avant d&rsquo;éditer cette ligne manuellement.
</p>
</div>
</div>

<div id="outline-container-orge435d56" class="outline-2">
<h2 id="orge435d56">Formules pour les colonnes et pour les champs</h2>
<div class="outline-text-2" id="text-orge435d56">
<p>
Donc, nous avons désormais ce tableau :
</p>

<pre class="example">
| Étudiant | Maths | Physique | Moyenne |
|----------+-------+----------+---------|
| Bertrand |    13 |       09 |      11 |
| Henri    |    15 |       14 |         |
| Arnold   |    17 |       13 |         |
#+TBLFM: @2$4=vmean($2..$3)
</pre>


<p>
Mais ce que nous voulons vraiment, c&rsquo;est calculer les formules pour <i>tous
les champs de la colonne</i> &laquo;&nbsp;Moyenne&nbsp;&raquo;.  En d&rsquo;autres termes, nous voulons en
fait une <code>formule de colonne</code> (<i>column formula</i>), pas seulement
une <code>formule de champ</code> (<i>field formula</i>.)
</p>

<p>
Pour remplacer la formule avec une formule de colonne, retournez dans le
champ où cette formule a été définie et tapez <code>=vmean($2..$3)</code>.  Notez que
la seule différence avec ce que nous avons inséré plus haut est que cette
formule est préfixée par <code>=</code> au lieu de <code>:=</code>.  Quand c&rsquo;est fait, faites un
<code>C-c C-c</code> dans le champ : on vous demandera si vous voulez remplacer la
formule avec une formule de colonne, ce qui est précisément ce que nous
voulons.
</p>

<p>
Une fois que vous répondez « yes », la valeur dans le champ devrait être la
même qu&rsquo;auparavant (à savoir <code>11</code>) et vous pouvez désormais mettre à jour
tous les champs de cette colonne en réappliquant toutes les formules avec
<code>C-u C-c *</code> (ou <code>C-c C-c</code> si vous êtes sur la ligne <code>#+TBLFM</code>.)
</p>

<p>
Donc nous avons maintenant ce tableau :
</p>

<pre class="example">
| étudiant | Maths | Physique | Moyenne |
|----------+-------+----------+---------|
| Bertrand |    13 |       09 |      11 |
| Henri    |    15 |       14 |    14.5 |
| Arnold   |    17 |       13 |      15 |
#+TBLFM: $4=vmean($2..$3)
</pre>


<p>
Comme l&rsquo;unique formule de la ligne <code>#+TBLFM</code> s&rsquo;applique désormais à toute
la colonne, elle ne contient aucune référence à une rangée.  Avant, la
formule était appliquée au champ <code>@2$4</code>, elle est maintenant appliquée
pour toute la quatrième colonne.
</p>

<p>
Pour finir, nous pouvons ajouter la rangée pour les moyennes par
discipline.  Cette rangée contient deux <i>formules de cellue</i>, chacune
calculant la moyenne pour le champ situé au-dessus dans la même colonne :
</p>

<pre class="example">
| Étudiant | Maths | Physique | Moyenne |
|----------+-------+----------+---------|
| Bertrand |    13 |       09 |      11 |
| Henri    |    15 |       14 |    14.5 |
| Arnold   |    17 |       13 |      15 |
|----------+-------+----------+---------|
| Moyennes |    15 |       12 |         |
#+TBLFM: $4=vmean($2..$3)::@5$2=vmean(@2$2..@4$2)::@5$3=vmean(@2$3..@4$3)
</pre>


<p>
Ce qui produit ce tableau :
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Étudiant</th>
<th scope="col" class="org-right">Maths</th>
<th scope="col" class="org-right">Physique</th>
<th scope="col" class="org-right">Moyenne</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Bertrand</td>
<td class="org-right">13</td>
<td class="org-right">09</td>
<td class="org-right">11</td>
</tr>

<tr>
<td class="org-left">Henri</td>
<td class="org-right">15</td>
<td class="org-right">14</td>
<td class="org-right">14.5</td>
</tr>

<tr>
<td class="org-left">Arnold</td>
<td class="org-right">17</td>
<td class="org-right">13</td>
<td class="org-right">15</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Moyennes</td>
<td class="org-right">15</td>
<td class="org-right">12</td>
<td class="org-right">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgbaaeb6a" class="outline-2">
<h2 id="orgbaaeb6a">Éditer des formules de manière interactive</h2>
<div class="outline-text-2" id="text-orgbaaeb6a">
<p>
Pour l&rsquo;instant nous avons défini les formules en les insérant directement
dans les cellules du tableau : taper <code>=</code> dans une cellule lance la
définition pour formule de colonne, et taper <code>:=</code> lance la définition pour
une formule de cellule.
</p>

<p>
Si vous préférez, vous pouvez éditer les formules dans le <i>minibuffer</i>:
utilisez <code>C-c =</code> pour éditer les formules de colonne et <code>C-u C-c =</code> pour
éditer les formules de cellule.
</p>

<p>
Mais vous pouvez aussi éditer les formules de manière plus interactive dans
un buffer dédié en tapant C-c &rsquo;.  Le nouveau buffer liste toutes les
formules du tableau et facilite l&rsquo;édition des références.
</p>

<p>
Quand le curseur est sur une référence, les champs correspondant du tableau
sont surlignés.  Sympa!  Mais vous pouvez faire encore plus : vous pouvez
en fait choisir la référence en utilisant les touches
<code>S-&lt;left/right/up/down&gt;</code> (shift + les touches du curseur).
</p>


<div class="figure">
<p><img src="../images/bzg/formulas_editor.jpg" alt="formulas_editor.jpg" />
</p>
</div>

<p>
Note : vous pouvez avoir peur que de déplacer une colonne avec
<code>M-&lt;left/right&gt;</code> ou bien une rangée du tableau avec <code>M-&lt;up/down&gt;</code> perturbe
les références de la ligne <code>#+TBLFM</code>, mais chaque movement met à jour
automagiquement les références de la ligne <code>#+TBLFM</code>.
</p>
</div>
</div>

<div id="outline-container-org2551bad" class="outline-2">
<h2 id="org2551bad">Calc et les formules Elisp</h2>
<div class="outline-text-2" id="text-org2551bad">
<p>
La syntaxe par défaut pour les formules est celle de Calc, la librairie de
GNU Emacs pour faire des calculs.
</p>

<p>
Voici un extrait du <a href="http://www.delorie.com/gnu/docs/calc/calc_21.html">manuel de Calc</a> au sujet des formules algébriques :
</p>

<pre class="example">
Les formules algébriques utilise les opérateurs `+', `-', `*', `/', 
and `^'.  Vous pouvez utiliser les parenthèses pour clarifier l'ordre
d'évaluation.  En l'absence de parenthèses, `^' est évalué en premier,
puis `*', puis `/', et enfin `+' et `-'.  Par exemple, l'expression

2 + 3*4*5 / 6*7^8 - 9

est equivalente à

2 + ((3*4*5) / (6*(7^8)) - 9
</pre>


<p>
Dans les tableau org, vous pouvez utiliser des références à la place des
valeurs pour faire des calculs.  Simple comme bonjour.
</p>

<p>
Mais quid de l&rsquo;utilisation de formules en Emacs lisp au lieu de Calc ?
</p>

<p>
Disons par exemple que vous voulez associer à chaque étudiant une décimal
du nombre Pi, en fonction de la moyenne de leurs notes en maths et en
physiques.
</p>

<p>
Pour cela vous aurez besoin de dire à Org quelle est la valeur que vous
prendrez comme valeur de Pi.  Vous pouvez le faire en ajoutant cette ligne.
</p>

<pre class="example">
#+CONSTANTS: pi=3.14159265358979323846
</pre>


<p>
(N&rsquo;oubliez pas de taper <code>C-c C-c</code> sur la ligne <code>#+CONSTANTS</code> de façon à ce
qu&rsquo;Org soit la prenne en compte.)
</p>

<p>
Ensuite vous pouvez définir une formule Emacs lisp telle que celle-ci :
</p>

<pre class="example">
$5='(substring (number-to-string $pi) (round $4) (1+ (round $4)));N
</pre>


<p>
Hum.  Voyons ce que ça veut dire.
</p>

<ul class="org-ul">
<li><code>(substring S A B)</code>: prendre une sous-chaîne de caractères entre les
positions <code>A</code> et <code>B</code> de la chaîne <code>S</code>.</li>
<li><code>(number-to-string $pi)</code>: convertir la constante &laquo;&nbsp;Pi&nbsp;&raquo; en chaîne de
caractères.</li>
<li><code>(round $4)</code>: prendre la valeur arrondie de la valeur de la colonne <code>$4</code>.</li>
<li><code>;N</code>: considérer que les valeurs dans les champs sont des nombres et non
des chaînes de caractères.</li>
</ul>

<p>
Si la moyenne d&rsquo;un étudiant est de 10, cette formule renvoie la 10ème
décimale de Pi.
</p>
</div>
</div>

<div id="outline-container-org1c12462" class="outline-2">
<h2 id="org1c12462">Déboguer les formules</h2>
<div class="outline-text-2" id="text-org1c12462">
<p>
Donc votre tableau ressemble désormais à ceci :
</p>

<pre class="example">
| Étudiant  | Maths | Physique | Moyenne | Pi  |
|----------+-------+---------+------+-----------|
| Bertrand |    13 |      09 |   11 |         5 |
| Henri    |    15 |      14 | 14.5 |         7 |
| Arnold   |    17 |      13 |   15 |         9 |
#+TBLFM: $4=vmean($2..$3)::$5='(substring (number-to-string $pi) (round $4) (1+ (round $4)));N
</pre>


<p>
Si vous revenez à ce tableau mais que vous avez la flemme de comprendre ce
que fait la function en Emacs lisp, vous pouvez aussi bien <b>déboguer</b> la
formule et suivre les étapes du calcul une par une.
</p>

<p>
Activez le débogueur de formules avec <code>C-c {</code> et tapez <code>C-c C-c</code> dans un
champ (ou <code>C-u C-c *</code> n&rsquo;importe où dans cette table.)  Ceci lancera le
calcul de la formule étape par étape, et affichera des détails sur les
différentes étapes de toutes les formules dans un buffer distinct.
</p>

<p>
Voici ce à quoi ressemble un tel buffer :
</p>

<pre class="example">
Substitution history of formula
Orig:   '(substring (number-to-string $pi) (round $4) (1+ (round $4)));N
$xyz-&gt;  '(substring (number-to-string 3.14159265358979323846) (round $4) (1+ (round $4)))
@r$c-&gt;  '(substring (number-to-string 3.14159265358979323846) (round $4) (1+ (round $4)))
$1-&gt;    '(substring (number-to-string 3.14159265358979323846) (round 11) (1+ (round 11)))
Result: 5
Format: NONE
Final:  5
</pre>


<p>
Une fois que vous avez fini de vérifier les formules, vous pouvez
désactiver le débogueur en tapant de nouveau <code>C-c {</code>.
</p>
</div>
</div>

<div id="outline-container-org558ba44" class="outline-2">
<h2 id="org558ba44">Et beaucoup, beaucoup plus&#x2026;</h2>
<div class="outline-text-2" id="text-org558ba44">
<p>
Utiliser Org comme système pour des calculs sur des tableau est vraiment
très pratique.
</p>

<p>
Mais vous pouvez faire bien plus que tout ce qui a été présenté !  Utiliser
des références relatives, définir des noms pour les colonnes et des
paramètres pour les formules, définir des champs qui doivent être
automatiquement recalculés, etc.  Pour plus de détails sur l&rsquo;utilisation
d&rsquo;Emacs lisp dans les formules, reportez vous à <a href="org-spreadsheet-lisp-formulas.html">ce tutoriel (en anglais)</a>.
</p>

<p>
Allez voir du côté des <a href="https://orgmode.org/org.html#Advanced-features">fonctionnalités avancées</a> dans le manuel d&rsquo;Org-mode,
cela vous donnera un rapide aperçu&#x2026;
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Auteur: Worg</p>
<p class="date">Created: 2021-06-15 Tue 18:25</p>
</div>
</body>
</html>
