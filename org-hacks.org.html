<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.56 in css mode. -->
<html>
  <head>
    <title>org-hacks.org</title>
    <style type="text/css">
    <!--
      body {
        color: #d6d6d4;
        background-color: #161719;
      }
      .bold {
        /* bold */
        font-weight: bold;
      }
      .builtin {
        /* font-lock-builtin-face */
        color: #fd971f;
      }
      .comment {
        /* font-lock-comment-face */
        color: #696969;
      }
      .comment-delimiter {
        /* font-lock-comment-delimiter-face */
        color: #696969;
      }
      .constant {
        /* font-lock-constant-face */
        color: #fd971f;
      }
      .custom {
      }
      .doc {
        /* font-lock-doc-face */
        color: #7f7f80;
      }
      .font-latex-sedate {
        /* font-latex-sedate-face */
        color: #d3d3d3;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b6e63e;
      }
      .highlight-numbers-number {
        /* highlight-numbers-number */
        color: #9c91e4;
        font-weight: bold;
      }
      .highlight-quoted-quote {
        /* highlight-quoted-quote */
        color: #9c91e4;
      }
      .highlight-quoted-symbol {
        /* highlight-quoted-symbol */
        color: #66d9ef;
      }
      .italic {
        /* italic */
        font-style: italic;
      }
      .kc-org-link-url {
        /* kc-org-link-url */
        color: #d02090;
        text-decoration: underline;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #eb4509;
      }
      .negation-char {
        /* font-lock-negation-char-face */
        color: #9c91e4;
        font-weight: bold;
      }
      .org-block {
        /* org-block */
        background-color: #000000;
      }
      .org-block-begin-line {
        /* org-block-begin-line */
        color: #696969;
      }
      .org-block-end-line {
        /* org-block-end-line */
        color: #696969;
      }
      .org-checkbox-statistics-todo {
        /* org-checkbox-statistics-todo */
        color: #e2c770;
        font-weight: bold;
      }
      .org-code {
        /* org-code */
        color: #dfd05e;
      }
      .org-date {
        /* org-date */
        color: #a020f0;
      }
      .org-document-info {
        /* org-document-info */
        color: #fd971f;
      }
      .org-document-info-keyword {
        /* org-document-info-keyword */
        color: #555556;
      }
      .org-document-title {
        /* org-document-title */
        color: #fd971f;
        font-weight: bold;
      }
      .org-drawer {
        /* org-drawer */
        color: #cd3278;
      }
      .org-formula {
        /* org-formula */
        color: #66d9ef;
      }
      .org-hide {
        /* org-hide */
        color: #161719;
      }
      .org-level-1 {
        /* org-level-1 */
        color: #eb4509;
        font-weight: bold;
      }
      .org-level-2 {
        /* org-level-2 */
        color: #f0b144;
        font-weight: bold;
      }
      .org-level-3 {
        /* org-level-3 */
        color: #8ec298;
        font-weight: bold;
      }
      .org-level-4 {
        /* org-level-4 */
        color: #5ca8dd;
        font-weight: bold;
      }
      .org-level-5 {
        /* org-level-5 */
        color: #f4a284;
        font-weight: bold;
      }
      .org-level-6 {
        /* org-level-6 */
        color: #9c91e4;
        font-weight: bold;
      }
      .org-link {
        /* org-link */
        color: #fd971f;
        font-weight: bold;
        text-decoration: underline;
      }
      .org-list-dt {
        /* org-list-dt */
        color: #e2c770;
      }
      .org-meta-line {
        /* org-meta-line */
        color: #7f7f80;
      }
      .org-property-value {
        /* org-property-value */
        color: #7f7f80;
      }
      .org-quote {
        /* org-quote */
        color: #cfc0c5;
        background-color: #212224;
        font-style: italic;
      }
      .org-sexp-date {
        /* org-sexp-date */
        color: #d6d6d4;
      }
      .org-special-keyword {
        /* org-special-keyword */
        color: #7f7f80;
      }
      .org-superstar-header-bullet {
      }
      .org-table {
        /* org-table */
        color: #9c91e4;
      }
      .org-tag {
        /* org-tag */
        color: #e2c770;
      }
      .org-verbatim {
        /* org-verbatim */
        color: #b6e63e;
      }
      .preprocessor {
        /* font-lock-preprocessor-face */
        color: #9c91e4;
        font-weight: bold;
      }
      .rainbow-delimiters-depth-1 {
        /* rainbow-delimiters-depth-1-face */
        color: #eb4509;
      }
      .rainbow-delimiters-depth-2 {
        /* rainbow-delimiters-depth-2-face */
        color: #fd971f;
      }
      .rainbow-delimiters-depth-3 {
        /* rainbow-delimiters-depth-3-face */
        color: #b6e63e;
      }
      .regexp-grouping-backslash {
        /* font-lock-regexp-grouping-backslash */
        color: #9c91e4;
        font-weight: bold;
      }
      .regexp-grouping-construct {
        /* font-lock-regexp-grouping-construct */
        color: #9c91e4;
        font-weight: bold;
      }
      .string {
        /* font-lock-string-face */
        color: #e2c770;
      }
      .type {
        /* font-lock-type-face */
        color: #66d9ef;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #fd971f;
      }
      .warning {
        /* warning */
        color: #e2c770;
      }
      .warning-1 {
        /* font-lock-warning-face */
        color: #e2c770;
      }
      .whitespace-tab {
        /* whitespace-tab */
        color: #4e4e4e;
        background-color: #2d2e2e;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
<span class="org-document-info-keyword">#+TITLE:</span>      <span class="org-document-title">Org ad hoc code, quick hacks and workarounds
</span><span class="org-document-info-keyword">#+AUTHOR:</span>     <span class="org-document-info">Worg people
</span><span class="org-document-info-keyword">#+EMAIL:</span>      <span class="org-document-info">mdl AT imapmail DOT org
</span><span class="org-meta-line">#+OPTIONS:    H:3 num:nil toc:t \n:nil ::t |:t ^:t -:t f:t *:t tex:t d:(HIDE) tags:not-in-toc</span>
<span class="org-meta-line">#+STARTUP:    align fold nodlcheck hidestars oddeven lognotestate</span>
<span class="org-meta-line">#+SEQ_TODO:   TODO(t) INPROGRESS(i) WAITING(w@) | DONE(d) CANCELED(c@)</span>
<span class="org-meta-line">#+TAGS:       Write(w) Update(u) Fix(f) Check(c)</span>
<span class="org-meta-line">#+LANGUAGE:   en</span>
<span class="org-meta-line">#+PRIORITIES: A C B</span>
<span class="org-meta-line">#+CATEGORY:   worg</span>
<span class="org-meta-line">#+HTML_LINK_UP:    index.html</span>
<span class="org-meta-line">#+HTML_LINK_HOME:  <a href="https://orgmode.org/worg/">https://orgmode.org/worg/</a></span>

<span class="comment"># This file is released by its authors and contributors under the GNU</span>
<span class="comment"># Free Documentation license v1.3 or later, code examples are released</span>
<span class="comment"># under the GNU General Public License v3 or later.</span>

<span class="comment"># This file is the default header for new Org files in Worg.  Feel free</span>
<span class="comment"># to tailor it to your needs.</span>

This page is for ad hoc bits of code. Feel free to add quick hacks and
workaround. Go crazy.

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Hacking Org: Working within Org-mode
</span><span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Org Agenda
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Colorize clocking tasks with a block
</span><span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:DIR:</span>      <span class="org-property-value"><span class="italic">home/stardiviner/Code/Emacs/worg/images/agenda</span></span>
<span class="org-drawer">:END:</span>

Show Org Agenda tasks with heigh spacing based on clock time with <span class="org-code">org-agenda-log-mode</span>.

<span class="org-link"><a href="file:images/agenda/org-agenda-colorized-blocks.png">file:images/agenda/org-agenda-colorized-blocks.png</a></span>

Here is original author's post <span class="kc-org-link-url"><a href="https://emacs-china.org/t/org-agenda/8679">https://emacs-china.org/t/org-agenda/8679</a></span>.

Here is a hook function to use archive this effect:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">work with org-agenda dispatcher [c] "Today Clocked Tasks" to view today's clocked tasks.
</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-agenda-log-mode-colorize-block</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Set different line spacing based on clock time duration."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">colors </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">cl-case</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">alist-get</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">background-mode</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">frame-parameters</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="whitespace-tab">                </span><span class="org-block">                 </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">light</span></span><span class="org-block">
</span><span class="whitespace-tab">                </span><span class="org-block">                  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">list</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"#F6B1C3"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"#FFFF9D"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"#BEEB9F"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"#ADD5F7"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="whitespace-tab">                </span><span class="org-block">                 </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">dark</span></span><span class="org-block">
</span><span class="whitespace-tab">                </span><span class="org-block">                  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">list</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"#aa557f"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"DarkGreen"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"DarkSlateGray"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"DarkSlateBlue"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
           pos
           duration</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">nconc</span></span><span class="org-block"> colors colors</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">point-min</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">while</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> pos </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">next-single-property-change</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">duration</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> pos</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">not</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">equal</span></span><span class="org-block"> pos </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point-at-eol</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                   </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> duration </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-get-at-bol</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">duration</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">larger duration bar height
</span></span><span class="org-block">          </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">line-height </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">&lt;</span></span><span class="org-block"> duration </span><span class="org-block"><span class="highlight-numbers-number">15</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1.0</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">+</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0.5</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">/</span></span><span class="org-block"> duration </span><span class="org-block"><span class="highlight-numbers-number">30</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">ov </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">make-overlay</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point-at-bol</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">1+</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">point-at-eol</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">overlay-put</span></span><span class="org-block"> ov </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">face</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">`</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="builtin">:background</span></span><span class="org-block"> ,</span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> colors</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:foreground</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"black"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> colors </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> colors</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">overlay-put</span></span><span class="org-block"> ov </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">line-height</span></span><span class="org-block"> line-height</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">overlay-put</span></span><span class="org-block"> ov </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">line-spacing</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">1-</span></span><span class="org-block"> line-height</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">org-agenda-finalize-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote"><span class="org-tag">#'</span></span></span><span class="org-block"><span class="highlight-quoted-symbol"><span class="org-tag">org-agenda-log-mode-colorize-block</span></span></span><span class="org-block"><span class="rainbow-delimiters-depth-1"><span class="org-tag">)</span></span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Picking up a random task in the global TODO list
</span>
Tony day <span class="kc-org-link-url"><a href="http://mid.gmane.org/m2zk19l1me.fsf@gmail.com">shared</a></span> <span class="kc-org-link-url"><a href="https://gist.github.com/4343164">this gist</a></span> to pick up a
random task.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Building and Managing Org
</span><span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Generating autoloads and Compiling Org without make
</span>    <span class="org-drawer">:PROPERTIES:</span>
    <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">compiling-org-without-make</span>
    <span class="org-drawer">:END:</span>

<span class="org-meta-line">#+index: Compilation!without make</span>

  Compilation is optional, but you <span class="bold">must</span> update the autoloads file
  each time you update org, even when you run org uncompiled!

  Starting with Org 7.9 you'll find functions for creating the
  autoload files and do byte-compilation in <span class="org-verbatim">mk/org-fixup.el</span>.  When
  you execute the commands below, your current directory must be where
  org has been unpacked into, in other words the file <span class="org-verbatim">README</span> should
  be found in your current directory and the directories <span class="org-verbatim">lisp</span> and
  <span class="org-verbatim">etc</span> should be subdirectories of it.  The command <span class="org-verbatim">emacs</span> should be
  found in your <span class="org-verbatim">PATH</span> and start the Emacs version you are using.  To
  make just the autoloads file do:
  <span class="org-code">: emacs -batch -Q -L lisp -l ../mk/org-fixup -f org-make-autoloads
</span>  To make the autoloads file and byte-compile org:
  <span class="org-code">: emacs -batch -Q -L lisp -l ../mk/org-fixup -f org-make-autoloads-compile
</span>  To make the autoloads file and byte-compile all of org again:
  <span class="org-code">: emacs -batch -Q -L lisp -l ../mk/org-fixup -f org-make-autoloads-compile-force
</span>  If you are not using Git, you'll have to make fake version strings
  first if <span class="org-verbatim">org-version.el</span> is not already available (if it is, you
  could also edit the version strings there).
  <span class="org-code">: emacs -batch -Q -L lisp -l ../mk/org-fixup \
</span>  <span class="org-code">: --eval '(let ((org-fake-release "7.9.1")(org-fake-git-version "7.9.1-fake"))\
</span>  <span class="org-code">: (org-make-autoloads))'
</span>  The above assumes a
  POSIX shell for its quoting.  Windows <span class="org-verbatim">CMD.exe</span> has quite different
  quoting rules and this won't work, so your other option is to start
  Emacs like this
  <span class="org-code">: emacs -Q -L lisp -l ../mk/org-fixup
</span>  then paste the following into the <span class="org-verbatim">*scratch*</span> buffer
<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">org-fake-release     </span><span class="org-block"><span class="string">"7.9.1"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">org-fake-git-version </span><span class="org-block"><span class="string">"7.9.1-fake"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">org-make-autoloads</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>  position the cursor after the closing paren and press <span class="org-verbatim">C-j</span> or <span class="org-verbatim">C-x
  C-e</span> to evaluate the form.  Of course you can replace
  <span class="org-verbatim">org-make-autoloads</span> with <span class="org-verbatim">org-make-autoloads-compile</span> or even
  <span class="org-verbatim">org-make-autoloads-compile-force</span> if you wish with both variants.

  For <span class="bold">older org versions only</span> (that do not yet have
  <span class="org-verbatim">mk/org-fixup.el</span>), you can use the definitions below.  To use
  this function, adjust the variables <span class="org-verbatim">my/org-lisp-directory</span> and
  <span class="org-verbatim">my/org-compile-sources</span> to suit your needs.  If you have
  byte-compiled org, but want to run org uncompiled again, just remove
  all <span class="org-verbatim">*.elc</span> files in the <span class="org-verbatim">lisp/</span> directory, set
  <span class="org-verbatim">my/org-compile-sources</span> to <span class="org-verbatim">nil</span>.

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">my/org-lisp-directory</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"~/.emacs.d/org/lisp/"</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Directory where your org-mode files live."</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">my/org-compile-sources</span></span><span class="org-block"> t
    </span><span class="org-block"><span class="doc">"If `</span></span><span class="org-block"><span class="doc"><span class="constant">nil</span></span></span><span class="org-block"><span class="doc">', never compile org-sources. `</span></span><span class="org-block"><span class="doc"><span class="constant">my/compile-org</span></span></span><span class="org-block"><span class="doc">' will only create
  the autoloads file `</span></span><span class="org-block"><span class="doc"><span class="constant">org-loaddefs.el</span></span></span><span class="org-block"><span class="doc">' then. If `t', compile the sources, too."</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Customize: (must end with a slash!)
</span></span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> my/org-lisp-directory </span><span class="org-block"><span class="string">"~/.emacs.d/org/lisp/"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Customize:
</span></span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block">  my/org-compile-sources t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my/compile-org</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="type">&amp;optional</span></span><span class="org-block"> directory</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Generate autoloads file org-loaddefs.el.  Optionally compile
     all *.el files that come with org-mode."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my/compile-org</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">()</span></span><span class="org-block">
      </span><span class="org-block"><span class="doc">"Generate autoloads file org-loaddefs.el.  Optionally compile
       all *.el files that come with org-mode."</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">dirlisp </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">file-name-directory</span></span><span class="org-block"> my/org-lisp-directory</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-to-list</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">load-path</span></span><span class="org-block"> dirlisp</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">require</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="constant">autoload</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">generated-autoload-file </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> dirlisp </span><span class="org-block"><span class="string">"org-loaddefs.el"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">create the org-loaddefs file
</span></span><span class="org-block">          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">update-directory-autoloads</span></span><span class="org-block"> dirlisp</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> my/org-compile-sources
            </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">optionally byte-compile
</span></span><span class="org-block">            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">byte-recompile-directory</span></span><span class="org-block"> dirlisp </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">force</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="org-block-end-line">  #+END_SRC
</span><span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Reload Org
</span>
<span class="org-meta-line">#+index: Initialization!Reload</span>

As of Org version 6.23b (released Sunday Feb 22, 2009) there is a new
function to reload org files.

Normally you want to use the compiled files since they are faster.
If you update your org files you can easily reload them with

<span class="org-code">: M-x org-reload
</span>
If you run into a bug and want to generate a useful backtrace you can
reload the source files instead of the compiled files with

<span class="org-code">: C-u M-x org-reload
</span>
and turn on the "Enter Debugger On Error" option.  Redo the action
that generates the error and cut and paste the resulting backtrace.
To switch back to the compiled version just reload again with

<span class="org-code">: M-x org-reload
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Check for possibly problematic old link escapes
</span><span class="org-drawer">:PROPERTIES:</span>
<span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">check-old-link-escapes</span>
<span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Link!Escape</span>
Starting with version 7.5 Org uses <span class="kc-org-link-url"><a href="https://en.wikipedia.org/wiki/Percent-encoding">percent escaping</a></span> more consistently
and with a modified algorithm to determine which characters to escape
and how.

As a side effect this modified behaviour might break existing links if
they contain a sequence of characters that look like a percent escape
(e.g. <span class="org-verbatim">[0-9A-Fa-f]{2}</span>) but are in fact not a percent escape.

The function below can be used to perform a preliminary check for such
links in an Org mode file.  It will run through all links in the file
and issue a warning if it finds a percent escape sequence which is not
in old Org's list of known percent escapes.

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">dmaus/org-check-percent-escapes</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"*Check buffer for possibly problematic old link escapes."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">eq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">major-mode</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-mode</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">old-escapes </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="string">"%20"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%5B"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%5D"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%E0"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%E2"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%E7"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%E8"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%E9"</span></span><span class="org-block">
                           </span><span class="org-block"><span class="string">"%EA"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%EE"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%F4"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%F9"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%FB"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%3B"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%3D"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%2B"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">unless</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">boundp</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">warning-suppress-types</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">warning-suppress-types</span></span><span class="org-block"> nil</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">widen</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">show-all</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">point-min</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">while</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">re-search-forward</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-any-link-re</span></span><span class="org-block"> nil t</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">end </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">match-end</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">match-beginning</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">while</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">re-search-forward</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%[0-9a-zA-Z]\\{2\\}"</span></span><span class="org-block"> end t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">escape </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">match-string-no-properties</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">unless</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">member</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">upcase</span></span><span class="org-block"> escape</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> old-escapes</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                  </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">warn</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Found unknown percent escape sequence %s at buffer %s, position %d"</span></span><span class="org-block">
                        escape
                        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">buffer-name</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">-</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">3</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> end</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Structure Movement and Editing
</span><span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Go back to the previous top-level heading
</span>
<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-back-to-top-level-heading</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Go back to the current top level heading."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">re-search-backward</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"^</span></span><span class="org-block"><span class="string"><span class="warning-1">\</span></span></span><span class="org-block"><span class="string">* "</span></span><span class="org-block"> nil t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point-min</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Go to a child of the current heading
</span>    <span class="org-drawer">:PROPERTIES:</span>
    <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">org-jump-to-child</span>
    <span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Navigation!Heading</span>
<span class="org-list-dt">-</span> <span class="kc-org-link-url"><a href="http://langec.wordpress.com">Christoph Lange</a></span>

<span class="org-verbatim">org-jump-to-child</span> in <span class="org-link"><a href="file:code/elisp/org-jump.el::(defun%20org-jump-to-child">org-jump.el</a></span> (keybinding suggested there: <span class="org-verbatim">C-c o c</span>) interactively prompts for the title of a child node, i.e. sub-heading, of the current heading and jumps to the child node having that title (in case of ambiguity: the <span class="italic">last</span> such node).

In the absence of a readily accessible structural representation of the tree outline, this is ipmlemented by walking over all child nodes and collecting their titles and their positions in the file.

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Go to a heading by its ID (</span><span class="org-level-3"><span class="org-verbatim">CUSTOM_ID</span></span><span class="org-level-3"> property)
</span>    <span class="org-drawer">:PROPERTIES:</span>
    <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">org-jump-to-id</span>
    <span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Navigation!Heading</span>
<span class="org-list-dt">-</span> <span class="kc-org-link-url"><a href="http://langec.wordpress.com">Christoph Lange</a></span>

<span class="org-verbatim">org-jump-to-id</span> in <span class="org-link"><a href="file:code/elisp/org-jump.el::(defun%20org-jump-to-id">org-jump.el</a></span> (keybinding suggested there: <span class="org-verbatim">C-c o j</span>) interactively prompts for the one of the <span class="org-verbatim">CUSTOM_ID</span> property values in the current document and jumps to the [first] node that has this ID.

This implementation works efficiently in a 5 MB org file with 100 IDs. Together with ido or helm I find it a very user-friendly way of jumping to frequently used headings.

I noticed that <span class="org-verbatim">org-babel-ref-goto-headline-id</span> does something similar, so maybe some code could be shared among the two functions.
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Show next/prev heading tidily
</span>
<span class="org-meta-line">#+index: Navigation!Heading</span>
<span class="org-list-dt">-</span> Dan Davison
  These close the current heading and open the next/previous heading.

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">ded/org-show-next-heading-tidily</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Show next entry, keeping other entries closed."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">end-of-line</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">outline-invisible-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">progn</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-show-entry</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">show-children</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">outline-next-heading</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">unless</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">bolp</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-on-heading-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-up-heading-safe</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">hide-subtree</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">error</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Boundary reached"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-overview</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-reveal</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-show-entry</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">show-children</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">ded/org-show-previous-heading-tidily</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Show previous entry, keeping other entries closed."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">pos </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">outline-previous-heading</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">unless</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">&lt;</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> pos</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">bolp</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-on-heading-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> pos</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">hide-subtree</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">error</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Boundary reached"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-overview</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-reveal</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-show-entry</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">show-children</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-use-speed-commands</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-to-list</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">org-speed-commands-user</span></span><span class="org-block">
             </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="string">"n"</span></span><span class="org-block"> ded/org-show-next-heading-tidily</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-to-list</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">org-speed-commands-user</span></span><span class="org-block">
             </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="string">"p"</span></span><span class="org-block"> ded/org-show-previous-heading-tidily</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Promote all items in subtree
</span><span class="org-meta-line">#+index: Structure Editing!Promote</span>
<span class="org-list-dt">-</span> Matt Lundin

This function will promote all items in a subtree. Since I use
subtrees primarily to organize projects, the function is somewhat
unimaginatively called my-org-un-project:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my-org-un-project</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-map-entries</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-do-promote</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"LEVEL&gt;1"</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">tree</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-cycle</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Turn a heading into an Org link
</span>    <span class="org-drawer">:PROPERTIES:</span>
    <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">heading-to-link</span>
    <span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Structure Editing!Heading</span>
<span class="org-meta-line">#+index: Link!Turn a heading into a</span>
From David Maus:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">dmj:turn-headline-into-org-mode-link</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Replace word at point by an Org mode link."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-at-heading-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">hl-text </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">nth</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">4</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-heading-components</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">unless</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">null</span></span><span class="org-block"> hl-text</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-string-match-p</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"^[ \t]*:[</span></span><span class="org-block"><span class="string"><span class="negation-char">^</span></span></span><span class="org-block"><span class="string">:]+:$"</span></span><span class="org-block"> hl-text</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">beginning-of-line</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">search-forward</span></span><span class="org-block"> hl-text </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point-at-eol</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">replace-string</span></span><span class="org-block">
           hl-text
           </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">format</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"<a href="file:%s.org">[[file:%s.org][%s]]</a>"</span></span><span class="org-block">
                   </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-link-escape</span></span><span class="org-block"> hl-text</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                   </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-link-escape</span></span><span class="org-block"> hl-text </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">?\] . </span><span class="org-block"><span class="string">"%5D"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">?\[ . </span><span class="org-block"><span class="string">"%5B"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
           nil </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">-</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">length</span></span><span class="org-block"> hl-text</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Using M-up and M-down to transpose paragraphs
</span><span class="org-meta-line">#+index: Structure Editing!paragraphs</span>

From Paul Sexton: By default, if used within ordinary paragraphs in
org mode, <span class="org-verbatim">M-up</span> and <span class="org-verbatim">M-down</span> transpose <span class="bold">lines</span> (not sentences).  The
following code makes these keys transpose paragraphs, keeping the
point at the start of the moved paragraph. Behavior in tables and
headings is unaffected. It would be easy to modify this to transpose
sentences.

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-transpose-paragraphs</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">arg</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
 </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
 </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">not</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-at-table-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-on-heading-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-at-item-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">thing-at-point</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">sentence</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
   </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">transpose-paragraphs</span></span><span class="org-block"> arg</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
   </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">backward-paragraph</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
   </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">re-search-forward</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"<a href=":graph:">[[:graph:]]</a>"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
   </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">match-beginning</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
   t</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-to-list</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">org-metaup-hook</span></span><span class="org-block">
 </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">()</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">org-transpose-paragraphs </span><span class="org-block"><span class="highlight-numbers-number">-1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-to-list</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">org-metadown-hook</span></span><span class="org-block">
 </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">()</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">org-transpose-paragraphs </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span><span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Changelog support for org headers
</span><span class="org-meta-line">#+index: Structure Editing!Heading</span>
-- James TD Smith

Put the following in your <span class="org-verbatim">.emacs</span>, and <span class="org-verbatim">C-x 4 a</span> and other functions which
use <span class="org-verbatim">add-log-current-defun</span> like <span class="org-verbatim">magit-add-log</span> will pick up the nearest org
headline as the "current function" if you add a changelog entry from an org
buffer.

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-log-current-defun</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-back-to-heading</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">looking-at</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-complex-heading-regexp</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">match-string</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">4</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">org-mode-hook</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">()</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">make-variable-buffer-local</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">add-log-current-defun-function</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">add-log-current-defun-function</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-log-current-defun</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Different org-cycle-level behavior
</span><span class="org-meta-line">#+index: Cycling!behavior</span>
-- Ryan Thompson

In recent org versions, when your point (cursor) is at the end of an
empty header line (like after you first created the header), the TAB
key (<span class="org-verbatim">org-cycle</span>) has a special behavior: it cycles the headline through
all possible levels. However, I did not like the way it determined
"all possible levels," so I rewrote the whole function, along with a
couple of supporting functions.

The original function's definition of "all possible levels" was "every
level from 1 to one more than the initial level of the current
headline before you started cycling." My new definition is "every
level from 1 to one more than the previous headline's level." So, if
you have a headline at level 4 and you use ALT+RET to make a new
headline below it, it will cycle between levels 1 and 5, inclusive.

The main advantage of my custom <span class="org-verbatim">org-cycle-level</span> function is that it
is stateless: the next level in the cycle is determined entirely by
the contents of the buffer, and not what command you executed last.
This makes it more predictable, I hope.

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">require</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="constant">cl</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-point-at-end-of-empty-headline</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"If point is at the end of an empty headline, return t, else nil."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">looking-at</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"[ \t]*$"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
       </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">beginning-of-line</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">looking-at</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"^</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">\\*+</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">[ \t]+</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">"</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-todo-regexp</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">?[ \t]*"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-level-increment</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Return the number of stars that will be added or removed at a
time to headlines when structure editing, based on the value of
`</span></span><span class="org-block"><span class="doc"><span class="constant">org-odd-levels-only</span></span></span><span class="org-block"><span class="doc">'."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-odd-levels-only</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-previous-line-level-cached</span></span><span class="org-block"> nil</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-recalculate-previous-line-level</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Same as `</span></span><span class="org-block"><span class="doc"><span class="constant">org-get-previous-line-level</span></span></span><span class="org-block"><span class="doc">', but does not use cached
value. It does *set* the cached value, though."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">set</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-previous-line-level-cached</span></span><span class="org-block">
       </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">current-level </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-current-level</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">prev-level </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">&gt;</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">line-number-at-pos</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                           </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
                             </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">previous-line</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                             </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-current-level</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">cond</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">null</span></span><span class="org-block"> current-level</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> nil</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">Before first headline
</span></span><span class="org-block">               </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">null</span></span><span class="org-block"> prev-level</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">      </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">At first headline
</span></span><span class="org-block">               </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">prev-level</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-get-previous-line-level</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Return the outline depth of the last headline before the
current line. Returns 0 for the first headline in the buffer, and
nil if before the first headline."</span></span><span class="org-block">
  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">This calculation is quite expensive, with all the regex searching
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">and stuff. Since org-cycle-level won't change lines, we can reuse
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">the last value of this command.
</span></span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">eq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">last-command</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-cycle-level</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
           org-previous-line-level-cached</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">org-recalculate-previous-line-level</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-cycle-level</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="variable-name">org-adapt-indentation</span></span><span class="org-block"> nil</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-point-at-end-of-empty-headline</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">this-command</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-cycle-level</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="comment-delimiter">;</span></span><span class="org-block"><span class="comment">Only needed for caching
</span></span><span class="org-block">      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">cur-level </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-current-level</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">prev-level </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-get-previous-line-level</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">cond</span></span><span class="org-block">
         </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">If first headline in file, promote to top-level.
</span></span><span class="org-block">         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">=</span></span><span class="org-block"> prev-level </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">loop</span></span><span class="org-block"> repeat </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">/</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">-</span></span><span class="org-block"> cur-level </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-level-increment</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                do </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-do-promote</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">If same level as prev, demote one.
</span></span><span class="org-block">         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">=</span></span><span class="org-block"> prev-level cur-level</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-do-demote</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">If parent is top-level, promote to top level if not already.
</span></span><span class="org-block">         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">=</span></span><span class="org-block"> prev-level </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">loop</span></span><span class="org-block"> repeat </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">/</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">-</span></span><span class="org-block"> cur-level </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-level-increment</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                do </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-do-promote</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">If top-level, return to prev-level.
</span></span><span class="org-block">         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">=</span></span><span class="org-block"> cur-level </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">loop</span></span><span class="org-block"> repeat </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">/</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">-</span></span><span class="org-block"> prev-level </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-level-increment</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                do </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-do-demote</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">If less than prev-level, promote one.
</span></span><span class="org-block">         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">&lt;</span></span><span class="org-block"> cur-level prev-level</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-do-promote</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">If deeper than prev-level, promote until higher than
</span></span><span class="org-block">         </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">prev-level.
</span></span><span class="org-block">         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">&gt;</span></span><span class="org-block"> cur-level prev-level</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">loop</span></span><span class="org-block"> repeat </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">+</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">/</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">-</span></span><span class="org-block"> cur-level prev-level</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-level-increment</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                do </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-do-promote</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Count words in an Org buffer
</span><span class="comment"># FIXME: Does not fit too well under Structure. Any idea where to put it?</span>
Paul Sexton <span class="kc-org-link-url"><a href="https://orgmode.org/list/loom.20110220T224023-532@post.gmane.org">posted</a></span> this function to count words in an Org buffer:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-word-count</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">beg end
                           </span><span class="org-block"><span class="type">&amp;optional</span></span><span class="org-block"> count-latex-macro-args?
                           count-footnotes?</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Report the number of words in the Org mode buffer or selected region.
Ignores:
</span></span><span class="org-list-dt"><span class="org-block"><span class="doc">-</span></span></span><span class="org-block"><span class="doc"> comments
</span></span><span class="org-list-dt"><span class="org-block"><span class="doc">-</span></span></span><span class="org-block"><span class="doc"> tables
</span></span><span class="org-list-dt"><span class="org-block"><span class="doc">-</span></span></span><span class="org-block"><span class="doc"> source code blocks (#+BEGIN_SRC ... #+END_SRC, and inline blocks)
</span></span><span class="org-list-dt"><span class="org-block"><span class="doc">-</span></span></span><span class="org-block"><span class="doc"> hyperlinks (but does count words in hyperlink descriptions)
</span></span><span class="org-list-dt"><span class="org-block"><span class="doc">-</span></span></span><span class="org-block"><span class="doc"> tags, priorities, and </span></span><span class="org-block"><span class="bold"><span class="warning">TODO</span></span></span><span class="org-block"><span class="doc"> keywords in headers
</span></span><span class="org-list-dt"><span class="org-block"><span class="doc">-</span></span></span><span class="org-block"><span class="doc"> sections tagged as 'not for export'.

The text of footnote definitions is ignored, unless the optional argument
COUNT-FOOTNOTES? is non-nil.

If the optional argument COUNT-LATEX-MACRO-ARGS? is non-nil, the word count
includes LaTeX macro arguments (the material between {curly braces}).
Otherwise, and by default, every LaTeX macro counts as 1 word regardless
of its arguments."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"r"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">unless</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">mark-active</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setf</span></span><span class="org-block"> beg </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point-min</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">  end </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point-max</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">wc </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">latex-macro-regexp </span><span class="org-block"><span class="string">"\\\\[</span></span><span class="org-block"><span class="string"><span class="constant">A-Za-z</span></span></span><span class="org-block"><span class="string">]+</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">\\<a href="^">[[</a></span></span><span class="org-block"><span class="string"><span class="negation-char"><a href="^">^</a></span></span></span><span class="org-block"><span class="string"><a href="^">]]</a>*\\]</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">|</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">{</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">[</span></span><span class="org-block"><span class="string"><span class="negation-char">^</span></span></span><span class="org-block"><span class="string">}]*</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">}"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> beg</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">while</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">&lt;</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> end</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">cond</span></span><span class="org-block">
         </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Ignore comments.
</span></span><span class="org-block">         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">org-in-commented-line</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-at-table-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          nil</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Ignore hyperlinks. But if link has a description, count
</span></span><span class="org-block">         </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">the words within the description.
</span></span><span class="org-block">         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">looking-at</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-bracket-link-analytic-regexp</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">match-string-no-properties</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">5</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">desc </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">match-string-no-properties</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">5</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">save-match-data</span></span><span class="org-block">
                </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">incf</span></span><span class="org-block"> wc </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">length</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">remove</span></span><span class="org-block"> </span><span class="org-block"><span class="string">""</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-split-string</span></span><span class="org-block">
                                             desc </span><span class="org-block"><span class="string">"\\W"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">match-end</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">looking-at</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-any-link-re</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">match-end</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Ignore source code blocks.
</span></span><span class="org-block">         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">org-in-regexps-block-p </span><span class="org-block"><span class="string">"^#\\+BEGIN_SRC\\W"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"^#\\+END_SRC\\W"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          nil</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Ignore inline source blocks, counting them as 1 word.
</span></span><span class="org-block">         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">backward-char</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">looking-at</span></span><span class="org-block"> org-babel-inline-src-block-regexp</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">match-end</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setf</span></span><span class="org-block"> wc </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">+</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"> wc</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Count latex macros as 1 word, ignoring their arguments.
</span></span><span class="org-block">         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">backward-char</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">looking-at</span></span><span class="org-block"> latex-macro-regexp</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> count-latex-macro-args?
                         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">match-beginning</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                       </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">match-end</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setf</span></span><span class="org-block"> wc </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">+</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"> wc</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Ignore footnotes.
</span></span><span class="org-block">         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">not</span></span><span class="org-block"> count-footnotes?</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-footnote-at-definition-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                   </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-footnote-at-reference-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          nil</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">t
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">contexts </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-context</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">cond</span></span><span class="org-block">
             </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Ignore tags and </span></span><span class="org-block"><span class="bold"><span class="warning">TODO</span></span></span><span class="org-block"><span class="comment"> keywords, etc.
</span></span><span class="org-block">             </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">assoc</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:todo-keyword</span></span><span class="org-block"> contexts</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">assoc</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:priority</span></span><span class="org-block"> contexts</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">assoc</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:keyword</span></span><span class="org-block"> contexts</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">assoc</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:checkbox</span></span><span class="org-block"> contexts</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              nil</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Ignore sections marked with tags that are
</span></span><span class="org-block">             </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">excluded from export.
</span></span><span class="org-block">             </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">assoc</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:tags</span></span><span class="org-block"> contexts</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">intersection</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-get-tags-at</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-export-exclude-tags</span></span><span class="org-block">
                                </span><span class="org-block"><span class="builtin">:test</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">equal</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">org-forward-same-level </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                nil</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">t
              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">incf</span></span><span class="org-block"> wc</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">re-search-forward</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"\\w+\\W*"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">message</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">format</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%d words in %s."</span></span><span class="org-block"> wc
                     </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">mark-active</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"region"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"buffer"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Check for misplaced SCHEDULED and DEADLINE cookies
</span>  <span class="org-drawer">:PROPERTIES:</span>
  <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">check-for-misplaced-timestamps</span>
  <span class="org-drawer">:END:</span>

The <span class="org-verbatim">SCHEDULED</span> and <span class="org-verbatim">DEADLINE</span> cookies should be used on the line <span class="bold">right
below</span> the headline -- like this:

<span class="org-block-begin-line">#+begin_src org
</span><span class="org-block">,* A headline
  </span><span class="org-block"><span class="org-special-keyword">SCHEDULED:</span></span><span class="org-block"> </span><span class="org-block"><span class="org-date"><span class="org-date">&lt;2012-04-09 lun.&gt;</span></span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
This is what <span class="org-verbatim">org-scheduled</span> and <span class="org-verbatim">org-deadline</span> (and other similar
commands) do.  And the manual explicitely tell people to stick to this
format (see the section "8.3.1 Inserting deadlines or schedules").

If you think you might have subtrees with misplaced <span class="org-verbatim">SCHEDULED</span> and
<span class="org-verbatim">DEADLINE</span> cookies, this command lets you check the current buffer:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-check-misformatted-subtree</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Check misformatted entries in the current buffer."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">show-all</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-map-entries</span></span><span class="org-block">
   </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">()</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">move-beginning-of-line</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
</span><span class="whitespace-tab">                </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">not</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">looking-at</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-heading-regexp</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
       </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-get-scheduled-time</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">                </span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">not</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">looking-at</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"^.*"</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-scheduled-regexp</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">       </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-get-deadline-time</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">                </span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">not</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">looking-at</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"^.*"</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-deadline-regexp</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">   </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">y-or-n-p</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Fix this subtree? "</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">     </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">message</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Call the function again when you're done fixing this subtree."</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">     </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">recursive-edit</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">message</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"All subtrees checked."</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Sorting list by checkbox type
</span>
<span class="org-meta-line">#+index: checkbox!sorting</span>

You can use a custom function to sort list by checkbox type.
Here is a function suggested by Carsten:

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-sort-list-by-checkbox-type</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Sort list items according to Checkbox state."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-sort-list</span></span><span class="org-block">
   nil ?f
   </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">()</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">looking-at</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-list-full-item-re</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">assoc</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">match-string</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">3</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="whitespace-tab">                </span><span class="org-block">     </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="string">"[X]"</span></span><span class="org-block"> . </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="string">"[-]"</span></span><span class="org-block"> . </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="string">"[ ]"</span></span><span class="org-block"> . </span><span class="org-block"><span class="highlight-numbers-number">3</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">nil . </span><span class="org-block"><span class="highlight-numbers-number">4</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
       </span><span class="org-block"><span class="highlight-numbers-number">4</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
Use the function above directly on the list.  If you want to use an
equivalent function after <span class="org-verbatim">C-c ^ f</span>, use this one instead:

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-sort-list-by-checkbox-type-1</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">()</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">looking-at</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-list-full-item-re</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">assoc</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">match-string</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">3</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                      </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="string">"[X]"</span></span><span class="org-block"> . </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="string">"[-]"</span></span><span class="org-block"> . </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="string">"[ ]"</span></span><span class="org-block"> . </span><span class="org-block"><span class="highlight-numbers-number">3</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">nil . </span><span class="org-block"><span class="highlight-numbers-number">4</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="highlight-numbers-number">4</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Adding Licenses to org files
</span>
You can add pretty standard licenses, such as creative commons or gfdl
to org articles using <span class="org-verbatim">org-license.el</span>.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Org Table
</span>   <span class="org-drawer">:PROPERTIES:</span>
   <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Tables</span>
   <span class="org-drawer">:END:</span>

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Align all tables in a file
</span>  <span class="org-drawer">:PROPERTIES:</span>
  <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">align-tables-in-file</span>
  <span class="org-drawer">:END:</span>

Andrew Young provided this function in <span class="kc-org-link-url"><a href="https://orgmode.org/list/502F4EDF.3080800@wilkesley.net">this thread</a></span>:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my-align-all-tables</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-table-map-tables</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-table-align</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">quietly</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Transpose table
</span>    <span class="org-drawer">:PROPERTIES:</span>
    <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">transpose-table</span>
    <span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Table!Calculation</span>

Since Org 7.8, you can use <span class="org-verbatim">org-table-transpose-table-at-point</span> (which
see.)  There are also other solutions:

<span class="org-list-dt">-</span> with org-babel and Emacs Lisp: provided by Thomas S. Dye in the mailing
  list, see <span class="kc-org-link-url"><a href="https://orgmode.org/list/4BBCE264.3000407@alumni.ethz.ch">gmane</a></span> or <span class="kc-org-link-url"><a href="http://lists.gnu.org/archive/html/emacs-orgmode/2010-04/msg00239.html">gnu</a></span>

<span class="org-list-dt">-</span> with org-babel and R: provided by Dan Davison in the mailing list (old
  <span class="org-verbatim">#+TBLR:</span> syntax), see <span class="kc-org-link-url"><a href="https://orgmode.org/list/20081230193550.GA7961@stats.ox.ac.uk">gmane</a></span> or <span class="kc-org-link-url"><a href="http://lists.gnu.org/archive/html/emacs-orgmode/2008-12/msg00454.html">gnu</a></span>

<span class="org-list-dt">-</span> with field coordinates in formulas (<span class="org-verbatim">@#</span> and <span class="org-verbatim">$#</span>): see <span class="org-link"><a href="#field-coordinates-in-formulas-transpose-table">Worg</a></span>.

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Manipulate hours/minutes/seconds in table formulas
</span><span class="org-meta-line">#+index: Table!hours-minutes-seconds</span>
Both Bastien and Martin Halder have posted code (<span class="kc-org-link-url"><a href="https://orgmode.org/list/00BD91C6-C610-4CDD-B3E0-E9FECDAA372C@gmail.com">Bastien's code</a></span> and
<span class="kc-org-link-url"><a href="https://orgmode.org/list/00BD91C6-C610-4CDD-B3E0-E9FECDAA372C@gmail.com">Martin's code</a></span>) for interpreting <span class="org-verbatim">dd:dd</span> or <span class="org-verbatim">dd:dd:dd</span> strings (where
"<span class="org-verbatim">d</span>" is any digit) as time values in Org-mode table formula.  These
functions have now been wrapped up into a <span class="org-verbatim">with-time</span> macro which can
be used in table formula to translate table cell values to and from
numerical values for algebraic manipulation.

Here is the code implementing this macro.
<span class="org-block-begin-line">#+begin_src emacs-lisp :results silent
</span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-time-string-to-seconds</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">s</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Convert a string HH:MM:SS to a number of seconds."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">cond</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">stringp</span></span><span class="org-block"> s</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">string-match</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">[0-9]+</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">:</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">[0-9]+</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">:</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">[0-9]+</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">"</span></span><span class="org-block"> s</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">hour </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">string-to-number</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">match-string</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"> s</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">min</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">string-to-number</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">match-string</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"> s</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">sec </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">string-to-number</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">match-string</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">3</span></span><span class="org-block"> s</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">+</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">*</span></span><span class="org-block"> hour </span><span class="org-block"><span class="highlight-numbers-number">3600</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">*</span></span><span class="org-block"> min </span><span class="org-block"><span class="highlight-numbers-number">60</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> sec</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">stringp</span></span><span class="org-block"> s</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">string-match</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">[0-9]+</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">:</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">[0-9]+</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">"</span></span><span class="org-block"> s</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">min</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">string-to-number</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">match-string</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"> s</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">sec </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">string-to-number</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">match-string</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"> s</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">+</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">*</span></span><span class="org-block"> min </span><span class="org-block"><span class="highlight-numbers-number">60</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> sec</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">stringp</span></span><span class="org-block"> s</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">string-to-number</span></span><span class="org-block"> s</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">t s</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-time-seconds-to-string</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">secs</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Convert a number of seconds to a time string."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">cond</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">&gt;=</span></span><span class="org-block"> secs </span><span class="org-block"><span class="highlight-numbers-number">3600</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">format-seconds</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%h:%.2m:%.2s"</span></span><span class="org-block"> secs</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">&gt;=</span></span><span class="org-block"> secs </span><span class="org-block"><span class="highlight-numbers-number">60</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">format-seconds</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%m:%.2s"</span></span><span class="org-block"> secs</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">t </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">format-seconds</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%s"</span></span><span class="org-block"> secs</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defmacro</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">with-time</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">time-output-p </span><span class="org-block"><span class="type">&amp;rest</span></span><span class="org-block"> exprs</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Evaluate an org-table formula, converting all fields that look
  like time data to integer seconds.  If TIME-OUTPUT-P then return
  the result as a time value."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">list</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> time-output-p </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-time-seconds-to-string</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">identity</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">cons</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">progn</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">mapcar</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">expr</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="highlight-quoted-quote">`</span></span><span class="org-block">,</span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">cons</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> expr</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">mapcar</span></span><span class="org-block">
                       </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">el</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">listp</span></span><span class="org-block"> el</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                             </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">list</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">with-time</span></span><span class="org-block"> nil el</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                           </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-time-string-to-seconds</span></span><span class="org-block"> el</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                       </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> expr</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="highlight-quoted-quote">`</span></span><span class="org-block">,@exprs</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
Which allows the following forms of table manipulation such as adding
and subtracting time values.
<span class="org-code">: | Date             | Start | Lunch |  Back |   End |  Sum |
: |------------------+-------+-------+-------+-------+------|
: | </span><span class="org-code"><span class="org-date">[2011-03-01 Tue]</span></span><span class="org-code"> |  8:00 | 12:00 | 12:30 | 18:15 | 9:45 |
: #+TBLFM: $6='(with-time t (+ (- $5 $4) (- $3 $2)))
</span>
and dividing time values by integers
<span class="org-code">: |  time | miles | minutes/mile |
: |-------+-------+--------------|
: | 34:43 |   2.9 |        11:58 |
: | 32:15 |  2.77 |        11:38 |
: | 33:56 |   3.0 |        11:18 |
: | 52:22 |  4.62 |        11:20 |
: #+TBLFM: $3='(with-time t (/ $1 $2))
</span>
<span class="bold">Update</span>: As of Org version 7.6, you can use the <span class="org-verbatim">T</span> flag (both in Calc and
Elisp formulas) to compute time durations.  For example:

<span class="org-code">: | Task 1 | Task 2 |   Total |
: |--------+--------+---------|
: |  35:00 |  35:00 | 1:10:00 |
: #+TBLFM: </span><span class="org-code"><span class="org-formula">@2$3=$1</span></span><span class="org-code">+$2;T
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Dates computation
</span><span class="org-meta-line">#+index: Table!dates</span>
Xin Shi <span class="kc-org-link-url"><a href="https://orgmode.org/list/5236d6f90907211206y20951c9dtc711cf71afc520e2@mail.gmail.com">asked</a></span> for a way to calculate the duration of
dates stored in an org table.

Nick Dokos <span class="kc-org-link-url"><a href="https://orgmode.org/list/10926.1248205548@alphaville.usa.hp.com">suggested</a></span>:

Try the following:

<span class="org-code">: | Start Date |   End Date | Duration |
: |------------+------------+----------|
: | 2004.08.07 | 2005.07.08 |      335 |
: #+TBLFM: $3=(date(&lt;$2&gt;)-date(&lt;$1&gt;))
</span>
See <span class="kc-org-link-url"><a href="https://orgmode.org/list/17380.1218757692@alphaville.usa.hp.com">this thread</a></span> as well as <span class="kc-org-link-url"><a href="https://orgmode.org/list/48A5BADA.4070507@cs.tu-berlin.de">this post</a></span> (which is really a followup on the
above).  The problem that this last article pointed out was solved in <span class="kc-org-link-url"><a href="https://orgmode.org/list/18981.1220565299@alphaville.usa.hp.com">this
post</a></span> and Chris Randle's original musings are <span class="kc-org-link-url"><a href="https://orgmode.org/list/00be01c8a9f4$a310ca00$6580a8c0@CUBE">here</a></span>.

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Hex computation
</span><span class="org-meta-line">#+index: Table!Calculation</span>
As with Times computation, the following code allows Computation with
Hex values in Org-mode tables using the <span class="org-verbatim">with-hex</span> macro.

Here is the code implementing this macro.
<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-hex-strip-lead</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">str</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">&gt;</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">length</span></span><span class="org-block"> str</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">string=</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">substring</span></span><span class="org-block"> str </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"0x"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">substring</span></span><span class="org-block"> str </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> str</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-hex-to-hex</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">int</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">format</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"0x%x"</span></span><span class="org-block"> int</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-hex-to-dec</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">str</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">cond</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">stringp</span></span><span class="org-block"> str</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">string-match</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">[0-9a-f]+</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">"</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setf</span></span><span class="org-block"> str </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">org-hex-strip-lead str</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">out </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">mapc</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">ch</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setf</span></span><span class="org-block"> out </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">+</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">*</span></span><span class="org-block"> out </span><span class="org-block"><span class="highlight-numbers-number">16</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                        </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">&gt;=</span></span><span class="org-block"> ch </span><span class="org-block"><span class="highlight-numbers-number">48</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">&lt;=</span></span><span class="org-block"> ch </span><span class="org-block"><span class="highlight-numbers-number">57</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">-</span></span><span class="org-block"> ch </span><span class="org-block"><span class="highlight-numbers-number">48</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">-</span></span><span class="org-block"> ch </span><span class="org-block"><span class="highlight-numbers-number">87</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">coerce</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">match-string</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"> str</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">list</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        out</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">stringp</span></span><span class="org-block"> str</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">string-to-number</span></span><span class="org-block"> str</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">t str</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defmacro</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">with-hex</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">hex-output-p </span><span class="org-block"><span class="type">&amp;rest</span></span><span class="org-block"> exprs</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Evaluate an org-table formula, converting all fields that look
      like hexadecimal to decimal integers.  If HEX-OUTPUT-P then
      return the result as a hex value."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">list</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> hex-output-p </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-hex-to-hex</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">identity</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">cons</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">progn</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">mapcar</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">expr</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="highlight-quoted-quote">`</span></span><span class="org-block">,</span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">cons</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> expr</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">mapcar</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">el</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                                </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">listp</span></span><span class="org-block"> el</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                                    </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">list</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">with-hex</span></span><span class="org-block"> nil el</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                                  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">org-hex-to-dec el</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                              </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> expr</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="highlight-quoted-quote">`</span></span><span class="org-block">,@exprs</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
Which allows the following forms of table manipulation such as adding
and subtracting hex values.
<span class="org-table">| 0x10 | 0x0 | </span><span class="org-table"><span class="org-tag">#ERROR</span></span><span class="org-table"> | </span><span class="org-table"><span class="org-tag">#ERROR</span></span><span class="org-table"> |</span>
<span class="org-table">| 0x20 | 0x1 | </span><span class="org-table"><span class="org-tag">#ERROR</span></span><span class="org-table"> | </span><span class="org-table"><span class="org-tag">#ERROR</span></span><span class="org-table"> |</span>
<span class="org-table">| 0x30 | 0x2 | </span><span class="org-table"><span class="org-tag">#ERROR</span></span><span class="org-table"> | </span><span class="org-table"><span class="org-tag">#ERROR</span></span><span class="org-table"> |</span>
<span class="org-table">| 0xf0 | 0xf | </span><span class="org-table"><span class="org-tag">#ERROR</span></span><span class="org-table"> | </span><span class="org-table"><span class="org-tag">#ERROR</span></span><span class="org-table"> |</span>
<span class="org-meta-line">#+TBLFM: $3='(with-hex 'hex (+ $2 $1))::$4='(with-hex nil (identity $3))</span>

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Field coordinates in formulas (</span><span class="org-level-3"><span class="org-verbatim">@#</span></span><span class="org-level-3"> and </span><span class="org-level-3"><span class="org-verbatim">$#</span></span><span class="org-level-3">)
</span>    <span class="org-drawer">:PROPERTIES:</span>
    <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">field-coordinates-in-formulas</span>
    <span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Table!Field Coordinates</span>
-- Michael Brand

Following are some use cases that can be implemented with the &#8220;field
coordinates in formulas&#8221; described in the corresponding chapter in the
<span class="kc-org-link-url"><a href="https://orgmode.org/manual/References.html#References">Org manual</a></span>.

<span class="org-hide">***</span><span class="org-level-4"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-4"> Copy a column from a remote table into a column
</span>     <span class="org-drawer">:PROPERTIES:</span>
     <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">field-coordinates-in-formulas-copy-col-to-col</span>
     <span class="org-drawer">:END:</span>

current column <span class="org-verbatim">$3</span> = remote column <span class="org-verbatim">$2</span>:
<span class="org-code">: #+TBLFM: $3 = remote(FOO, </span><span class="org-code"><span class="org-formula">@@#$2)</span></span><span class="org-code">
</span>
<span class="org-hide">***</span><span class="org-level-4"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-4"> Copy a row from a remote table transposed into a column
</span>     <span class="org-drawer">:PROPERTIES:</span>
     <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">field-coordinates-in-formulas-copy-row-to-col</span>
     <span class="org-drawer">:END:</span>

current column <span class="org-verbatim">$1</span> = transposed remote row <span class="org-verbatim">@1</span>:
<span class="org-code">: #+TBLFM: $1 = remote(FOO, </span><span class="org-code"><span class="org-formula">@$#$@#)</span></span><span class="org-code">
</span>
<span class="org-hide">***</span><span class="org-level-4"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-4"> Transpose table
</span>     <span class="org-drawer">:PROPERTIES:</span>
     <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">field-coordinates-in-formulas-transpose-table</span>
     <span class="org-drawer">:END:</span>

-- Michael Brand

This is more like a demonstration of using &#8220;field coordinates in formulas&#8221;
and is bound to be slow for large tables. See the discussion in the mailing
list on
<span class="kc-org-link-url"><a href="https://orgmode.org/list/82e274891002251643k327135aajea270914244abff7@mail.gmail.com">gmane</a></span> or
<span class="kc-org-link-url"><a href="http://lists.gnu.org/archive/html/emacs-orgmode/2010-04/msg00086.html">gnu</a></span>.
For more efficient solutions see
<span class="org-link"><a href="#transpose-table">Worg</a></span>.

To transpose this 4x7 table

<span class="org-code">: #+TBLNAME: FOO
: | year | 2004 | 2005 | 2006 | 2007 | 2008 | 2009 |
: |------+------+------+------+------+------+------|
: | min  |  401 |  501 |  601 |  701 |  801 |  901 |
: | avg  |  402 |  502 |  602 |  702 |  802 |  902 |
: | max  |  403 |  503 |  603 |  703 |  803 |  903 |
</span>
start with a 7x4 table without any horizontal line (to have filled
also the column header) and yet empty:

<span class="org-code">: |   |   |   |   |
: |   |   |   |   |
: |   |   |   |   |
: |   |   |   |   |
: |   |   |   |   |
: |   |   |   |   |
: |   |   |   |   |
</span>
Then add the <span class="org-verbatim">TBLFM</span> line below.  After recalculation this will end up with
the transposed copy:

<span class="org-code">: | year | min | avg | max |
: | 2004 | 401 | 402 | 403 |
: | 2005 | 501 | 502 | 503 |
: | 2006 | 601 | 602 | 603 |
: | 2007 | 701 | 702 | 703 |
: | 2008 | 801 | 802 | 803 |
: | 2009 | 901 | 902 | 903 |
: #+TBLFM: </span><span class="org-code"><span class="org-formula">@&lt;$&lt;</span></span><span class="org-code">..@&gt;$&gt; = remote(FOO, </span><span class="org-code"><span class="org-formula">@$#$@#)</span></span><span class="org-code">
</span>
The formula simply exchanges row and column numbers by taking
<span class="org-list-dt">-</span> the absolute remote row number <span class="org-verbatim">@$#</span> from the current column number <span class="org-verbatim">$#</span>
<span class="org-list-dt">-</span> the absolute remote column number <span class="org-verbatim">$@#</span> from the current row number <span class="org-verbatim">@#</span>

Formulas to be taken over from the remote table will have to be transformed
manually.

<span class="org-hide">***</span><span class="org-level-4"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-4"> Dynamic variation of ranges
</span>
-- Michael Brand

In this example all columns next to <span class="org-verbatim">quote</span> are calculated from the column
<span class="org-verbatim">quote</span> and show the average change of the time series <span class="org-verbatim">quote[year]</span>
during the period of the preceding <span class="org-verbatim">1</span>, <span class="org-verbatim">2</span>, <span class="org-verbatim">3</span> or <span class="org-verbatim">4</span> years:

<span class="org-code">: | year | quote |   1 a |   2 a |   3 a |   4 a |
: |------+-------+-------+-------+-------+-------|
: | 2005 |    10 |       |       |       |       |
: | 2006 |    12 | 0.200 |       |       |       |
: | 2007 |    14 | 0.167 | 0.183 |       |       |
: | 2008 |    16 | 0.143 | 0.155 | 0.170 |       |
: | 2009 |    18 | 0.125 | 0.134 | 0.145 | 0.158 |
: #+TBLFM: </span><span class="org-code"><span class="org-formula">@I$3</span></span><span class="org-code">..@&gt;$&gt;=if(@# &gt;= $#, ($2 / subscr(@-I$2..@+I$2, </span><span class="org-code"><span class="org-formula">@#</span></span><span class="org-code"> + 1 - $#)) ^ (1 / ($# - 2)) - 1, string("")) +.0; f-3
</span>
The important part of the formula without the field blanking is:

<span class="org-code">: ($2 / subscr(@-I$2..@+I$2, </span><span class="org-code"><span class="org-formula">@#</span></span><span class="org-code"> + 1 - $#)) ^ (1 / ($# - 2)) - 1
</span>
which is the Emacs Calc implementation of the equation

<span class="italic">AvgChange(i, a) = (quote[i] / quote[i - a]) ^ (1 / a) - 1</span>

where <span class="italic">i</span> is the current time and <span class="italic">a</span> is the length of the preceding period.

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Rearrange one or more field within the same row or column
</span>    <span class="org-drawer">:PROPERTIES:</span>
    <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">field-same-row-or-column</span>
    <span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Table!Editing</span>

-- Michael Brand

<span class="org-hide">***</span><span class="org-level-4"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-4"> Rearrange the column sequence in one row only
</span>     <span class="org-drawer">:PROPERTIES:</span>
     <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">column-sequence-in-row</span>
     <span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Table!Editing</span>

The functions below can be used to change the column sequence in one
row only, without affecting the other rows above and below like with
<span class="org-verbatim">M-&lt;left&gt;</span> or <span class="org-verbatim">M-&lt;right&gt;</span> (<span class="org-verbatim">org-table-move-column</span>).  See also the
docstring of the functions for more explanations.  The original table
that serves as the starting point for the examples:

<span class="org-code">: | a | b | c  | d  |
: | e | 9 | 10 | 11 |
: | f | g | h  | i  |
</span>
<span class="org-hide">****</span><span class="org-level-5"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-5"> Move current field in row
</span><span class="org-hide">*****</span><span class="org-level-6"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-6"> Left
</span>
<span class="org-list-dt">1)</span> place point at "10" in original table
<span class="org-list-dt">2)</span> <span class="org-verbatim">M-x f-org-table-move-field-in-row-left</span>
<span class="org-list-dt">3)</span> point is at moved "10"

<span class="org-code">: | a | b  | c | d  |
: | e | 10 | 9 | 11 |
: | f | g  | h | i  |
</span>
<span class="org-hide">*****</span><span class="org-level-6"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-6"> Right
</span>
<span class="org-list-dt">1)</span> place point at "9" in original table
<span class="org-list-dt">2)</span> <span class="org-verbatim">M-x f-org-table-move-field-in-row-right</span>
<span class="org-list-dt">3)</span> point is at moved "9"

<span class="org-code">: | a | b  | c | d  |
: | e | 10 | 9 | 11 |
: | f | g  | h | i  |
</span>
<span class="org-hide">****</span><span class="org-level-5"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-5"> Rotate rest of row (range from current field to end of row)
</span><span class="org-hide">*****</span><span class="org-level-6"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-6"> Left
</span>
<span class="org-list-dt">1)</span> place point at <span class="org-formula">@2$2</span> in original table
<span class="org-list-dt">2)</span> <span class="org-verbatim">M-x f-org-table-rotate-rest-of-row-left</span>
<span class="org-list-dt">3)</span> point is still at <span class="org-formula">@2$2</span>

<span class="org-code">: | a | b  | c  | d |
: | e | 10 | 11 | 9 |
: | f | g  | h  | i |
</span>
<span class="org-hide">*****</span><span class="org-level-6"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-6"> Right
</span>
<span class="org-list-dt">1)</span> place point at <span class="org-formula">@2$2</span> in original table
<span class="org-list-dt">2)</span> <span class="org-verbatim">M-x f-org-table-rotate-rest-of-row-right</span>
<span class="org-list-dt">3)</span> point is still at <span class="org-formula">@2$2</span>

<span class="org-code">: | a | b  | c | d  |
: | e | 11 | 9 | 10 |
: | f | g  | h | i  |
</span>
<span class="org-hide">****</span><span class="org-level-5"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-5"> Open field in row (table size grows)
</span>
This is just for completeness, interactively the same as typing <span class="org-verbatim">|
S-TAB</span>.

<span class="org-list-dt">1)</span> place point at <span class="org-formula">@2$2</span> in original table
<span class="org-list-dt">2)</span> <span class="org-verbatim">M-x f-org-table-open-field-in-row-grow</span>
<span class="org-list-dt">3)</span> point is still at <span class="org-formula">@2$2</span>

<span class="org-code">: | a | b | c | d  |    |
: | e |   | 9 | 10 | 11 |
: | f | g | h | i  |    |
</span>
<span class="org-hide">***</span><span class="org-level-4"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-4"> Rearrange the row sequence in one column only
</span>     <span class="org-drawer">:PROPERTIES:</span>
     <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">row-sequence-in-column</span>
     <span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Table!Editing</span>

The functions below can be used to change the column sequence in one
column only, without affecting the other columns left and right like
with <span class="org-verbatim">M-&lt;up&gt;</span> or <span class="org-verbatim">M-&lt;down&gt;</span> (<span class="org-verbatim">org-table-move-row</span>).  See also the
docstring of the functions for more explanations.  The original table
that serves as the starting point for the examples:

<span class="org-code">: | a |  b | c |
: |---+----+---|
: | d |  9 | e |
: | f | 10 | g |
: |---+----+---|
: | h | 11 | i |
</span>
<span class="org-hide">****</span><span class="org-level-5"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-5"> Move current field in column
</span><span class="org-hide">*****</span><span class="org-level-6"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-6"> Up
</span>
<span class="org-list-dt">1)</span> place point at "10" in original table
<span class="org-list-dt">2)</span> <span class="org-verbatim">M-x f-org-table-move-field-in-column-up</span>
<span class="org-list-dt">3)</span> point is at moved "10"

<span class="org-code">: | a |  b | c |
: |---+----+---|
: | d | 10 | e |
: | f |  9 | g |
: |---+----+---|
: | h | 11 | i |
</span>
<span class="org-hide">*****</span><span class="org-level-6"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-6"> Down
</span>
<span class="org-list-dt">1)</span> place point at "9" in original table
<span class="org-list-dt">2)</span> <span class="org-verbatim">M-x f-org-table-move-field-in-column-down</span>
<span class="org-list-dt">3)</span> point is at moved "9"

<span class="org-code">: | a |  b | c |
: |---+----+---|
: | d | 10 | e |
: | f |  9 | g |
: |---+----+---|
: | h | 11 | i |
</span>
<span class="org-hide">****</span><span class="org-level-5"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-5"> Rotate rest of column (range from current field to end of column)
</span><span class="org-hide">*****</span><span class="org-level-6"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-6"> Up
</span>
<span class="org-list-dt">1)</span> place point at <span class="org-formula">@2$2</span> in original table
<span class="org-list-dt">2)</span> <span class="org-verbatim">M-x f-org-table-rotate-rest-of-column-up</span>
<span class="org-list-dt">3)</span> point is still at <span class="org-formula">@2$2</span>

<span class="org-code">: | a |  b | c |
: |---+----+---|
: | d | 10 | e |
: | f | 11 | g |
: |---+----+---|
: | h |  9 | i |
</span>
<span class="org-hide">*****</span><span class="org-level-6"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-6"> Down
</span>
<span class="org-list-dt">1)</span> place point at <span class="org-formula">@2$2</span> in original table
<span class="org-list-dt">2)</span> <span class="org-verbatim">M-x f-org-table-rotate-rest-of-column-down</span>
<span class="org-list-dt">3)</span> point is still at <span class="org-formula">@2$2</span>

<span class="org-code">: | a |  b | c |
: |---+----+---|
: | d | 11 | e |
: | f |  9 | g |
: |---+----+---|
: | h | 10 | i |
</span>
<span class="org-hide">****</span><span class="org-level-5"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-5"> Open field in column (table size grows)
</span>
<span class="org-list-dt">1)</span> place point at <span class="org-formula">@2$2</span> in original table
<span class="org-list-dt">2)</span> <span class="org-verbatim">M-x f-org-table-open-field-in-column-grow</span>
<span class="org-list-dt">3)</span> point is still at <span class="org-formula">@2$2</span>

<span class="org-code">: | a |  b | c |
: |---+----+---|
: | d |    | e |
: | f |  9 | g |
: |---+----+---|
: | h | 10 | i |
: |   | 11 |   |
</span>
<span class="org-hide">***</span><span class="org-level-4"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-4"> Key bindings for some of the functions
</span>
I have this in an Org buffer to change temporarily to the desired
behavior with <span class="org-verbatim">C-c C-c</span> on one of the three code snippets:

<span class="org-code">: - move in row:
:   #+begin_src emacs-lisp :results silent
:     (org-defkey org-mode-map [(meta left)]
:                 'f-org-table-move-field-in-row-left)
:     (org-defkey org-mode-map [(meta right)]
:                 'f-org-table-move-field-in-row-right)
:     (org-defkey org-mode-map [(left)]  'org-table-previous-field)
:     (org-defkey org-mode-map [(right)] 'org-table-next-field)
:   #+end_src
:
: - rotate in row:
:   #+begin_src emacs-lisp :results silent
:     (org-defkey org-mode-map [(meta left)]
:                 'f-org-table-rotate-rest-of-row-left)
:     (org-defkey org-mode-map [(meta right)]
:                 'f-org-table-rotate-rest-of-row-right)
:     (org-defkey org-mode-map [(left)]  'org-table-previous-field)
:     (org-defkey org-mode-map [(right)] 'org-table-next-field)
:   #+end_src
:
: - back to original:
:   #+begin_src emacs-lisp :results silent
:     (org-defkey org-mode-map [(meta left)]  'org-metaleft)
:     (org-defkey org-mode-map [(meta right)] 'org-metaright)
:     (org-defkey org-mode-map [(left)]  'backward-char)
:     (org-defkey org-mode-map [(right)] 'forward-char)
:   #+end_src
</span>
<span class="org-hide">***</span><span class="org-level-4"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-4"> Implementation
</span>
The functions

<span class="org-code">: f-org-table-move-field-in-column-up
: f-org-table-move-field-in-column-down
: f-org-table-rotate-rest-of-column-up
: f-org-table-rotate-rest-of-column-down
</span>
are not yet implemented.  They could be done similar to
<span class="org-verbatim">f-org-table-open-field-in-column-grow</span>.  A workaround without keeping
horizontal separator lines is to interactively or programmatically
simply:

<span class="org-list-dt">1)</span> Transpose the table, see
   <span class="org-link"><a href="#transpose-table">Org hacks</a></span>.
<span class="org-list-dt">2)</span> Use <span class="org-verbatim">f-org-table-*-column-in-row-*</span>, see
   <span class="kc-org-link-url"><a href="https://orgmode.org/worg/org-hacks.html#column-sequence-in-row">previous
   section</a></span>.
<span class="org-list-dt">3)</span> Transpose the table.

The other functions:

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">f-org-table-move-field-in-row-left</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Move current field in row to the left."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">f-org-table-move-field-in-row </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">left</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">f-org-table-move-field-in-row-right</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Move current field in row to the right."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">f-org-table-move-field-in-row nil</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">f-org-table-move-field-in-row</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="type">&amp;optional</span></span><span class="org-block"> left</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Move current field in row to the right.
  With arg LEFT, move to the left.  For repeated invocation the
  point follows the moved field.  Does not fix formulas."</span></span><span class="org-block">
    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Derived from `</span></span><span class="org-block"><span class="comment"><span class="constant">org-table-move-column</span></span></span><span class="org-block"><span class="comment">'
</span></span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"P"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">not</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-at-table-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">error</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Not at a table"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-table-find-dataline</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-table-check-inside-data-field</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">col </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-table-current-column</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">col1 </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> left </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">1-</span></span><span class="org-block"> col</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> col</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
           </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Current cursor position
</span></span><span class="org-block">           </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">colpos </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> left </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">1-</span></span><span class="org-block"> col</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">1+</span></span><span class="org-block"> col</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> left </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">=</span></span><span class="org-block"> col </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">error</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Cannot move column further left"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">not</span></span><span class="org-block"> left</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">looking-at</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"[</span></span><span class="org-block"><span class="string"><span class="negation-char">^</span></span></span><span class="org-block"><span class="string">|\n]*|[</span></span><span class="org-block"><span class="string"><span class="negation-char">^</span></span></span><span class="org-block"><span class="string">|\n]*$"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">error</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Cannot move column further right"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-table-goto-column</span></span><span class="org-block"> col1 t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">looking-at</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"|</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">[</span></span><span class="org-block"><span class="string"><span class="negation-char">^</span></span></span><span class="org-block"><span class="string">|\n]+</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">|</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">[</span></span><span class="org-block"><span class="string"><span class="negation-char">^</span></span></span><span class="org-block"><span class="string">|\n]+</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">|"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">replace-match</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"|\\2|\\1|"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-table-goto-column</span></span><span class="org-block"> colpos</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-table-align</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">f-org-table-rotate-rest-of-row-left</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Rotate rest of row to the left."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">f-org-table-rotate-rest-of-row </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">left</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">f-org-table-rotate-rest-of-row-right</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Rotate rest of row to the right."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">f-org-table-rotate-rest-of-row nil</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">f-org-table-rotate-rest-of-row</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="type">&amp;optional</span></span><span class="org-block"> left</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Rotate rest of row to the right.
  With arg LEFT, rotate to the left.  For both directions the
  boundaries of the rotation range are the current field and the
  field at the end of the row.  For repeated invocation the point
  stays on the original current field.  Does not fix formulas."</span></span><span class="org-block">
    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Derived from `</span></span><span class="org-block"><span class="comment"><span class="constant">org-table-move-column</span></span></span><span class="org-block"><span class="comment">'
</span></span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"P"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">not</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-at-table-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">error</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Not at a table"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-table-find-dataline</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-table-check-inside-data-field</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">col </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-table-current-column</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-table-goto-column</span></span><span class="org-block"> col t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">looking-at</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> left
                           </span><span class="org-block"><span class="string">"|</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">[</span></span><span class="org-block"><span class="string"><span class="negation-char">^</span></span></span><span class="org-block"><span class="string">|\n]+</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">|</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">[</span></span><span class="org-block"><span class="string"><span class="negation-char">^</span></span></span><span class="org-block"><span class="string">\n]+</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">|$"</span></span><span class="org-block">
                         </span><span class="org-block"><span class="string">"|</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">[</span></span><span class="org-block"><span class="string"><span class="negation-char">^</span></span></span><span class="org-block"><span class="string">\n]+</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">|</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">[</span></span><span class="org-block"><span class="string"><span class="negation-char">^</span></span></span><span class="org-block"><span class="string">|\n]+</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">|$"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">replace-match</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"|\\2|\\1|"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-table-goto-column</span></span><span class="org-block"> col</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-table-align</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">f-org-table-open-field-in-row-grow</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Open field in row, move fields to the right by growing table."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">insert</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"|"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">backward-char</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-table-align</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">f-org-table-open-field-in-column-grow</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Open field in column, move all fields downwards by growing table."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">col </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-table-current-column</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">p   </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Cut all fields downwards in same column
</span></span><span class="org-block">      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-table-end</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">forward-line</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">-1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">while</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-at-table-hline-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">forward-line</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">-1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-table-goto-column</span></span><span class="org-block"> col</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-table-cut-region</span></span><span class="org-block"> p </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Paste at one field below
</span></span><span class="org-block">      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> p</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">forward-line</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-table-goto-column</span></span><span class="org-block"> col</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-table-paste-rectangle</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> p</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-table-align</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-hide">***</span><span class="org-level-4"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-4"> Reasons why this is not put into the Org core
</span>
I consider this as only a hack for several reasons:

<span class="org-list-dt">-</span> Generalization: The existing function <span class="org-verbatim">org-table-move-column</span> could
  be enhanced with additional optional parameters to incorporate these
  functionalities and could be used as the only function for better
  maintainability.  Now it's only a copy/paste hack of several similar
  functions with simple modifications.
<span class="org-list-dt">-</span> Bindings: Should be convenient for repetition like <span class="org-verbatim">M-&lt;right&gt;</span>.
  What should be bound where, what has to be left unbound?
<span class="org-list-dt">-</span> Does not fix formulas.  Could be resolved for field formulas but
  most probably not for column or range formulas and this can lead to
  confusion.  AFAIK all table manipulations found in Org core fix
  formulas.
<span class="org-list-dt">-</span> Completeness: Not all variations and combinations are covered yet
  <span class="org-list-dt">-</span> move, rotate with range to end, rotate with range to begin, rotate
    all
  <span class="org-list-dt">-</span> left-right, up-down

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Capture and Remember
</span><span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Customize the size of the frame for remember
</span><span class="org-meta-line">#+index: Remember!frame</span>
<span class="org-meta-line">#+index: Customization!remember</span>
(Note: this hack is likely out of date due to the development of
<span class="org-verbatim">org-capture</span>.)

<span class="comment"># FIXME: gmane link?</span>
On emacs-orgmode, Ryan C. Thompson suggested this:

<span class="org-block-begin-line">#+begin_quote
</span><span class="org-quote">I am using org-remember set to open a new frame when used,
and the default frame size is much too large. To fix this, I have
designed some advice and a custom variable to implement custom
parameters for the remember frame:
</span><span class="org-block-end-line">#+end_quote
</span>
<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defcustom</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">remember-frame-alist</span></span><span class="org-block"> nil
  </span><span class="org-block"><span class="doc">"Additional frame parameters for dedicated remember frame."</span></span><span class="org-block">
  </span><span class="org-block"><span class="builtin">:type</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">alist</span></span><span class="org-block">
  </span><span class="org-block"><span class="builtin">:group</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">remember</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defadvice</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">remember</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">around remember-frame-parameters activate</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Set some frame parameters for the remember frame."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="variable-name">default-frame-alist</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">append</span></span><span class="org-block"> remember-frame-alist
                                     </span><span class="org-block"><span class="variable-name">default-frame-alist</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    ad-do-it</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
Setting remember-frame-alist to <span class="org-verbatim">((width . 80) (height . 15)))</span> give a
reasonable size for the frame.
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> </span><span class="kc-org-link-url"><a href="https://github.com/PhilHudson/org-capture-vars.el">User-defined capture template variables with prompt and completion list</a></span><span class="org-level-3">
</span><span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> </span><span class="kc-org-link-url"><a href="https://github.com/alphapapa/unpackaged.el#ensure-blank-lines-between-headings-and-before-contents">Ensure blank lines between headings and before contents</a></span><span class="org-level-3">
</span><span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Handling Links
</span><span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> </span><span class="org-link"><a href="#heading-to-link">Turn a heading into an org link</a></span><span class="org-level-3">
</span><span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Quickaccess to the link part of hyperlinks
</span><span class="org-meta-line">#+index: Link!Referent</span>
Christian Moe <span class="kc-org-link-url"><a href="https://orgmode.org/list/4E0307D5.8080105@christianmoe.com">asked</a></span>, if there is a simpler way to copy the link part
of an org hyperling other than to use `C-c C-l C-a C-k C-g',
which is indeed kind of cumbersome.

The thread offered <span class="kc-org-link-url"><a href="https://orgmode.org/list/871uy9ghdw.fsf@gnu.org">two ways</a></span>:

Using a <span class="kc-org-link-url"><a href="http://www.gnu.org/software/emacs/manual/html_node/emacs/Keyboard-Macros.html">keyboard macro</a></span>:
<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">fset</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">getlink</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="type">&amp;optional</span></span><span class="org-block"> arg</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="doc">"Keyboard macro."</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"p"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">kmacro-exec-ring-item</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">quote</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="string">"\C-c\C-l\C-a\C-k\C-g"</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%d"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> arg</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
or a function:
<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my-org-extract-link</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Extract the link location at point and put it on the killring."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-in-regexp</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-bracket-link-regexp</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">kill-new</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-link-unescape</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-match-string-no-properties</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
They put the link destination on the killring and can be easily bound to a key.

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Insert link with HTML title as default description
</span>When using `org-insert-link' (`C-c C-l') it might be useful to extract contents
from HTML &lt;title&gt; tag and use it as a default link description. Here is a way to
accomplish this:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">require</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="constant">mm-url</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">to include mm-url-decode-entities-string
</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my-org-insert-link</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Insert org link where default description is set to html title."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">url </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">read-string</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"URL: "</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">title </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">get-html-title-from-url url</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-insert-link</span></span><span class="org-block"> nil url title</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">get-html-title-from-url</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">url</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Return content in &lt;title&gt; tag."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">x1 x2 </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">download-buffer </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">url-retrieve-synchronously</span></span><span class="org-block"> url</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">set-buffer</span></span><span class="org-block"> download-buffer</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">beginning-of-buffer</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> x1 </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">search-forward</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"&lt;title&gt;"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">search-forward</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"&lt;/title&gt;"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> x2 </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">search-backward</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"&lt;"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">mm-url-decode-entities-string</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">buffer-substring-no-properties</span></span><span class="org-block"> x1 x2</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
Then just use `M-x my-org-insert-link' instead of `org-insert-link'.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Archiving Content in Org-Mode
</span>  <span class="org-drawer">:PROPERTIES:</span>
  <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">archiving</span>
  <span class="org-drawer">:END:</span>

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Preserve top level headings when archiving to a file
</span><span class="org-meta-line">#+index: Archiving!Preserve top level headings</span>
<span class="org-list-dt">-</span> Matt Lundin

To preserve (somewhat) the integrity of your archive structure while
archiving lower level items to a file, you can use the following
defadvice:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defadvice</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-archive-subtree</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">around my-org-archive-subtree activate</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="variable-name">org-archive-location</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-back-to-heading</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                             </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">&gt;</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-outline-level</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">split-string</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-archive-location</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"::"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                     </span><span class="org-block"><span class="string">"::* "</span></span><span class="org-block">
                     </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-get-outline-path</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
           </span><span class="org-block"><span class="variable-name">org-archive-location</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    ad-do-it</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
Thus, if you have an outline structure such as...

<span class="org-block-begin-line">#+begin_src org
</span><span class="org-block">,* Heading
,** Subheading
,*** Subsubheading
</span><span class="org-block-end-line">#+end_src
</span>
...archiving "Subsubheading" to a new file will set the location in
the new file to the top level heading:

<span class="org-block-begin-line">#+begin_src org
</span><span class="org-block">,* Heading
,** Subsubheading
</span><span class="org-block-end-line">#+end_src
</span>
While this hack obviously destroys the outline hierarchy somewhat, it
at least preserves the logic of level one groupings.

A slightly more complex version of this hack will not only keep the
archive organized by top-level headings, but will also preserve the
tags found on those headings:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my-org-inherited-no-file-tags</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">tags </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-entry-get</span></span><span class="org-block"> nil </span><span class="org-block"><span class="string">"ALLTAGS"</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">selective</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">ltags </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-entry-get</span></span><span class="org-block"> nil </span><span class="org-block"><span class="string">"TAGS"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">mapc</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">tag</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> tags
                    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">replace-regexp-in-string</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> tag </span><span class="org-block"><span class="string">":"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">""</span></span><span class="org-block"> tags</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">append</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-file-tags</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> ltags </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">split-string</span></span><span class="org-block"> ltags </span><span class="org-block"><span class="string">":"</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">string=</span></span><span class="org-block"> </span><span class="org-block"><span class="string">":"</span></span><span class="org-block"> tags</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> nil tags</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defadvice</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-archive-subtree</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">around my-org-archive-subtree-low-level activate</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">tags </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">my-org-inherited-no-file-tags</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="variable-name">org-archive-location</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-back-to-heading</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                               </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">&gt;</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-outline-level</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">split-string</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-archive-location</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"::"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                       </span><span class="org-block"><span class="string">"::* "</span></span><span class="org-block">
                       </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-get-outline-path</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="variable-name">org-archive-location</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      ad-do-it
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">with-current-buffer</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">find-file-noselect</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">org-extract-archive-file</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">while</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-up-heading-safe</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-set-tags-to</span></span><span class="org-block"> tags</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Archive in a date tree
</span><span class="org-meta-line">#+index: Archiving!date tree</span>
Posted to Org-mode mailing list by Osamu Okano <span class="org-date">[2010-04-21 Wed]</span>.

(Make sure org-datetree.el is loaded for this to work.)

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">(setq org-archive-location "%s_archive::date-tree")
</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defadvice</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-archive-subtree</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">around org-archive-subtree-to-data-tree activate</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"org-archive-subtree to date-tree"</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">string=</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"date-tree"</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">org-extract-archive-heading
                </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">org-get-local-archive-location</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">dct </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">decode-time</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-current-time</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">y </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">nth</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">5</span></span><span class="org-block"> dct</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">m </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">nth</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">4</span></span><span class="org-block"> dct</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">d </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">nth</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">3</span></span><span class="org-block"> dct</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">this-buffer </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">current-buffer</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">location </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">org-get-local-archive-location</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">afile </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">org-extract-archive-file location</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="variable-name">org-archive-location</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">format</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%s::*** %04d-%02d-%02d %s"</span></span><span class="org-block"> afile y m d
                      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">format-time-string</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%A"</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">encode-time</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"> d m y</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">message</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"afile=%s"</span></span><span class="org-block"> afile</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">unless</span></span><span class="org-block"> afile
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">error</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Invalid `</span></span><span class="org-block"><span class="string"><span class="constant">org-archive-location</span></span></span><span class="org-block"><span class="string">'"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">switch-to-buffer</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">find-file-noselect</span></span><span class="org-block"> afile</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">org-datetree-find-year-create y</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-datetree-find-month-create</span></span><span class="org-block"> y m</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">org-datetree-find-day-create y m d</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">widen</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">switch-to-buffer</span></span><span class="org-block"> this-buffer</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        ad-do-it</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    ad-do-it</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Add inherited tags to archived entries
</span><span class="org-meta-line">#+index: Archiving!Add inherited tags</span>
To make <span class="org-verbatim">org-archive-subtree</span> keep inherited tags, Osamu OKANO suggests to
advise the function like this:

<span class="org-block-begin-line">#+begin_example
</span><span class="custom">(defadvice org-archive-subtree
  (before add-inherited-tags-before-org-archive-subtree activate)
    "add inherited tags before org-archive-subtree"
    (org-set-tags-to (org-get-tags-at)))
</span><span class="org-block-end-line">#+end_example
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Using and Managing Org-Metadata
</span><span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Remove redundant tags of headlines
</span>  <span class="org-drawer">:PROPERTIES:</span>
  <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">remove-redundant-tags</span>
  <span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Tag!Remove redundant</span>
-- David Maus

A small function that processes all headlines in current buffer and
removes tags that are local to a headline and inherited by a parent
headline or the #+FILETAGS: statement.

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">dmj/org-remove-redundant-tags</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Remove redundant tags of headlines in current buffer.

  A tag is considered redundant if it is local to a headline and
  inherited by a parent headline."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">eq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">major-mode</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-mode</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-map-entries</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">()</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">alltags </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">split-string</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-entry-get</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"ALLTAGS"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">""</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">":"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                 local inherited tag</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">dolist</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">tag alltags</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">get-text-property</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">inherited</span></span><span class="org-block"> tag</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                   </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">push</span></span><span class="org-block"> tag inherited</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">push</span></span><span class="org-block"> tag local</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">dolist</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">tag local</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">member</span></span><span class="org-block"> tag inherited</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-toggle-tag</span></span><span class="org-block"> tag </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">off</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
         t nil</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Remove empty property drawers
</span>  <span class="org-drawer">:PROPERTIES:</span>
  <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">remove-empty-property-drawers</span>
  <span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Drawer!Empty</span>
David Maus proposed this:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">dmj:<a href="org:remove-empty-propert-drawers">org:remove-empty-propert-drawers</a></span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"*Remove all empty property drawers in current file."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">unless</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">eq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">major-mode</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-mode</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">error</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"You need to turn on Org mode for this function."</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point-min</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">while</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">re-search-forward</span></span><span class="org-block"> </span><span class="org-block"><span class="string">":PROPERTIES:"</span></span><span class="org-block"> nil t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-remove-empty-drawer-at</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"PROPERTIES"</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">match-beginning</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Group task list by a property
</span><span class="org-meta-line">#+index: Agenda!Group task list</span>
This advice allows you to group a task list in Org-Mode.  To use it,
set the variable <span class="org-verbatim">org-agenda-group-by-property</span> to the name of a
property in the option list for a TODO or TAGS search.  The resulting
agenda view will group tasks by that property prior to searching.

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-agenda-group-by-property</span></span><span class="org-block"> nil
  </span><span class="org-block"><span class="doc">"Set this in org-mode agenda views to group tasks by property"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-group-bucket-items</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">prop items</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">buckets </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">dolist</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">item items</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">marker </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">get-text-property</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-marker</span></span><span class="org-block"> item</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">pvalue </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-entry-get</span></span><span class="org-block"> marker prop t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">cell </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">assoc</span></span><span class="org-block"> pvalue buckets</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> cell
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">setcdr</span></span><span class="org-block"> cell </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">cons</span></span><span class="org-block"> item </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> cell</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> buckets </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">cons</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">cons</span></span><span class="org-block"> pvalue </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">list</span></span><span class="org-block"> item</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                              buckets</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> buckets </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">mapcar</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">bucket</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">cons</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> bucket</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                                  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">reverse</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> bucket</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                          buckets</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">sort</span></span><span class="org-block"> buckets </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">i1 i2</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">string&lt;</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> i1</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> i2</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defadvice</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-finalize-agenda-entries</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">around org-group-agenda-finalize
                                               </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">list</span></span><span class="org-block"> </span><span class="org-block"><span class="type">&amp;optional</span></span><span class="org-block"> nosort</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Prepare bucketed agenda entry lists"</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> org-agenda-group-by-property
      </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">bucketed, handle appropriately
</span></span><span class="org-block">      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">text </span><span class="org-block"><span class="string">""</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">dolist</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">bucket </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">org-group-bucket-items
                         org-agenda-group-by-property
                         list</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">header </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Property "</span></span><span class="org-block">
                                org-agenda-group-by-property
                                </span><span class="org-block"><span class="string">" is "</span></span><span class="org-block">
                                </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> bucket</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"&lt;nil&gt;"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">":\n"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">add-text-properties</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">1-</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">length</span></span><span class="org-block"> header</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                                 </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">list</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">face</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-agenda-structure</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                                 header</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> text
                  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> text header
                          </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">recursively process
</span></span><span class="org-block">                          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">org-agenda-group-by-property nil</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">org-finalize-agenda-entries
                             </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> bucket</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> nosort</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                          </span><span class="org-block"><span class="string">"\n\n"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> ad-return-value text</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    ad-do-it</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">ad-activate</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-finalize-agenda-entries</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span><span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> A way to tag a task so that when clocking-out user is prompted to take a note.
</span><span class="org-meta-line">#+index: Tag!Clock</span>
<span class="org-meta-line">#+index: Clock!Tag</span>
    Thanks to Richard Riley (see <span class="kc-org-link-url"><a href="https://orgmode.org/list/vuoc49jfwp.fsf@news.eternal-september.org">this post on the mailing list</a></span>).

A small hook run when clocking out of a task that prompts for a note
when the tag "<span class="org-verbatim">clockout_note</span>" is found in a headline. It uses the tag
("<span class="org-verbatim">clockout_note</span>") so inheritance can also be used...

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">rgr/check-for-clock-out-note</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-back-to-heading</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">tags </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-get-tags</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> tags </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">message</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"tags: %s "</span></span><span class="org-block"> tags</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                 </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">member</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"clocknote"</span></span><span class="org-block"> tags</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                   </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-add-note</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">org-clock-out-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">rgr/check-for-clock-out-note</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span><span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Dynamically adjust tag position
</span><span class="org-meta-line">#+index: Tag!position</span>
Here is a bit of code that allows you to have the tags always
right-adjusted in the buffer.

This is useful when you have bigger window than default window-size
and you dislike the aesthetics of having the tag in the middle of the
line.

This hack solves the problem of adjusting it whenever you change the
window size.
Before saving it will revert the file to having the tag position be
left-adjusted so that if you track your files with version control,
you won't run into artificial diffs just because the window-size
changed.

<span class="bold">IMPORTANT</span>: This is probably slow on very big files.

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> ba/org-adjust-tags-column t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">ba/org-adjust-tags-column-reset-tags</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"In org-mode buffers it will reset tag position according to
`</span></span><span class="org-block"><span class="doc"><span class="constant">org-tags-column</span></span></span><span class="org-block"><span class="doc">'."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">not</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">string=</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">buffer-name</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"*Remember*"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">eql</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">major-mode</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-mode</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">b-m-p </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">buffer-modified-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">condition-case</span></span><span class="org-block"> nil
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point-min</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">command-execute</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">outline-next-visible-heading</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">disable (message) that org-set-tags generates
</span></span><span class="org-block">            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">flet</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">message</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="type">&amp;rest</span></span><span class="org-block"> ignored</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> nil</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-set-tags</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">set-buffer-modified-p</span></span><span class="org-block"> b-m-p</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">error</span></span><span class="org-block"> nil</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">ba/org-adjust-tags-column-now</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Right-adjust `</span></span><span class="org-block"><span class="doc"><span class="constant">org-tags-column</span></span></span><span class="org-block"><span class="doc">' value, then reset tag position."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">set</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">make-local-variable</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">org-tags-column</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
       </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">-</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">-</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">window-width</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">length</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-ellipsis</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">ba/org-adjust-tags-column-reset-tags</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">ba/org-adjust-tags-column-maybe</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"If `</span></span><span class="org-block"><span class="doc"><span class="constant">ba/org-adjust-tags-column</span></span></span><span class="org-block"><span class="doc">' is set to non-nil, adjust tags."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> ba/org-adjust-tags-column
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">ba/org-adjust-tags-column-now</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">ba/org-adjust-tags-column-before-save</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Tags need to be left-adjusted when saving."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> ba/org-adjust-tags-column
     </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-tags-column</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">ba/org-adjust-tags-column-reset-tags</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">ba/org-adjust-tags-column-after-save</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Revert left-adjusted tag position done by before-save hook."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">ba/org-adjust-tags-column-maybe</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">set-buffer-modified-p</span></span><span class="org-block"> nil</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">automatically align tags on right-hand side
</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">window-configuration-change-hook</span></span><span class="org-block">
          </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">ba/org-adjust-tags-column-maybe</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">before-save-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">ba/org-adjust-tags-column-before-save</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">after-save-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">ba/org-adjust-tags-column-after-save</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">org-agenda-mode-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">()</span></span><span class="org-block">
                                  </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-agenda-tags-column</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">-</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">window-width</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">between invoking org-refile and displaying the prompt (which
</span></span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">triggers window-configuration-change-hook) tags might adjust,
</span></span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">which invalidates the org-refile cache
</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defadvice</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-refile</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">around org-refile-disable-adjust-tags</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Disable dynamically adjusting tags"</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">ba/org-adjust-tags-column nil</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    ad-do-it</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">ad-activate</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-refile</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span><span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Use an "attach" link type to open files without worrying about their location
</span><span class="org-meta-line">#+index: Link!Attach</span>
-- Darlan Cavalcante Moreira

In the setup part in my org-files I put:

<span class="org-block-begin-line">#+begin_src org
</span><span class="org-block">,#+LINK: attach elisp:(org-open-file (org-attach-expand "%s"))
</span><span class="org-block-end-line">#+end_src
</span>
Now I can use the "attach" link type, but org will ask me if I want to
allow executing the elisp code.  To avoid this you can even set
org-confirm-elisp-link-function to nil (I don't like this because it allows
any elisp code in links) or you can set org-confirm-elisp-link-not-regexp
appropriately.

In my case I use

<span class="org-code">: (setq org-confirm-elisp-link-not-regexp "org-open-file")
</span>
This works very well.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Org Agenda and Task Management
</span><span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Make it easier to set org-agenda-files from multiple directories
</span><span class="org-meta-line">#+index: Agenda!Files</span>
<span class="org-list-dt">-</span> Matt Lundin

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my-org-list-files</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">dirs</span></span><span class="org-block"> ext</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Function to create list of org files in multiple subdirectories.
This can be called to generate a list of files for
org-agenda-files or org-refile-targets.

DIRS is a list of directories.

EXT is a list of the extensions of files to be included."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">dirs</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">listp</span></span><span class="org-block"> dirs</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                  dirs
                </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">list</span></span><span class="org-block"> dirs</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">ext </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">listp</span></span><span class="org-block"> ext</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                 ext
               </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">list</span></span><span class="org-block"> ext</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        files</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">mapc</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">x</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
       </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">mapc</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">y</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> files
                </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">append</span></span><span class="org-block"> files
                        </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">file-expand-wildcards</span></span><span class="org-block">
                         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">file-name-as-directory</span></span><span class="org-block"> x</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"*"</span></span><span class="org-block"> y</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
        ext</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
     dirs</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">mapc</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">x</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
       </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">string-match</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"/.#"</span></span><span class="org-block"> x</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                 </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">string-match</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"#$"</span></span><span class="org-block"> x</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> files </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">delete</span></span><span class="org-block"> x files</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
     files</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    files</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">my-org-agenda-directories</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="string">"~/org/"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"List of directories containing org files."</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">my-org-agenda-extensions</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="string">".org"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"List of extensions of agenda files"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> my-org-agenda-directories </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="string">"~/org/"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"~/work/"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> my-org-agenda-extensions </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="string">".org"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">".ref"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my-org-set-agenda-files</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-agenda-files</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">my-org-list-files
                          my-org-agenda-directories
                          my-org-agenda-extensions</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">my-org-set-agenda-files</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
The code above will set your "default" agenda files to all files
ending in ".org" and ".ref" in the directories "~/org/" and "~/work/".
You can change these values by setting the variables
my-org-agenda-extensions and my-org-agenda-directories. The function
my-org-agenda-files-by-filetag uses these two variables to determine
which files to search for filetags (i.e., the larger set from which
the subset will be drawn).

You can also easily use my-org-list-files to "mix and match"
directories and extensions to generate different lists of agenda
files.

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Restrict org-agenda-files by filetag
</span>  <span class="org-drawer">:PROPERTIES:</span>
  <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">set-agenda-files-by-filetag</span>
  <span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Agenda!Files</span>
<span class="org-list-dt">-</span> Matt Lundin

It is often helpful to limit yourself to a subset of your agenda
files. For instance, at work, you might want to see only files related
to work (e.g., bugs, clientA, projectxyz, etc.). The FAQ has helpful
information on filtering tasks using <span class="org-link"><a href="file:org-faq.org::#limit-agenda-with-tag-filtering">filetags</a></span> and <span class="org-link"><a href="file:org-faq.org::#limit-agenda-with-category-match">custom agendacommands</a></span>. These solutions, however, require reapplying a filter each
time you call the agenda or writing several new custom agenda commands
for each context. Another solution is to use directories for different
types of tasks and to change your agenda files with a function that
sets org-agenda-files to the appropriate directory. But this relies on
hard and static boundaries between files.

The following functions allow for a more dynamic approach to selecting
a subset of files based on filetags:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my-org-agenda-restrict-files-by-filetag</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="type">&amp;optional</span></span><span class="org-block"> tag</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Restrict org agenda files only to those containing filetag."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">tagslist </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">my-org-get-all-filetags</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">ftag </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> tag
                   </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">completing-read</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Tag: "</span></span><span class="org-block">
                                    </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">mapcar</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">car</span></span><span class="org-block"> tagslist</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-agenda-remove-restriction-lock</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">noupdate</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">put</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">org-agenda-files</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-restrict</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">assoc</span></span><span class="org-block"> ftag tagslist</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-agenda-overriding-restriction</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">files</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my-org-get-all-filetags</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Get list of filetags from all default org-files."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">files </span><span class="org-block"><span class="variable-name">org-agenda-files</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        tagslist x</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">save-window-excursion</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">while</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> x </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">pop</span></span><span class="org-block"> files</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">set-buffer</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">find-file-noselect</span></span><span class="org-block"> x</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">mapc</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">y</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">tagfiles </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">assoc</span></span><span class="org-block"> y tagslist</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> tagfiles
                 </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">setcdr</span></span><span class="org-block"> tagfiles </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">cons</span></span><span class="org-block"> x </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> tagfiles</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">add-to-list</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">tagslist</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">list</span></span><span class="org-block"> y x</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">my-org-get-filetags</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      tagslist</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my-org-get-filetags</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Get list of filetags for current buffer"</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">ftags </span><span class="org-block"><span class="variable-name">org-file-tags</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        x</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">mapcar</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">x</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
       </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-no-properties</span></span><span class="org-block"> x</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
     ftags</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
Calling my-org-agenda-restrict-files-by-filetag results in a prompt
with all filetags in your "normal" agenda files. When you select a
tag, org-agenda-files will be restricted to only those files
containing the filetag. To release the restriction, type C-c C-x &gt;
(org-agenda-remove-restriction-lock).

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Highlight the agenda line under cursor
</span><span class="org-meta-line">#+index: Agenda!Highlight</span>
This is useful to make sure what task you are operating on.

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">org-agenda-mode-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">()</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="variable-name">hl-line-mode</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
Under XEmacs:

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">hl-line seems to be only for emacs
</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">require</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="constant">highline</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">org-agenda-mode-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">()</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">highline-mode </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">highline-mode does not work straightaway in tty mode.
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">I use a black background
</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">custom-set-faces</span></span><span class="org-block">
  </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">highline-face </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">type tty</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">class color</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="builtin">:background</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"white"</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:foreground</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"black"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Split frame horizontally for agenda
</span><span class="org-meta-line">#+index: Agenda!frame</span>
If you would like to split the frame into two side-by-side windows when
displaying the agenda, try this hack from Jan Rehders, which uses the
`toggle-window-split' from

<span class="kc-org-link-url"><a href="http://www.emacswiki.org/cgi-bin/wiki/ToggleWindowSplit">http://www.emacswiki.org/cgi-bin/wiki/ToggleWindowSplit</a></span>

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Patch org-mode to use vertical splitting
</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defadvice</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-prepare-agenda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">after org-fix-split</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">toggle-window-split</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">ad-activate</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-prepare-agenda</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Automatically add an appointment when clocking in a task
</span><span class="org-meta-line">#+index: Clock!Automatically add an appointment when clocking in a task</span>
<span class="org-meta-line">#+index: Appointment!Automatically add an appointment when clocking in a task</span>
<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Make sure you have a sensible value for `</span></span><span class="org-block"><span class="comment"><span class="constant">appt-message-warning-time</span></span></span><span class="org-block"><span class="comment">'
</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">bzg-org-clock-in-appt-delay</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">100</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Number of minutes for setting an appointment by clocking-in"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
This function let's you add an appointment for the current entry.
This can be useful when you need a reminder.

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">bzg-org-clock-in-add-appt</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="type">&amp;optional</span></span><span class="org-block"> n</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Add an appointment for the Org entry at point in N minutes."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-back-to-heading</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">looking-at</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-complex-heading-regexp</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">msg </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">match-string-no-properties</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">4</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">   </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">ct-time </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">decode-time</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">   </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">appt-min </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">+</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">cadr</span></span><span class="org-block"> ct-time</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="whitespace-tab">                        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> n bzg-org-clock-in-appt-delay</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">   </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">appt-time </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">define the time for the appointment
</span></span><span class="whitespace-tab">        </span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">progn</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setf</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">cadr</span></span><span class="org-block"> ct-time</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> appt-min</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> ct-time</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">appt-add</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">format-time-string</span></span><span class="org-block">
</span><span class="whitespace-tab">                </span><span class="org-block"> </span><span class="org-block"><span class="string">"%H:%M"</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">apply</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">encode-time</span></span><span class="org-block"> appt-time</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="warning-1">msg</span></span><span class="org-block"><span class="warning-1"><span class="rainbow-delimiters-depth-1">)</span></span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">interactive-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">message</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"New appointment for %s"</span></span><span class="org-block"> msg</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
You can advise <span class="org-verbatim">org-clock-in</span> so that <span class="org-verbatim">C-c C-x C-i</span> will automatically
add an appointment:

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defadvice</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-clock-in</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">after org-clock-in-add-appt activate</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Add an appointment when clocking a task in."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">bzg-org-clock-in-add-appt</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
You may also want to delete the associated appointment when clocking
out.  This function does this:

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">bzg-org-clock-out-delete-appt</span></span><span class="org-block"> nil
  </span><span class="org-block"><span class="doc">"When clocking out, delete any associated appointment."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-back-to-heading</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">looking-at</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-complex-heading-regexp</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">msg </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">match-string-no-properties</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">4</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> appt-time-msg-list
</span><span class="whitespace-tab">        </span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">delete</span></span><span class="org-block"> nil
</span><span class="whitespace-tab">                </span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">mapcar</span></span><span class="org-block">
</span><span class="whitespace-tab">                </span><span class="org-block">     </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">appt</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">                </span><span class="org-block">       </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">not</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">string-match</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">regexp-quote</span></span><span class="org-block"> msg</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">                                        </span><span class="org-block">      </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">cadr</span></span><span class="org-block"> appt</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="warning-1">appt</span></span><span class="org-block"><span class="warning-1"><span class="rainbow-delimiters-depth-2">)</span></span></span><span class="org-block"><span class="warning-1"><span class="rainbow-delimiters-depth-1">)</span></span></span><span class="org-block">
</span><span class="whitespace-tab">                </span><span class="org-block">     appt-time-msg-list</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">appt-check</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
And here is the advice for <span class="org-verbatim">org-clock-out</span> (<span class="org-verbatim">C-c C-x C-o</span>)

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defadvice</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-clock-out</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">before org-clock-out-delete-appt activate</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Delete an appointment when clocking a task out."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">bzg-org-clock-out-delete-appt</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="bold">IMPORTANT</span>: You can add appointment by clocking in in both an
<span class="org-verbatim">org-mode</span> and an <span class="org-verbatim">org-agenda-mode</span> buffer.  But clocking out from
agenda buffer with the advice above will bring an error.

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Using external programs for appointments reminders
</span><span class="org-meta-line">#+index: Appointment!reminders</span>
Read this rich <span class="kc-org-link-url"><a href="http://comments.gmane.org/gmane.emacs.orgmode/46641">thread</a></span> from the org-mode list.

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Remove from agenda time grid lines that are in an appointment
</span><span class="org-meta-line">#+index: Agenda!time grid</span>
<span class="org-meta-line">#+index: Appointment!Remove from agenda time grid lines</span>
The agenda shows lines for the time grid.  Some people think that
these lines are a distraction when there are appointments at those
times.  You can get rid of the lines which coincide exactly with the
beginning of an appointment.  Michael Ekstrand has written a piece of
advice that also removes lines that are somewhere inside an
appointment:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-time-to-minutes</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">time</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Convert an HHMM time to minutes"</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">+</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">/</span></span><span class="org-block"> time </span><span class="org-block"><span class="highlight-numbers-number">100</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">60</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="variable-name">%</span></span><span class="org-block"> time </span><span class="org-block"><span class="highlight-numbers-number">100</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-time-from-minutes</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">minutes</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Convert a number of minutes to an HHMM time"</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">+</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">/</span></span><span class="org-block"> minutes </span><span class="org-block"><span class="highlight-numbers-number">60</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">100</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="variable-name">%</span></span><span class="org-block"> minutes </span><span class="org-block"><span class="highlight-numbers-number">60</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defadvice</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-agenda-add-time-grid-maybe</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">around mde-org-agenda-grid-tweakify
                                                  </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">list</span></span><span class="org-block"> ndays todayp</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">member</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">remove-match</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-agenda-time-grid</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">flet</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">extract-window
              </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">line</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">start </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">get-text-property</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">time-of-day</span></span><span class="org-block"> line</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">dur </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">get-text-property</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">duration</span></span><span class="org-block"> line</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">cond</span></span><span class="org-block">
                 </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> start dur</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                  </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">cons</span></span><span class="org-block"> start
                        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">org-time-from-minutes
                         </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">+</span></span><span class="org-block"> dur </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">org-time-to-minutes start</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                 </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">start start</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                 </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">t nil</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">windows </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">delq</span></span><span class="org-block"> nil </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">mapcar</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">extract-window</span></span><span class="org-block"> list</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="variable-name">org-agenda-time-grid</span></span><span class="org-block">
                </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">list</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-agenda-time-grid</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                      </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">cadr</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-agenda-time-grid</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                      </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">remove-if</span></span><span class="org-block">
                       </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">time</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">find-if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">w</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                                    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">numberp</span></span><span class="org-block"> w</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                                        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">equal</span></span><span class="org-block"> w time</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                                      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">&gt;=</span></span><span class="org-block"> time </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> w</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                                           </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">&lt;</span></span><span class="org-block"> time </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> w</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                                  windows</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                       </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">caddr</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-agenda-time-grid</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          ad-do-it</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    ad-do-it</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">ad-activate</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-agenda-add-time-grid-maybe</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span><span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Disable version control for Org mode agenda files
</span><span class="org-meta-line">#+index: Agenda!Files</span>
-- David Maus

Even if you use Git to track your agenda files you might not need
vc-mode to be enabled for these files.

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">find-file-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">dmj/disable-vc-for-agenda-files-hook</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">dmj/disable-vc-for-agenda-files-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Disable vc-mode for Org agenda files."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">fboundp</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-agenda-file-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-agenda-file-p</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="variable-name">buffer-file-name</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">remove-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">find-file-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">vc-find-file-hook</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">find-file-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">vc-find-file-hook</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Easy customization of TODO colors
</span><span class="org-meta-line">#+index: Customization!Todo keywords</span>
<span class="org-meta-line">#+index: Todo keywords!Customization</span>

-- Ryan C. Thompson

Here is some code I came up with some code to make it easier to
customize the colors of various TODO keywords. As long as you just
want a different color and nothing else, you can customize the
variable org-todo-keyword-faces and use just a string color (i.e. a
string of the color name) as the face, and then org-get-todo-face
will convert the color to a face, inheriting everything else from
the standard org-todo face.

To demonstrate, I currently have org-todo-keyword-faces set to

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="string">"IN PROGRESS"</span></span><span class="org-block"> . </span><span class="org-block"><span class="string">"dark orange"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
 </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="string">"WAITING"</span></span><span class="org-block"> . </span><span class="org-block"><span class="string">"red4"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
 </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="string">"CANCELED"</span></span><span class="org-block"> . </span><span class="org-block"><span class="string">"saddle brown"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
  Here's the code, in a form you can put in your <span class="org-verbatim">.emacs</span>

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">eval-after-load</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-faces</span></span><span class="org-block">
 </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">progn</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">defcustom</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-todo-keyword-faces</span></span><span class="org-block"> nil
      </span><span class="org-block"><span class="doc">"Faces for specific </span></span><span class="org-block"><span class="bold"><span class="warning">TODO</span></span></span><span class="org-block"><span class="doc"> keywords.
This is a list of cons cells, with </span></span><span class="org-block"><span class="bold"><span class="warning">TODO</span></span></span><span class="org-block"><span class="doc"> keywords in the car and
faces in the cdr.  The face can be a symbol, a color, or a
property list of attributes, like (:foreground \"blue\" :weight
bold :underline t)."</span></span><span class="org-block">
      </span><span class="org-block"><span class="builtin">:group</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-faces</span></span><span class="org-block">
      </span><span class="org-block"><span class="builtin">:group</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-todo</span></span><span class="org-block">
      </span><span class="org-block"><span class="builtin">:type</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">repeat
              </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">cons</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">string</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:tag</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Keyword"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">choice color </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">sexp </span><span class="org-block"><span class="builtin">:tag</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Face"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">eval-after-load</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org</span></span><span class="org-block">
 </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">progn</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-get-todo-face-from-color</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">color</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="doc">"Returns a specification for a face that inherits from org-todo
 face and has the given color as foreground. Returns nil if
 color is nil."</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> color
        </span><span class="org-block"><span class="highlight-quoted-quote">`</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="builtin">:inherit</span></span><span class="org-block"> org-warning </span><span class="org-block"><span class="builtin">:foreground</span></span><span class="org-block"> ,color</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">

    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-get-todo-face</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">kwd</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="doc">"Get the right face for a </span></span><span class="org-block"><span class="bold"><span class="warning">TODO</span></span></span><span class="org-block"><span class="doc"> keyword KWD.
If KWD is a number, get the corresponding match group."</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">numberp</span></span><span class="org-block"> kwd</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> kwd </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">match-string</span></span><span class="org-block"> kwd</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">face </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">assoc</span></span><span class="org-block"> kwd </span><span class="org-block"><span class="variable-name">org-todo-keyword-faces</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">stringp</span></span><span class="org-block"> face</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">org-get-todo-face-from-color face</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              face</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">member</span></span><span class="org-block"> kwd </span><span class="org-block"><span class="variable-name">org-done-keywords</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-done</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-todo</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Add an effort estimate on the fly when clocking in
</span><span class="org-meta-line">#+index: Effort estimate!Add when clocking in</span>
<span class="org-meta-line">#+index: Clock!Effort estimate</span>
You can use <span class="org-verbatim">org-clock-in-prepare-hook</span> to add an effort estimate.
This way you can easily have a "tea-timer" for your tasks when they
don't already have an effort estimate.

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">org-clock-in-prepare-hook</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">  </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">my-org-mode-ask-effort</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my-org-mode-ask-effort</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Ask for an effort estimate when clocking in."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">unless</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-entry-get</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Effort"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">effort
</span><span class="whitespace-tab">        </span><span class="org-block">   </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">completing-read</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">    </span><span class="org-block"><span class="string">"Effort: "</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-entry-get-multivalued-property</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Effort"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">unless</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">equal</span></span><span class="org-block"> effort </span><span class="org-block"><span class="string">""</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-set-property</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Effort"</span></span><span class="org-block"> effort</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
Or you can use a default effort for such a timer:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">org-clock-in-prepare-hook</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">  </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">my-org-mode-add-default-effort</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-clock-default-effort</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"1:00"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my-org-mode-add-default-effort</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Add a default effort estimation."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">unless</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-entry-get</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Effort"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-set-property</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Effort"</span></span><span class="org-block"> org-clock-default-effort</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Use idle timer for automatic agenda views
</span><span class="org-meta-line">#+index: Agenda view!Refresh</span>
From John Wiegley's mailing list post (March 18, 2010):

<span class="org-block-begin-line">#+begin_quote
</span><span class="org-quote">I have the following snippet in my .emacs file, which I find very
useful. Basically what it does is that if I don't touch my Emacs for 5
minutes, it displays the current agenda. This keeps my tasks "always
in mind" whenever I come back to Emacs after doing something else,
whereas before I had a tendency to forget that it was there.
</span><span class="org-block-end-line">#+end_quote
</span>
  <span class="org-list-dt">-</span> <span class="kc-org-link-url"><a href="http://mid.gmane.org/55590EA7-C744-44E5-909F-755F0BBE452D@gmail.com">John Wiegley: Displaying your Org agenda after idle time</a></span>

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">jump-to-org-agenda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">buf </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">get-buffer</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"*Org Agenda*"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        wind</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> buf
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> wind </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">get-buffer-window</span></span><span class="org-block"> buf</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">select-window</span></span><span class="org-block"> wind</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">called-interactively-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">progn</span></span><span class="org-block">
                </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">select-window</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">display-buffer</span></span><span class="org-block"> buf t t</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-fit-window-to-buffer</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">(org-agenda-redo)
</span></span><span class="org-block">                </span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">with-selected-window</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">display-buffer</span></span><span class="org-block"> buf</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-fit-window-to-buffer</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">(org-agenda-redo)
</span></span><span class="org-block">              </span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">call-interactively</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-agenda-list</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="comment-delimiter">;;</span></span><span class="org-block"><span class="comment">(let ((buf (get-buffer "*Calendar*")))
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;;  </span></span><span class="org-block"><span class="comment">(unless (get-buffer-window buf)
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;;    </span></span><span class="org-block"><span class="comment">(org-agenda-goto-calendar)))
</span></span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">run-with-idle-timer</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">300</span></span><span class="org-block"> t </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">jump-to-org-agenda</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-meta-line">#+results:</span>
<span class="org-code">: [nil 0 300 0 t jump-to-org-agenda nil idle]
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Refresh the agenda view regularly
</span><span class="org-meta-line">#+index: Agenda view!Refresh</span>
Hack sent by Kiwon Um:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">kiwon/org-agenda-redo-in-other-window</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Call org-agenda-redo function even in the non-agenda buffer."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">agenda-window </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">get-buffer-window</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-agenda-buffer-name</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> agenda-window
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">with-selected-window</span></span><span class="org-block"> agenda-window </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-agenda-redo</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">run-at-time</span></span><span class="org-block"> nil </span><span class="org-block"><span class="highlight-numbers-number">300</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">kiwon/org-agenda-redo-in-other-window</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Reschedule agenda items to today with a single command
</span><span class="org-meta-line">#+index: Agenda!Reschedule</span>
This was suggested by Carsten in reply to David Abrahams:

<span class="org-block-begin-line">#+begin_example emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-agenda-reschedule-to-today</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">flet</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-read-date</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="type">&amp;rest</span></span><span class="org-block"> rest</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">current-time</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">call-interactively</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-agenda-schedule</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_example
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Mark subtree DONE along with all subheadings
</span><span class="org-meta-line">#+index: Subtree!subheadings</span>
Bernt Hansen <span class="kc-org-link-url"><a href="https://orgmode.org/list/87aac7dnr6.fsf@norang.ca">suggested</a></span> this command:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">bh/mark-subtree-done</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-mark-subtree</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">limit </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">exchange-point-and-mark</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">while</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">&gt;</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> limit</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-todo</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"DONE"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">outline-previous-visible-heading</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-todo</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"DONE"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
Then M-x bh/mark-subtree-done.

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Mark heading done when all checkboxes are checked.
</span>    <span class="org-drawer">:PROPERTIES:</span>
    <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">mark-done-when-all-checkboxes-checked</span>
    <span class="org-drawer">:END:</span>

<span class="org-meta-line">#+index: Checkbox</span>

An item consists of a list with checkboxes.  When all of the
checkboxes are checked, the item should be considered complete and its
TODO state should be automatically changed to DONE. The code below
does that. This version is slightly enhanced over the one in the
mailing list (see
<span class="kc-org-link-url"><a href="https://orgmode.org/list/87r5718ytv.fsf@sputnik.localhost">https://orgmode.org/list/87r5718ytv.fsf@sputnik.localhost</a></span> to
reset the state back to TODO if a checkbox is unchecked.

Note that the code requires that a checkbox statistics cookie (the <span class="org-checkbox-statistics-todo">[/]</span>
or <span class="org-checkbox-statistics-todo">[%]</span> thingie in the headline - see the <span class="kc-org-link-url"><a href="https://orgmode.org/manual/Checkboxes.html#Checkboxes">Checkboxes</a></span> section in the
manual) be present in order for it to work. Note also that it is too
dumb to figure out whether the item has a TODO state in the first
place: if there is a statistics cookie, a TODO/DONE state will be
added willy-nilly any time that the statistics cookie is changed.

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">see <a href="https://orgmode.org/list/87r5718ytv.fsf@sputnik.localhost">https://orgmode.org/list/87r5718ytv.fsf@sputnik.localhost</a>
</span></span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">eval-after-load</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-list</span></span><span class="org-block">
    </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">add-hook </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">org-checkbox-statistics-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">function</span></span><span class="org-block"> ndk/checkbox-list-complete</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">ndk/checkbox-list-complete</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-back-to-heading</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">beg </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> end</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">end-of-line</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> end </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> beg</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">re-search-forward</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"\\[</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">[0-9]*%</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">\\]</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">|</span></span></span><span class="org-block"><span class="string">\\[</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">[0-9]*</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">/</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">[0-9]*</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">\\]"</span></span><span class="org-block"> end t</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">match-end</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                  </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">equal</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">match-string</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"100%"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                      </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">all done - do the state change
</span></span><span class="org-block">                      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-todo</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">done</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                    </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-todo</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">todo</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">&gt;</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">match-end</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">match-beginning</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                         </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">equal</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">match-string</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">match-string</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">3</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                    </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-todo</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">done</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-todo</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">todo</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Links to custom agenda views
</span>    <span class="org-drawer">:PROPERTIES:</span>
    <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">links-to-agenda-views</span>
    <span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Agenda view!Links to</span>
This hack was <span class="kc-org-link-url"><a href="http://lists.gnu.org/archive/html/emacs-orgmode/2012-08/msg00986.html">posted to the mailing list</a></span> by Nathan Neff.

If you have custom agenda commands defined to some key, say w, then
the following will serve as a link to the custom agenda buffer.
<span class="org-code">: <a href="elisp:(org-agenda nil &quot;w&quot;)">[[elisp:(org-agenda nil "w")][Show Waiting Tasks]]</a>
</span>
Clicking on it will prompt if you want to execute the elisp code.  If
you would rather not have the prompt or would want to respond with a
single letter, <span class="org-code">y</span> or <span class="org-code">n</span>, take a look at the docstrings of the
variables <span class="org-verbatim">org-confirm-elisp-link-function</span> and
<span class="org-verbatim">org-confirm-elisp-link-not-regexp</span>.  Please take special note of the
security risk associated with completely disabling the prompting
before you proceed.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Exporting org files
</span><span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Ignoring headlines during export
</span>    <span class="org-drawer">:PROPERTIES:</span>
    <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">ignoreheadline</span>
    <span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Export!ignore headlines</span>
Sometimes users want to ignore the headline text during export like in
the Beamer exporter (<span class="org-verbatim">ox-beamer</span>).  In the <span class="kc-org-link-url"><a href="https://orgmode.org/manual/Beamer-export.html#Beamer-export">Beamer exporter</a></span> one can use
the tag <span class="org-verbatim">ignoreheading</span> to disable the export of a certain headline,
whilst still retaining the content of the headline.  We can imitate
this feature in other export backends.  Note that this is not a
particularly easy problem, as the Org exporter creates a static
representation of section numbers, table of contents etc.

Consider the following document:
<span class="org-block-begin-line">#+BEGIN_SRC org
</span><span class="org-block">  ,* head 1                    :noexport:
  ,* head 2                    :ignoreheading:
  ,* head 3
  ,* =</span><span class="org-block"><span class="org-verbatim">head 4</span></span><span class="org-block">=                  :ignoreheading:

</span><span class="org-block-end-line">#+END_SRC
</span>We want to remove heading 2 and 4.

There are different strategies to accomplish this:
<span class="org-list-dt">1.</span> The best option is to remove headings tagged with <span class="org-verbatim">ignoreheading</span>
   before export starts.  This can be accomplished with the hook
   <span class="org-verbatim">org-export-before-parsing-hook</span> that runs before the buffer has
   been parsed.  In the example above, however, <span class="org-verbatim">head 2</span> would not be
   exported as it becomes part of <span class="org-verbatim">head 1</span> which is not exporter.  To
   overcome this move perhaps <span class="org-verbatim">head 1</span> can be moved to the end of the
   buffer.  An example of a hook that removes headings is before
   parsing is available <span class="kc-org-link-url"><a href="https://lists.gnu.org/archive/html/emacs-orgmode/2014-03/msg01459.html">here</a></span>.  Note, this solution is compatible with
   <span class="italic">all</span> export formats!
<span class="org-list-dt">2.</span> The problem is simple when exporting to LaTeX, as the LaTeX
   compiler determines numbers.  We can thus use
   <span class="org-verbatim">org-export-filter-headline-functions</span> to remove the offending
   headlines.  One regexp-based solution that looks for the word
   <span class="org-verbatim">ignoreheading</span> is available on <span class="kc-org-link-url"><a href="https://stackoverflow.com/questions/10295177/is-there-an-equivalent-of-org-modes-b-ignoreheading-for-non-beamer-documents">StackOverflow</a></span> for both the legacy
   exporter Org v7 exporter and the current Org v8 exporter.  Note,
   however, that this filter will only work with LaTeX (numbering and
   the table of content may break in other exporters).  In the example
   above, this filer will work flawlessly in LaTeX, it will not work
   at all in HTML and it will fail to update section numbers, TOC and
   leave some auxiliary lines behind when exporting to plain text.
<span class="org-list-dt">3.</span> Another solution that tries to recover the Org element
   representation is available <span class="kc-org-link-url"><a href="https://lists.gnu.org/archive/html/emacs-orgmode/2014-03/msg01480.html">here</a></span>.  In the example above this filter
   will not remove <span class="org-verbatim">head 4</span> exporting to any backend, since verbatim
   strings do not retain the Org element representation.  It will
   remove the extra heading line when exporting to plain text, but
   will also fail to update section numbers.  It should be fairly
   simple to also make it work with HTML.

<span class="bold">NOTE: another way to accomplish this behavior is to use the </span><span class="kc-org-link-url"><span class="bold"><a href="https://code.orgmode.org/bzg/org-mode/raw/master/contrib/lisp/ox-extra.el">=ox-extra.el=</a></span></span><span class="bold"> package:</span>
To use this, add the following to your <span class="org-verbatim">.elisp</span> file:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-to-list</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">load-path</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"path/to/contrib/lisp"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">require</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="constant">ox-extra</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">ox-extras-activate </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">ignore-headlines</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
After this is added, then any headlines having an <span class="org-verbatim">:ignore:</span> tag will
be omitted from the export, but their contents will be included in the
export.

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Export Org to Org and handle includes.
</span><span class="org-meta-line">#+index: Export!handle includes</span>
N.B: this does not apply to the "new" export engine (&gt;= 8.0) - the function
<span class="org-verbatim">org-export-handle-include-files-recurse</span> is only available in earlier versions.
There is probably a way to do the same thing in the "new" exporter but nobody
has stepped up to the plate yet.

Nick Dokos came up with this useful function:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-to-org-handle-includes</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Copy the contents of the current buffer to OUTFILE,
recursively processing #+INCLUDEs."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">s </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">buffer-string</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">fname </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="variable-name">buffer-file-name</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">ofname </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">format</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%s.I.org"</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">file-name-sans-extension</span></span><span class="org-block"> fname</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> result
</span><span class="whitespace-tab">        </span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">with-temp-buffer</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">insert</span></span><span class="org-block"> s</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">org-export-handle-include-files-recurse</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">buffer-string</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">find-file</span></span><span class="org-block"> ofname</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">delete-region</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point-min</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point-max</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">insert</span></span><span class="org-block"> result</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">save-buffer</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Specifying LaTeX commands to floating environments
</span>    <span class="org-drawer">:PROPERTIES:</span>
    <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">latex-command-for-floats</span>
    <span class="org-drawer">:END:</span>

<span class="org-meta-line">#+index: Export!LaTeX</span>
The keyword <span class="org-code">placement</span> can be used to specify placement options to
floating environments (like <span class="org-verbatim">\begin{figure}</span> and <span class="org-verbatim">\begin{table}</span>}) in
LaTeX export. Org passes along everything passed in options as long as
there are no spaces. One can take advantage of this to pass other
LaTeX commands and have their scope limited to the floating
environment.

For example one can set the fontsize of a table different from the
default normal size by putting something like <span class="org-verbatim">\footnotesize</span> right
after the placement options. During LaTeX export using the
<span class="org-code">#+ATTR_LaTeX:</span> line below:

<span class="org-block-begin-line">#+begin_src org
</span><span class="org-block">,#+ATTR_LaTeX: placement=[&lt;options&gt;]\footnotesize
</span><span class="org-block-end-line">#+end_src
</span>
exports the associated floating environment as shown in the following
block.

<span class="org-block-begin-line">#+begin_src latex
</span><span class="org-block"><span class="font-latex-sedate"><span class="keyword">\begin</span></span></span><span class="org-block">{</span><span class="org-block"><span class="function-name">table</span></span><span class="org-block">}[&lt;options&gt;]</span><span class="org-block"><span class="font-latex-sedate"><span class="type">\footnotesize</span></span></span><span class="org-block">
...
</span><span class="org-block"><span class="font-latex-sedate"><span class="keyword">\end</span></span></span><span class="org-block">{</span><span class="org-block"><span class="function-name">table</span></span><span class="org-block">}
</span><span class="org-block-end-line">#+end_src
</span>
It should be noted that this hack does not work for beamer export of
tables since the <span class="org-verbatim">table</span> environment is not used. As an ugly
workaround, one can use the following:

<span class="org-block-begin-line">#+begin_src org
</span><span class="org-block">,#+LATEX: {\footnotesize
,#+ATTR_LaTeX: align=rr
</span><span class="org-block"><span class="org-table">| some | table |</span></span><span class="org-block">
</span><span class="org-block"><span class="org-table">|------+-------|</span></span><span class="org-block">
</span><span class="org-block"><span class="org-table">| ..   | ..    |</span></span><span class="org-block">
,#+LATEX: }
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Styling code sections with CSS
</span>
<span class="org-meta-line">#+index: HTML!Styling code sections with CSS</span>

Code sections (marked with <span class="org-verbatim">#+begin_src</span> and <span class="org-verbatim">#+end_src</span>) are exported
to HTML using <span class="org-verbatim">&lt;pre&gt;</span> tags, and assigned CSS classes by their content
type.  For example, Perl content will have an opening tag like
<span class="org-verbatim">&lt;pre class</span>"src src-perl"&gt;=.  You can use those classes to add styling
to the output, such as here where a small language tag is added at the
top of each kind of code box:

<span class="org-block-begin-line">#+begin_src lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">setq org-export-html-style
 </span><span class="org-block"><span class="string">"&lt;style type=\"text/css\"&gt;
    &lt;!--/*--&gt;&lt;![CDATA[/*&gt;&lt;!--*/
      .src             { background-color: </span></span><span class="org-block"><span class="string"><span class="org-tag">#F5FFF5;</span></span></span><span class="org-block"><span class="string"> position: relative; overflow: visible; }
      .src:before      { position: absolute; top: -15px; background: </span></span><span class="org-block"><span class="string"><span class="org-tag">#ffffff;</span></span></span><span class="org-block"><span class="string"> padding: 1px; border: 1px solid </span></span><span class="org-block"><span class="string"><span class="org-tag">#000000;</span></span></span><span class="org-block"><span class="string"> font-size: small; }
      .src-sh:before   { content: 'sh'; }
      .src-bash:before { content: 'sh'; }
      .src-R:before    { content: 'R'; }
      .src-perl:before { content: 'Perl'; }
      .src-sql:before  { content: 'SQL'; }
      .example         { background-color: </span></span><span class="org-block"><span class="string"><span class="org-tag">#FFF5F5;</span></span></span><span class="org-block"><span class="string"> }
    /*]]&gt;*/--&gt;
 &lt;/style&gt;"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
Additionally, we use color to distinguish code output (the <span class="org-verbatim">.example</span>
class) from input (all the <span class="org-verbatim">.src-*</span> classes).

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Where can I find nice themes for HTML export?
</span>
You can find great looking HTML themes (CSS + JS) at
<span class="kc-org-link-url"><a href="https://github.com/fniessen/org-html-themes">https://github.com/fniessen/org-html-themes</a></span>, currently:

<span class="org-list-dt">-</span> Bigblow, and

  <span class="org-link"><a href="file:images/org-html-themes/bigblow.png">file:images/org-html-themes/bigblow.png</a></span>

<span class="org-list-dt">-</span> ReadTheOrg, a clone of Read The Docs.

  <span class="org-link"><a href="file:images/org-html-themes/readtheorg.png">file:images/org-html-themes/readtheorg.png</a></span>

See <span class="kc-org-link-url"><a href="https://www.youtube.com/watch?v=DnSGSiXYuOk">https://www.youtube.com/watch?v=DnSGSiXYuOk</a></span> for a demo of the Org
HTML theme Bigblow.

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Including external text fragments
</span>
<span class="org-meta-line">#+index: Export!including external text fragments</span>

I recently had to document some source code but could not modify the
source files themselves. Here is a setup that lets you refer to
fragments of external files, such that the fragments are inserted as
source blocks in the current file during evaluation of the <span class="org-code">call</span>
lines (thus during export as well).

<span class="org-block-begin-line">#+BEGIN_SRC org
</span><span class="org-block">  ,* Setup                                                            :noexport:
  ,#+name: fetchsrc
  ,#+BEGIN_SRC emacs-lisp :results raw :var f="foo" :var s="Definition" :var e="\\. *$" :var b=()
    (defvar coqfiles nil)

    (defun fetchlines (file-path search-string &amp;optional end before)
      "Searches for the SEARCH-STRING in FILE-PATH and returns the matching line.
    If the optional argument END is provided as a number, then this
    number of lines is printed.  If END is a string, then it is a
    regular expression indicating the end of the expression to print.
    If END is omitted, then 10 lines are printed.  If BEFORE is set,
    then one fewer line is printed (this is useful when END is a
    string matching the first line that should not be printed)."
      (with-temp-buffer
        (insert-file-contents file-path nil nil nil t)
        (goto-char (point-min))
        (let ((result
               (if (search-forward search-string nil t)
                   (buffer-substring
                    (line-beginning-position)
                    (if end
                        (cond
                         ((integerp end)
                          (line-end-position (if before (- end 1) end)))
                         ((stringp end)
                          (let ((point (re-search-forward end nil t)))
                            (if before (line-end-position 0) point)))
                         (t (line-end-position 10)))
                      (line-end-position 10))))))
          (or result ""))))

    (fetchlines (concat coqfiles f ".v") s e b)
  ,#+END_SRC

  ,#+name: wrap-coq
  ,#+BEGIN_SRC emacs-lisp :var text="" :results raw
  (concat "#+BEGIN_SRC coq\n" text "\n#+END_SRC")
  ,#+END_SRC
</span><span class="org-block-end-line">#+END_SRC
</span>
This is specialized for Coq files (hence the <span class="org-code">coq</span> language in the
<span class="org-code">wrap-coq</span> function, the <span class="org-code">.v</span> extension in the <span class="org-code">fetch</span> function, and
the default value for <span class="org-code">end</span> matching the syntax ending definitions in
Coq). To use it, you need to:
<span class="org-list-dt">-</span> set the <span class="org-code">coqfiles</span> variable to where your source files reside;
<span class="org-list-dt">-</span> call the function using lines of the form
<span class="org-block-begin-line">  #+BEGIN_SRC org
</span><span class="org-block">    ,#+call: fetchsrc(f="JsSyntax", s="Inductive expr :=", e="^ *</span><span class="org-block"><span class="bold">$", b=1) :results drawer :post wrap-coq(text=*this</span></span><span class="org-block">*)
</span><span class="org-block-end-line">  #+END_SRC
</span>  In this example, we look inside the file <span class="org-code">JsSyntax.v</span> in <span class="org-code">coqfiles</span>,
  search for a line matching <span class="org-code">Inductive expr :=</span>, and include the
  fragment until the first line consisting only of white space,
  excluded (as <span class="org-code">b=1</span>).

I use drawers to store the results to avoid a bug leading to
duplication during export when the code has already been evaluated in
the buffer (see <span class="kc-org-link-url"><a href="https://orgmode.org/list/m2k3fkbxec.fsf@polytechnique.org">this thread</a></span> for a description of the problem). This
has been fixed in recent versions of org-mode, so alternative
approaches are possible.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Babel
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> How do I preview LaTeX fragments when in a LaTeX source block?
</span>
When editing <span class="org-verbatim">LaTeX</span> source blocks, you may want to preview LaTeX fragments
just like in an Org-mode buffer.  You can do this by using the usual
keybinding <span class="org-verbatim">C-c C-x C-l</span> after loading this snipped:

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">define-key</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-src-mode-map</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"\C-c\C-x\C-l"</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-edit-preview-latex-fragment</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-edit-preview-latex-fragment</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Write latex fragment from source to parent buffer and preview it."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">org-src-in-org-buffer </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-preview-latex-fragment</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
Thanks to Sebastian Hofer for sharing this.

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Hacking Org: Working with Org-mode and other Emacs Packages
</span><span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> How to ediff folded Org files
</span>A rather often quip among Org users is when looking at chages with
ediff.  Ediff tends to fold the Org buffers when comparing.  This can
be very inconvenient when trying to determine what changed.  A recent
discussion on the mailing list led to a <span class="kc-org-link-url"><a href="https://orgmode.org/list/87wqo5fnxc.dlv@debian.org">neat solution</a></span> from Ratish
Punnoose.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> org-remember-anything
</span>
<span class="org-meta-line">#+index: Remember!Anything</span>

<span class="kc-org-link-url"><a href="http://www.emacswiki.org/cgi-bin/wiki/Anything">Anything</a></span> users may find the snippet below interesting:

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-remember-anything</span></span><span class="org-block">
  </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">name . </span><span class="org-block"><span class="string">"Org Remember"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">candidates . </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">mapcar</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">car</span></span><span class="org-block"> org-remember-templates</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">action . </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">name</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">orig-template org-remember-templates</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                       </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">org-remember-templates
                        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">list</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">assoc</span></span><span class="org-block"> name orig-template</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                  </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">call-interactively</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-remember</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
You can add it to your 'anything-sources' variable and open remember directly
from anything. I imagine this would be more interesting for people with many
remember templates, so that you are out of keys to assign those to.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Org-mode and saveplace.el
</span>
Fix a problem with <span class="org-verbatim">saveplace.el</span> putting you back in a folded position:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">org-mode-hook</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">()</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">outline-invisible-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
</span><span class="whitespace-tab">                </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">outline-previous-visible-heading</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">                </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-show-subtree</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Using ido-mode for org-refile (and archiving via refile)
</span>
First set up ido-mode, for example using:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">use ido mode for completion
</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> ido-everywhere t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> ido-enable-flex-matching t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> ido-max-directory-size </span><span class="org-block"><span class="highlight-numbers-number">100000</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="variable-name">ido-mode</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">quote</span></span><span class="org-block"> both</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
Now to enable it in org-mode, use the following:
<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> org-completion-use-ido t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-refile-use-outline-path</span></span><span class="org-block"> nil</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-refile-allow-creating-parent-nodes</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">confirm</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>The last line enables the creation of nodes on the fly.

If you refile into files that are not in your agenda file list, you can add them as target like this (replace file1\_done, etc with your files):
<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-refile-targets</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="variable-name">org-agenda-files</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:maxlevel</span></span><span class="org-block"> . </span><span class="org-block"><span class="highlight-numbers-number">5</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="string">"~/org/file1_done"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"~/org/file2_done"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:maxlevel</span></span><span class="org-block"> . </span><span class="org-block"><span class="highlight-numbers-number">5</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
For refiling it is often not useful to include targets that have a DONE state. It's easy to remove them by using the verify-refile-target hook.
<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">Exclude DONE state tasks from refile targets; taken from <a href="http://doc.norang.ca/org-mode.html">http://doc.norang.ca/org-mode.html</a>
</span></span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">added check to only include headlines, e.g. line must have at least one child
</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my/verify-refile-target</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Exclude todo keywords with a DONE state from refile targets"</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">or</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">not</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">member</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">nth</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-heading-components</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-done-keywords</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-goto-first-child</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-refile-target-verify-function</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">my/verify-refile-target</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>Now when looking for a refile target, you can use the full power of ido to find them. Ctrl-R can be used to switch between different options that ido offers.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Using ido-completing-read to find attachments
</span>
<span class="org-meta-line">#+index: Attachment!ido completion</span>

-- Matt Lundin.

Org-attach is great for quickly linking files to a project. But if you
use org-attach extensively you might find yourself wanting to browse
all the files you've attached to org headlines. This is not easy to do
manually, since the directories containing the files are not human
readable (i.e., they are based on automatically generated ids). Here's
some code to browse those files using ido (obviously, you need to be
using ido):

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">load-library</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"find-lisp"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Adapted from <a href="http://www.emacswiki.org/emacs/RecentFiles">http://www.emacswiki.org/emacs/RecentFiles</a>
</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my-ido-find-org-attach</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Find files in org-attachment directory"</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="variable-name">enable-recursive-minibuffers</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">files </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">find-lisp-find-files </span><span class="org-block"><span class="variable-name">org-attach-directory</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"."</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">file-assoc-list
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">mapcar</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">x</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                    </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">cons</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">file-name-nondirectory</span></span><span class="org-block"> x</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                          x</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                  files</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">filename-list
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">remove-duplicates</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">mapcar</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote"><span class="org-tag">#'</span></span></span><span class="org-block"><span class="highlight-quoted-symbol"><span class="org-tag">car</span></span></span><span class="org-block"> file-assoc-list</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                             </span><span class="org-block"><span class="builtin">:test</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote"><span class="org-tag">#'</span></span></span><span class="org-block"><span class="highlight-quoted-symbol"><span class="org-tag">string=</span></span></span><span class="org-block"><span class="rainbow-delimiters-depth-2"><span class="org-tag">)</span></span></span><span class="org-block"><span class="rainbow-delimiters-depth-1"><span class="org-tag">)</span></span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">filename </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">ido-completing-read</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Org attachments: "</span></span><span class="org-block"> filename-list nil t</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">longname </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">assoc</span></span><span class="org-block"> filename file-assoc-list</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">ido-set-current-directory
     </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">file-directory-p</span></span><span class="org-block"> longname</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
         longname
       </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">file-name-directory</span></span><span class="org-block"> longname</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> ido-exit </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">refresh</span></span><span class="org-block">
          ido-text-init ido-text
          ido-rotate-temp t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">exit-minibuffer</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">ido-setup-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">ido-my-keys</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">ido-my-keys</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Add my keybindings for ido."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">define-key</span></span><span class="org-block"> ido-completion-map </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">kbd</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"C-;"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">my-ido-find-org-attach</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
To browse your org attachments using ido fuzzy matching and/or the
completion buffer, invoke ido-find-file as usual (<span class="org-verbatim">C-x C-f</span>) and then
press <span class="org-verbatim">C-;</span>.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Link to Gnus messages by Message-Id
</span><span class="org-meta-line">#+index: Link!Gnus message by Message-Id</span>
In a <span class="kc-org-link-url"><a href="https://orgmode.org/list/871vy3tg9x.fsf@wolfram.com">recent thread</a></span> on the Org-Mode mailing list, there was some
discussion about linking to Gnus messages without encoding the folder
name in the link.  The following code hooks in to the store-link
function in Gnus to capture links by Message-Id when in nnml folders,
and then provides a link type "mid" which can open this link.  The
<span class="org-verbatim">mde-org-gnus-open-message-link</span> function uses the
<span class="org-verbatim">mde-mid-resolve-methods</span> variable to determine what Gnus backends to
scan.  It will go through them, in order, asking each to locate the
message and opening it from the first one that reports success.

It has only been tested with a single nnml backend, so there may be
bugs lurking here and there.

The logic for finding the message was adapted from <span class="kc-org-link-url"><a href="http://www.emacswiki.org/cgi-bin/wiki/FindMailByMessageId">an Emacs Wiki
article</a></span>.

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Support for saving Gnus messages by Message-ID
</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">mde-org-gnus-save-by-mid</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">memq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">major-mode</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">gnus-summary-mode gnus-article-mode</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">eq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">major-mode</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">gnus-article-mode</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">gnus-article-show-summary</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">group </span><span class="org-block"><span class="variable-name">gnus-newsgroup-name</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">method </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">gnus-find-method-for-group</span></span><span class="org-block"> group</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">eq</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">nnml</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> method</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">article </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">gnus-summary-article-number</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">header </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">gnus-summary-article-header article</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">from </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">mail-header-from</span></span><span class="org-block"> header</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">message-id
                </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">save-match-data</span></span><span class="org-block">
                  </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">mid </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">mail-header-id</span></span><span class="org-block"> header</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                    </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">string-match</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"&lt;</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">.*</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">&gt;"</span></span><span class="org-block"> mid</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">match-string</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"> mid</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                      </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">error</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Malformed message ID header %s"</span></span><span class="org-block"> mid</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">date </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">mail-header-date</span></span><span class="org-block"> header</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">subject </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">gnus-summary-subject-string</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-store-link-props</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:type</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"mid"</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:from</span></span><span class="org-block"> from </span><span class="org-block"><span class="builtin">:subject</span></span><span class="org-block"> subject
                                </span><span class="org-block"><span class="builtin">:message-id</span></span><span class="org-block"> message-id </span><span class="org-block"><span class="builtin">:group</span></span><span class="org-block"> group
                                </span><span class="org-block"><span class="builtin">:link</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">org-make-link </span><span class="org-block"><span class="string">"mid:"</span></span><span class="org-block"> message-id</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">apply</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-store-link-props</span></span><span class="org-block">
                 </span><span class="org-block"><span class="builtin">:description</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-email-link-description</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                 </span><span class="org-block"><span class="variable-name">org-store-link-plist</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
          t</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">mde-mid-resolve-methods</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"List of methods to try when resolving message ID's.  For Gnus,
it is a cons of 'gnus and the select (type and name)."</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> mde-mid-resolve-methods
      </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">gnus</span></span><span class="org-block"> nnml </span><span class="org-block"><span class="string">""</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">mde-org-gnus-open-level</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Level at which Gnus is started when opening a link"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">mde-org-gnus-open-message-link</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">msgid</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Open a message link with Gnus"</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">require</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="constant">gnus</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">require</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="constant">org-table</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">catch</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="constant">method-found</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">message</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"[MID linker] Resolving %s"</span></span><span class="org-block"> msgid</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">dolist</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">method mde-mid-resolve-methods</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">cond</span></span><span class="org-block">
       </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">eq</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> method</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">gnus</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
             </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">eq</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">cadr</span></span><span class="org-block"> method</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">nnml</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">funcall</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">assq</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">gnus</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-link-frame-setup</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                 mde-org-gnus-open-level</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">gnus-other-frame-object</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">select-frame</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">gnus-other-frame-object</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">msg-info </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">nnml-find-group-number
                          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"&lt;"</span></span><span class="org-block"> msgid </span><span class="org-block"><span class="string">"&gt;"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> method</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">group </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> msg-info </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> msg-info</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">message</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> msg-info </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> msg-info</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">qname </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> group
                           </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">gnus-methods-equal-p</span></span><span class="org-block">
                                </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> method</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                                </span><span class="org-block"><span class="variable-name">gnus-select-method</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                               group
                             </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">gnus-group-full-name</span></span><span class="org-block"> group </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> method</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> msg-info
            </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">gnus-summary-read-group</span></span><span class="org-block"> qname nil t</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">gnus-summary-goto-article message nil t</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">throw</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="constant">method-found</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
       </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">t </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">error</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Unknown link type"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">eval-after-load</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-gnus</span></span><span class="org-block">
  </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">progn</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">add-to-list</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-store-link-functions</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">mde-org-gnus-save-by-mid</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
     </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-add-link-type</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"mid"</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">mde-org-gnus-open-message-link</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Store link to a message when sending in Gnus
</span><span class="org-meta-line">#+index: Link!Store link to a message when sending in Gnus</span>
Ulf Stegemann came up with this solution (see his <span class="kc-org-link-url"><a href="http://www.mail-archive.com/emacs-orgmode@gnu.org/msg33278.html">original message</a></span>):

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">ulf-message-send-and-org-gnus-store-link</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="type">&amp;optional</span></span><span class="org-block"> arg</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Send message with `</span></span><span class="org-block"><span class="doc"><span class="constant">message-send-and-exit</span></span></span><span class="org-block"><span class="doc">' and store org link to message copy.
If multiple groups appear in the Gcc header, the link refers to
the copy in the last group."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"P"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">save-restriction</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">message-narrow-to-headers</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">gcc </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">last</span></span><span class="org-block">
</span><span class="whitespace-tab">                        </span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">message-unquote-tokens</span></span><span class="org-block">
</span><span class="whitespace-tab">                        </span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">message-tokenize-header</span></span><span class="org-block">
</span><span class="whitespace-tab">                        </span><span class="org-block">   </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">mail-fetch-field</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"gcc"</span></span><span class="org-block"> nil t</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">" ,"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">buf </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">current-buffer</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="variable-name">message-kill-buffer-on-exit</span></span><span class="org-block"> nil</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">      id to from subject desc link newsgroup xarchive</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">message-send-and-exit</span></span><span class="org-block"> arg</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">or</span></span><span class="org-block">
         </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">gcc group found ...
</span></span><span class="org-block">         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> gcc
              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">save-current-buffer</span></span><span class="org-block">
                </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">progn</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">set-buffer</span></span><span class="org-block"> buf</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                       </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> id </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-remove-angle-brackets</span></span><span class="org-block">
                                 </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">mail-fetch-field</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Message-ID"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                       </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> to </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">mail-fetch-field</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"To"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                       </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> from </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">mail-fetch-field</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"From"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                       </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> subject </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">mail-fetch-field</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Subject"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-store-link-props</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:type</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"gnus"</span></span><span class="org-block"> </span><span class="org-block"><span class="builtin">:from</span></span><span class="org-block"> from </span><span class="org-block"><span class="builtin">:subject</span></span><span class="org-block"> subject
                                    </span><span class="org-block"><span class="builtin">:message-id</span></span><span class="org-block"> id </span><span class="org-block"><span class="builtin">:group</span></span><span class="org-block"> gcc </span><span class="org-block"><span class="builtin">:to</span></span><span class="org-block"> to</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> desc </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-email-link-description</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> link </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">org-gnus-article-link
                          gcc newsgroup id xarchive</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-stored-links</span></span><span class="org-block">
                    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">cons</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">list</span></span><span class="org-block"> link desc</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-stored-links</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">no gcc group found ...
</span></span><span class="org-block">         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">message</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Can not create Org link: No Gcc header found."</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">define-key</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">message-mode-map</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">[</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">control c</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">control meta c</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">]</span></span><span class="org-block">
  </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">ulf-message-send-and-org-gnus-store-link</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Link to visit a file and run occur
</span><span class="org-meta-line">#+index: Link!Visit a file and run occur</span>
Add the following bit of code to your startup (after loading org),
and you can then use links like <span class="org-verbatim">occur:my-file.txt#regex</span> to open a
file and run occur with the regex on it.

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-occur-open</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">uri</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Visit the file specified by URI, and run `</span></span><span class="org-block"><span class="doc"><span class="constant">occur</span></span></span><span class="org-block"><span class="doc">' on the fragment
    </span></span><span class="org-block"><span class="doc"><span class="warning-1">\</span></span></span><span class="org-block"><span class="doc">(anything after the first '#') in the uri."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">list</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">split-string</span></span><span class="org-block"> uri </span><span class="org-block"><span class="string">"#"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-open-file</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> list</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">occur</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">mapconcat</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">identity</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">cdr</span></span><span class="org-block"> list</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"#"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-add-link-type</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"occur"</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-occur-open</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span><span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Send html messages and attachments with Wanderlust
</span>  -- David Maus

<span class="italic">Note</span>: The module <span class="org-link"><a href="file:org-contrib/org-mime.org">Org-mime</a></span> in Org's contrib directory provides
similar functionality for both Wanderlust and Gnus.  The hack below is
still somewhat different: It allows you to toggle sending of html
messages within Wanderlust transparently.  I.e. html markup of the
message body is created right before sending starts.

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Send HTML message
</span>
Putting the code below in your .emacs adds following four functions:

<span class="org-list-dt">-</span> dmj/wl-send-html-message

  Function that does the job: Convert everything between "--text
  follows this line--" and first mime entity (read: attachment) or
  end of buffer into html markup using `org-export-region-as-html'
  and replaces original body with a multipart MIME entity with the
  plain text version of body and the html markup version.  Thus a
  recipient that prefers html messages can see the html markup,
  recipients that prefer or depend on plain text can see the plain
  text.

  Cannot be called interactively: It is hooked into SEMI's
  `mime-edit-translate-hook' if message should be HTML message.

<span class="org-list-dt">-</span> dmj/wl-send-html-message-draft-init

  Cannot be called interactively: It is hooked into WL's
  `wl-mail-setup-hook' and provides a buffer local variable to
  toggle.

<span class="org-list-dt">-</span> dmj/wl-send-html-message-draft-maybe

  Cannot be called interactively: It is hooked into WL's
  `wl-draft-send-hook' and hooks `dmj/wl-send-html-message' into
  `mime-edit-translate-hook' depending on whether HTML message is
  toggled on or off

<span class="org-list-dt">-</span> dmj/wl-send-html-message-toggle

  Toggles sending of HTML message.  If toggled on, the letters
  "HTML" appear in the mode line.

  Call it interactively!  Or bind it to a key in `wl-draft-mode'.

If you have to send HTML messages regularly you can set a global
variable `dmj/wl-send-html-message-toggled-p' to the string "HTML" to
toggle on sending HTML message by default.

The image <span class="kc-org-link-url"><a href="http://s11.directupload.net/file/u/15851/48ru5wl3.png">here</a></span> shows an example of how the HTML message looks like in
Google's web front end.  As you can see you have the whole markup of
Org at your service: <span class="bold">bold</span>, <span class="italic">italics</span>, tables, lists...

So even if you feel uncomfortable with sending HTML messages at least
you send HTML that looks quite good.

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">dmj/wl-send-html-message</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Send message as html message.
Convert body of message to html using
  `</span></span><span class="org-block"><span class="doc"><span class="constant">org-export-region-as-html</span></span></span><span class="org-block"><span class="doc">'."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">require</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="constant">org</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">beg end html text</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">point-min</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">re-search-forward</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"^--text follows this line--$"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">move to beginning of next line
</span></span><span class="org-block">      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">beginning-of-line</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> beg </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">not</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">re-search-forward</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"^--\\[\\["</span></span><span class="org-block"> nil t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> end </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point-max</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">line up
</span></span><span class="org-block">        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">end-of-line</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> end </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">grab body
</span></span><span class="org-block">      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> text </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">buffer-substring-no-properties</span></span><span class="org-block"> beg end</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">convert to html
</span></span><span class="org-block">      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">with-temp-buffer</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-mode</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">insert</span></span><span class="org-block"> text</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">handle signature
</span></span><span class="org-block">        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">re-search-backward</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"^-- \n"</span></span><span class="org-block"> nil t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">preserve link breaks in signature
</span></span><span class="org-block">          </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">insert</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"\n#+BEGIN_VERSE\n"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point-max</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">insert</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"\n#+END_VERSE\n"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">grab html
</span></span><span class="org-block">          </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> html </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">org-export-region-as-html
                      </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">point-min</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">point-max</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> t </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">string</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">delete-region</span></span><span class="org-block"> beg end</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">insert</span></span><span class="org-block">
       </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block">
        </span><span class="org-block"><span class="string">"--"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"&lt;&lt;alternative&gt;&gt;-{\n"</span></span><span class="org-block">
        </span><span class="org-block"><span class="string">"--"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"<a href="text/plain">[[text/plain]]</a>\n"</span></span><span class="org-block"> text
        </span><span class="org-block"><span class="string">"--"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"<a href="text/html">[[text/html]]</a>\n"</span></span><span class="org-block">  html
        </span><span class="org-block"><span class="string">"--"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"}-&lt;&lt;alternative&gt;&gt;\n"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">dmj/wl-send-html-message-toggle</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Toggle sending of html message."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> dmj/wl-send-html-message-toggled-p
        </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> dmj/wl-send-html-message-toggled-p
            nil </span><span class="org-block"><span class="string">"HTML"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">message</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Sending html message toggled %s"</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> dmj/wl-send-html-message-toggled-p
               </span><span class="org-block"><span class="string">"on"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"off"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">dmj/wl-send-html-message-draft-init</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Create buffer local settings for maybe sending html message."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">unless</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">boundp</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">dmj/wl-send-html-message-toggled-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> dmj/wl-send-html-message-toggled-p nil</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">make-variable-buffer-local</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">dmj/wl-send-html-message-toggled-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">add-to-list</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">global-mode-string</span></span><span class="org-block">
               </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="builtin">:eval</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">eq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">major-mode</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">wl-draft-mode</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                           dmj/wl-send-html-message-toggled-p</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">dmj/wl-send-html-message-maybe</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Maybe send this message as html message.

If buffer local variable `</span></span><span class="org-block"><span class="doc"><span class="constant">dmj/wl-send-html-message-toggled-p</span></span></span><span class="org-block"><span class="doc">' is
non-nil, add `</span></span><span class="org-block"><span class="doc"><span class="constant">dmj/wl-send-html-message</span></span></span><span class="org-block"><span class="doc">' to
`</span></span><span class="org-block"><span class="doc"><span class="constant">mime-edit-translate-hook</span></span></span><span class="org-block"><span class="doc">'."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> dmj/wl-send-html-message-toggled-p
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">mime-edit-translate-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">dmj/wl-send-html-message</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">remove-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">mime-edit-translate-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">dmj/wl-send-html-message</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">wl-draft-reedit-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">dmj/wl-send-html-message-draft-init</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">wl-mail-setup-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">dmj/wl-send-html-message-draft-init</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">wl-draft-send-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">dmj/wl-send-html-message-maybe</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Attach HTML of region or subtree
</span>
Instead of sending a complete HTML message you might only send parts
of an Org file as HTML for the poor souls who are plagued with
non-proportional fonts in their mail program that messes up pretty
ASCII tables.

This short function does the trick: It exports region or subtree to
HTML, prefixes it with a MIME entity delimiter and pushes to killring
and clipboard.  If a region is active, it uses the region, the
complete subtree otherwise.

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">dmj/org-export-region-as-html-attachment</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">beg end arg</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Export region between BEG and END as html attachment.
If BEG and END are not set, use current subtree.  Region or
subtree is exported to html without header and footer, prefixed
with a mime entity string and pushed to clipboard and killring.
When called with prefix, mime entity is not marked as
attachment."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"r\nP"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">beg </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">region-active-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">region-beginning</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">progn</span></span><span class="org-block">
                    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-back-to-heading</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">end </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">region-active-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">region-end</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">progn</span></span><span class="org-block">
                    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-end-of-subtree</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
                    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">html </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"--<a href="text/html&quot; (if arg &quot;&quot; &quot;\nContent-Disposition: attachment&quot;) &quot;">[[text/html"</a></span></span><span class="org-block"><a href="text/html&quot; (if arg &quot;&quot; &quot;\nContent-Disposition: attachment&quot;) &quot;">
                         </a></span><span class="org-block"><span class="rainbow-delimiters-depth-1"><a href="text/html&quot; (if arg &quot;&quot; &quot;\nContent-Disposition: attachment&quot;) &quot;">(</a></span></span><span class="org-block"><span class="keyword"><a href="text/html&quot; (if arg &quot;&quot; &quot;\nContent-Disposition: attachment&quot;) &quot;">if</a></span></span><span class="org-block"><a href="text/html&quot; (if arg &quot;&quot; &quot;\nContent-Disposition: attachment&quot;) &quot;"> arg </a></span><span class="org-block"><span class="string"><a href="text/html&quot; (if arg &quot;&quot; &quot;\nContent-Disposition: attachment&quot;) &quot;">""</a></span></span><span class="org-block"><a href="text/html&quot; (if arg &quot;&quot; &quot;\nContent-Disposition: attachment&quot;) &quot;"> </a></span><span class="org-block"><span class="string"><a href="text/html&quot; (if arg &quot;&quot; &quot;\nContent-Disposition: attachment&quot;) &quot;">"\nContent-Disposition: attachment"</a></span></span><span class="org-block"><span class="rainbow-delimiters-depth-1"><a href="text/html&quot; (if arg &quot;&quot; &quot;\nContent-Disposition: attachment&quot;) &quot;">)</a></span></span><span class="org-block"><a href="text/html&quot; (if arg &quot;&quot; &quot;\nContent-Disposition: attachment&quot;) &quot;">
                         </a></span><span class="org-block"><span class="string"><a href="text/html&quot; (if arg &quot;&quot; &quot;\nContent-Disposition: attachment&quot;) &quot;">"]]</a>\n"</span></span><span class="org-block">
                         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">org-export-region-as-html beg end t </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">string</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">fboundp</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">x-set-selection</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">ignore-errors</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">x-set-selection</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">PRIMARY</span></span><span class="org-block"> html</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">ignore-errors</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">x-set-selection</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">CLIPBOARD</span></span><span class="org-block"> html</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">message</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"html export done, pushed to kill ring and clipboard"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Adopting for Gnus
</span>
The whole magic lies in the special strings that mark a HTML
attachment.  So you might just have to find out what these special
strings are in message-mode and modify the functions accordingly.
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Add sunrise/sunset times to the agenda.
</span><span class="org-meta-line">#+index: Agenda!Diary s-expressions</span>
  -- Nick Dokos

The diary package provides the function <span class="org-verbatim">diary-sunrise-sunset</span> which can be used
in a diary s-expression in some agenda file like this:

<span class="org-block-begin-line">#+begin_src org
</span><span class="org-block"><span class="org-sexp-date">%%(diary-sunrise-sunset)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
Seb Vauban asked if it is possible to put sunrise and sunset in
separate lines. Here is a hack to do that. It adds two functions (they
have to be available before the agenda is shown, so I add them early
in my org-config file which is sourced from .emacs, but you'll have to
suit yourself here) that just parse the output of
diary-sunrise-sunset, instead of doing the right thing which would be
to take advantage of the data structures that diary/solar.el provides.
In short, a hack - so perfectly suited for inclusion here :-)

The functions (and latitude/longitude settings which you have to modify for
your location) are as follows:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> calendar-latitude </span><span class="org-block"><span class="highlight-numbers-number">48.2</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> calendar-longitude </span><span class="org-block"><span class="highlight-numbers-number">16.4</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> calendar-location-name </span><span class="org-block"><span class="string">"Vienna, Austria"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">autoload</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">solar-sunrise-sunset</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"solar.el"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">autoload</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">solar-time-string</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"solar.el"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">diary-sunrise</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Local time of sunrise as a diary entry.
The diary entry can contain `</span></span><span class="org-block"><span class="doc"><span class="constant">%s</span></span></span><span class="org-block"><span class="doc">' which will be replaced with
`</span></span><span class="org-block"><span class="doc"><span class="constant">calendar-location-name</span></span></span><span class="org-block"><span class="doc">'."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">l </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">solar-sunrise-sunset date</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> l</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block">
       </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">string=</span></span><span class="org-block"> entry </span><span class="org-block"><span class="string">""</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
           </span><span class="org-block"><span class="string">"Sunrise"</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">format</span></span><span class="org-block"> entry </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">eval</span></span><span class="org-block"> calendar-location-name</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">" "</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">solar-time-string </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">caar</span></span><span class="org-block"> l</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> nil</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">diary-sunset</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Local time of sunset as a diary entry.
The diary entry can contain `</span></span><span class="org-block"><span class="doc"><span class="constant">%s</span></span></span><span class="org-block"><span class="doc">' which will be replaced with
`</span></span><span class="org-block"><span class="doc"><span class="constant">calendar-location-name</span></span></span><span class="org-block"><span class="doc">'."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">l </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">solar-sunrise-sunset date</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">cadr</span></span><span class="org-block"> l</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block">
       </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">string=</span></span><span class="org-block"> entry </span><span class="org-block"><span class="string">""</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
           </span><span class="org-block"><span class="string">"Sunset"</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">format</span></span><span class="org-block"> entry </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">eval</span></span><span class="org-block"> calendar-location-name</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">" "</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">solar-time-string </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">caadr</span></span><span class="org-block"> l</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> nil</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
You also need to add a couple of diary s-expressions in one of your agenda
files:

<span class="org-block-begin-line">#+begin_src org
</span><span class="org-block"><span class="org-sexp-date">%%(diary-sunrise)Sunrise in %s</span></span><span class="org-block">
</span><span class="org-block"><span class="org-sexp-date">%%(diary-sunset)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
This will show sunrise with the location and sunset without it.

The thread on the mailing list that started this can be found <span class="kc-org-link-url"><a href="https://orgmode.org/list/87oc5rlwc4.wl%lists@700c.org">here</a></span>.
In comparison to the version posted on the mailing list, this one
gets rid of the timezone information and can show the location.
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Add lunar phases to the agenda.
</span><span class="org-meta-line">#+index: Agenda!Diary s-expressions</span>
   -- R&#252;diger

Emacs comes with <span class="org-verbatim">lunar.el</span> to display the lunar phases (<span class="org-verbatim">M-x lunar-phases</span>).
This can be used to display lunar phases in the agenda display with the
following function:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">require</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="constant">cl-lib</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-no-warnings</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">date</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-lunar-phases</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Show lunar phase in Agenda buffer."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">require</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="constant">lunar</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">phase-list </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">lunar-phase-list </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">nth</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"> date</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">nth</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"> date</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">phase </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">cl-find-if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">phase</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">equal</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">car</span></span><span class="org-block"> phase</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> date</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                            phase-list</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> phase
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> ret </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">lunar-phase-name </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">nth</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"> phase</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">" "</span></span><span class="org-block">
                        </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">substring</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">nth</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"> phase</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">5</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
Add the following line to an agenda file:

<span class="org-block-begin-line">#+begin_src org
</span><span class="org-block">,* Lunar phase
,#+CATEGORY: Lunar
</span><span class="org-block"><span class="org-sexp-date">%%(org-lunar-phases)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
This should display an entry on new moon, first/last quarter moon, and on full
moon.  You can customize the entries by customizing <span class="org-verbatim">lunar-phase-names</span>.

E.g., to add Unicode symbols:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> lunar-phase-names
      </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="string">"&#9679; New Moon"</span></span><span class="org-block"> </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">Unicode symbol: &#127761; Use full circle as fallback
</span></span><span class="org-block">        </span><span class="org-block"><span class="string">"&#9789; First Quarter Moon"</span></span><span class="org-block">
        </span><span class="org-block"><span class="string">"&#9675; Full Moon"</span></span><span class="org-block"> </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">Unicode symbol: &#127765; Use empty circle as fallback
</span></span><span class="org-block">        </span><span class="org-block"><span class="string">"&#9790; Last Quarter Moon"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
Unicode 6 even provides symbols for the Moon with nice faces.  But those
symbols are currently barely supported in fonts.
See <span class="kc-org-link-url"><a href="https://en.wikipedia.org/wiki/Astronomical_symbols#Moon">Astronomical symbols on Wikipedia</a></span>.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Export BBDB contacts to org-contacts.el
</span><span class="org-meta-line">#+index: Address Book!BBDB to org-contacts</span>
Try this tool by Wes Hardaker:

<span class="kc-org-link-url"><a href="http://www.hardakers.net/code/bbdb-to-org-contacts/">http://www.hardakers.net/code/bbdb-to-org-contacts/</a></span>

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Calculating date differences - how to write a simple elisp function
</span><span class="org-meta-line">#+index: Timestamp!date calculations</span>
<span class="org-meta-line">#+index: Elisp!technique</span>

Alexander Wing&#229;rd asked how to calculate the number of days between a
time stamp in his org file and today (see
<span class="kc-org-link-url"><a href="https://orgmode.org/list/064758C1-8D27-4647-A3C2-AB35FB8C6215@gmail.com">https://orgmode.org/list/064758C1-8D27-4647-A3C2-AB35FB8C6215@gmail.com</a></span>  Although the
resulting answer is probably not of general interest, the method might
be useful to a budding Elisp programmer.

Alexander started from an already existing org function,
<span class="org-verbatim">org-evaluate-time-range</span>.  When this function is called in the context
of a time range (two time stamps separated by "<span class="org-verbatim">--</span>"), it calculates the
number of days between the two dates and outputs the result in Emacs's
echo area. What he wanted was a similar function that, when called from
the context of a single time stamp, would calculate the number of days
between the date in the time stamp and today. The result should go to
the same place: Emacs's echo area.

The solution presented in the mail thread is as follows:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">aw/org-evaluate-time-range</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="type">&amp;optional</span></span><span class="org-block"> to-buffer</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-at-date-range-p</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-evaluate-time-range</span></span><span class="org-block"> to-buffer</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">otherwise, make a time range in a temp buffer and run o-e-t-r there
</span></span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">headline </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">buffer-substring</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point-at-bol</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point-at-eol</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">with-temp-buffer</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">insert</span></span><span class="org-block"> headline</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point-at-bol</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">re-search-forward</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-ts-regexp</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point-at-eol</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">not</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">org-at-timestamp-p</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">error</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"No timestamp here"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">match-beginning</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-insert-time-stamp</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">current-time</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> nil nil</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">insert</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"--"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-evaluate-time-range</span></span><span class="org-block"> to-buffer</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
The function assumes that point is on some line with some time stamp
(or a date range) in it. Note that <span class="org-verbatim">org-evaluate-time-range</span> does not care
whether the first date is earlier than the second: it will always output
the number of days between the earlier date and the later date.

As stated before, the function itself is of limited interest (although
it satisfied Alexander's need).The <span class="bold">method</span> used might be of wider
interest however, so here is a short explanation.

The idea is that we want <span class="org-verbatim">org-evaluate-time-range</span> to do all the
heavy lifting, but that function requires that it be in a date-range
context. So the function first checks whether it's in a date range
context already: if so, it calls <span class="org-verbatim">org-evaluate-time-range</span> directly
to do the work. The trick now is to arrange things so we can call this
same function in the case where we do <span class="bold">not</span> have a date range
context. In that case, we manufacture one: we create a temporary
buffer, copy the line with the purported time stamp to the temp
buffer, find the time stamp (signal an error if no time stamp is
found) and insert a new time stamp with the current time before the
existing time stamp, followed by "<span class="org-verbatim">--": voil&#224;, we now have a time range
on which we can apply our old friend </span><span class="org-verbatim"><span class="org-verbatim">org-evaluate-time-range</span></span> to
produce the answer. Because of the above-mentioned property
of <span class="org-verbatim">org-evaluate-time-range</span>, it does not matter if the existing
time stamp is earlier or later than the current time: the correct
number of days is output.

Note that at the end of the call to <span class="org-verbatim">with-temp-buffer</span>, the temporary
buffer goes away.  It was just used as a scratch pad for the function
to do some figuring.

The idea of using a temp buffer as a scratch pad has wide
applicability in Emacs programming. The rest of the work is knowing
enough about facilities provided by Emacs (e.g. regexp searching) and
by Org (e.g. checking for time stamps and generating a time stamp) so
that you don't reinvent the wheel, and impedance-matching between the
various pieces.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> ibuffer and org files
</span>
Neil Smithline posted this snippet to let you browse org files with
<span class="org-verbatim">ibuffer</span>:

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">require</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="constant">ibuffer</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-ibuffer</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Open an `</span></span><span class="org-block"><span class="doc"><span class="constant">ibuffer</span></span></span><span class="org-block"><span class="doc">' window showing only `</span></span><span class="org-block"><span class="doc"><span class="constant">org-mode</span></span></span><span class="org-block"><span class="doc">' buffers."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">ibuffer</span></span><span class="org-block"> nil </span><span class="org-block"><span class="string">"*Org Buffers*"</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">used-mode . org-mode</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Enable org-mode links in other modes
</span>
Sean O'Halpin wrote a minor mode for this, please check it <span class="kc-org-link-url"><a href="https://github.com/seanohalpin/org-link-minor-mode">here</a></span>.

See the relevant discussion <span class="kc-org-link-url"><a href="https://orgmode.org/list/CAOXM+eX-xkGu4B8c=9RLQ+959Sn050wtqSHO2fqhFQX4X5c53A@mail.gmail.com">here</a></span>.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> poporg.el: edit comments in org-mode
</span>
<span class="kc-org-link-url"><a href="https://github.com/QBobWatson/poporg/blob/master/poporg.el">poporg.el</a></span> is a library by Fran&#231;ois Pinard which lets you edit comments
and strings from your code using a separate org-mode buffer.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Convert a .csv file to an Org-mode table
</span>
Nicolas Richard has a <span class="kc-org-link-url"><a href="https://orgmode.org/list/87a9rpy1x2.fsf@yahoo.fr">nice recipe</a></span> using the pcsv library (<span class="kc-org-link-url"><a href="http://marmalade-repo.org/packages/pcsv">available</a></span> from
the Marmelade ELPA repository):

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">yf/lisp-table-to-org-table</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">table </span><span class="org-block"><span class="type">&amp;optional</span></span><span class="org-block"> function</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Convert a lisp table to `</span></span><span class="org-block"><span class="doc"><span class="constant">org-mode</span></span></span><span class="org-block"><span class="doc">' syntax, applying FUNCTION to each of its elements.
The elements should not have any more newlines in them after
applying FUNCTION ; the default converts them to spaces. Return
value is a string containg the unaligned `</span></span><span class="org-block"><span class="doc"><span class="constant">org-mode</span></span></span><span class="org-block"><span class="doc">' table."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">unless</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">functionp</span></span><span class="org-block"> function</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> function </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">x</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">replace-regexp-in-string</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"\n"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">" "</span></span><span class="org-block"> x</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">mapconcat</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">x</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">                </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">x is a line.
</span></span><span class="org-block">               </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"| "</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">mapconcat</span></span><span class="org-block"> function x </span><span class="org-block"><span class="string">" | "</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">" |"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
             table </span><span class="org-block"><span class="string">"\n"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">yf/csv-to-table</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">beg end</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
</span><span class="org-block"><span class="doc">"Convert a csv file to an `</span></span><span class="org-block"><span class="doc"><span class="constant">org-mode</span></span></span><span class="org-block"><span class="doc">' table."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"r"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">require</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="constant">pcsv</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">insert</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">yf/lisp-table-to-org-table </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">pcsv-parse-region beg end</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">delete-region</span></span><span class="org-block"> beg end</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-table-align</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Don't let visual-line-mode shadow org special commands
</span>
<span class="org-verbatim">M-x visual-line-mode RET</span> will use <span class="org-code">beginning-of-visual-line</span>,
<span class="org-code">end-of-visual-line</span>, and <span class="org-code">kill-visual-line</span> instead of
<span class="org-code">org-beginning-of-line</span>, <span class="org-code">org-end-of-line</span>, and <span class="org-code">org-kill-line</span>, while 
those might be preferred in an Org buffer.

To avoid this, you can use this hack:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">visual-line-mode-hook</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">()</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">derived-mode-p</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-mode</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
                       </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">local-set-key</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">kbd</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"C-a"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote"><span class="org-tag">#'</span></span></span><span class="org-block"><span class="highlight-quoted-symbol"><span class="org-tag">org-beginning-of-line</span></span></span><span class="org-block"><span class="rainbow-delimiters-depth-1"><span class="org-tag">)</span></span></span><span class="org-block">
                       </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">local-set-key</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">kbd</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"C-e"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote"><span class="org-tag">#'</span></span></span><span class="org-block"><span class="highlight-quoted-symbol"><span class="org-tag">org-end-of-line</span></span></span><span class="org-block"><span class="rainbow-delimiters-depth-1"><span class="org-tag">)</span></span></span><span class="org-block">
                       </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">local-set-key</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">kbd</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"C-k"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote"><span class="org-tag">#'</span></span></span><span class="org-block"><span class="highlight-quoted-symbol"><span class="org-tag">org-kill-line</span></span></span><span class="org-block"><span class="rainbow-delimiters-depth-1"><span class="org-tag">)</span></span></span><span class="org-block"><span class="rainbow-delimiters-depth-3"><span class="org-tag">)</span></span></span><span class="org-block"><span class="rainbow-delimiters-depth-2"><span class="org-tag">)</span></span></span><span class="org-block"><span class="rainbow-delimiters-depth-1"><span class="org-tag">)</span></span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
See <span class="kc-org-link-url"><a href="https://orgmode.org/list/87zh7jfyal.fsf@gmail.com/">this discussion</a></span>.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> foldout.el
</span>
<span class="org-code">foldout.el</span>, which is part of Emacs, is a nice little companion for
<span class="org-code">outline-mode</span>.  With <span class="org-code">foldout.el</span> one can narrow to a subtree and
later unnarrow.  <span class="org-code">foldout.el</span> is useful for Org mode out of the box.

There is one annoyance though (at least for me):
<span class="org-code">foldout-zoom-subtree</span> opens the drawers.

This can be fixed e.g. by using the following slightly modified
version of <span class="org-code">foldout-zoom-subtree</span> which uses function <span class="org-code">org-show-entry</span>
instead of <span class="org-code">outline-show-entry</span>.

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">foldout-zoom-org-subtree</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="type">&amp;optional</span></span><span class="org-block"> exposure</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Same as `</span></span><span class="org-block"><span class="doc"><span class="constant">foldout-zoom-subtree</span></span></span><span class="org-block"><span class="doc">' with often nicer zoom in Org mode."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"P"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">cl-letf</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">symbol-function</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote"><span class="org-tag">#'</span></span></span><span class="org-block"><span class="highlight-quoted-symbol"><span class="org-tag">outline-show-entry</span></span></span><span class="org-block"><span class="rainbow-delimiters-depth-2"><span class="org-tag">)</span></span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">lambda</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">()</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-show-entry</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">foldout-zoom-subtree exposure</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span><span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Integrate Org Capture with YASnippet and Yankpad
</span>
Org Capture allows you to quickly store a note. You can mix the Org
Capture template system with those of <span class="kc-org-link-url"><a href="https://github.com/joaotavora/yasnippet">YASnippet</a></span> and <span class="kc-org-link-url"><a href="https://github.com/Kungsgeten/yankpad">Yankpad</a></span>.

Check out the repository for how to do it: <span class="kc-org-link-url"><a href="https://github.com/ag91/ya-org-capture">https://github.com/ag91/ya-org-capture</a></span>.

A screencast that show the hack in action is <span class="kc-org-link-url"><a href="https://github.com/ag91/ya-org-capture/blob/master/ya-org-capture-screehcast.gif">here</a></span>. And a blog post
describing this in more detail is <span class="kc-org-link-url"><a href="https://ag91.github.io/blog/2020/07/28/how-to-integrate-yasnippet-and-yankpad-with-org-capture/">here</a></span>.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Slack messages as TODOs in your Org Agenda
</span>
Too many Slack messages reach you? Keep track of them in your Org
Agenda! With this hack you can mix the power of the <span class="kc-org-link-url"><a href="https://github.com/yuya373/emacs-slack">Emacs Slack</a></span> client
and the order of Org mode.

Try this by running the code at:
<span class="kc-org-link-url"><a href="https://github.com/ag91/emacs-slack-org-mode-example">https://github.com/ag91/emacs-slack-org-mode-example</a></span>

Also a blog post that describes in detail how this works is <span class="kc-org-link-url"><a href="https://ag91.github.io/blog/2020/08/14/slack-messages-in-your-org-agenda/">here</a></span>.

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Hacking Org: Working with Org-mode and External Programs
</span><span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Use Org-mode with Screen [Andrew Hyatt]
</span><span class="org-meta-line">#+index: Link!to screen session</span>
"The general idea is that you start a task in which all the work will
take place in a shell.  This usually is not a leaf-task for me, but
usually the parent of a leaf task.  From a task in your org-file, M-x
ash-org-screen will prompt for the name of a session.  Give it a name,
and it will insert a link.  Open the link at any time to go the screen
session containing your work!"

<span class="kc-org-link-url"><a href="https://orgmode.org/list/c8389b600801271541h4c68e70du589547ea5e8bd52f@mail.gmail.com">https://orgmode.org/list/c8389b600801271541h4c68e70du589547ea5e8bd52f@mail.gmail.com</a></span>

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">require</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="constant">term</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">ash-org-goto-screen</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">name</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Open the screen with the specified name in the window"</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"MScreen name: "</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">screen-buffer-name </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">ash-org-screen-buffer-name name</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">member</span></span><span class="org-block"> screen-buffer-name
                </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">mapcar</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">buffer-name</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">buffer-list</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">switch-to-buffer</span></span><span class="org-block"> screen-buffer-name</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">switch-to-buffer</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">ash-org-screen-helper name </span><span class="org-block"><span class="string">"-dr"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">ash-org-screen-buffer-name</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">name</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Returns the buffer name corresponding to the screen name given."</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"*screen "</span></span><span class="org-block"> name </span><span class="org-block"><span class="string">"*"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">ash-org-screen-helper</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">name arg</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Pick the name of the new buffer.
</span></span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="variable-name">term-ansi-buffer-name</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">generate-new-buffer-name</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">ash-org-screen-buffer-name name</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">term-ansi-buffer-name</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">term-ansi-make-term</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">   </span><span class="org-block"><span class="variable-name">term-ansi-buffer-name</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"/usr/bin/screen"</span></span><span class="org-block"> nil arg name</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">set-buffer</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">term-ansi-buffer-name</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">term-mode</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">term-char-mode</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">term-set-escape-char</span></span><span class="org-block"> ?\C-x</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="variable-name">term-ansi-buffer-name</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">ash-org-screen</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">name</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="doc">"Start a screen session with name"</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"MScreen name: "</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">ash-org-screen-helper name </span><span class="org-block"><span class="string">"-S"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">insert-string </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"<a href="screen:&quot; name &quot;">[[screen:"</a></span></span><span class="org-block"><a href="screen:&quot; name &quot;"> name </a></span><span class="org-block"><span class="string"><a href="screen:&quot; name &quot;">"]]</a>"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">And don't forget to add ("screen" . "elisp:(ash-org-goto-screen
</span></span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">\"%s\")") to org-link-abbrev-alist.
</span></span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Org Agenda + Appt + Zenity
</span>    <span class="org-drawer">:PROPERTIES:</span>
    <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">org-agenda-appt-zenity</span>
    <span class="org-drawer">:END:</span>

<span class="org-meta-line">#+index: Appointment!reminders</span>
<span class="org-meta-line">#+index: Appt!Zenity</span>
<span class="org-block-begin-line">#+BEGIN_EXPORT HTML
</span>&lt;a name="agenda-appt-zenity"&gt;&lt;/a&gt;
<span class="org-block-end-line">#+END_EXPORT
</span>Russell Adams posted this setup <span class="kc-org-link-url"><a href="https://orgmode.org/list/20080302101346.GB18852@odin.demosthenes.org">on the list</a></span>.  It makes sure your agenda
appointments are known by Emacs, and it displays warnings in a <span class="kc-org-link-url"><a href="http://live.gnome.org/Zenity">zenity</a></span>
popup window.

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block"><span class="comment-delimiter">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">For org appointment reminders
</span></span><span class="org-block">
</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Get appointments for today
</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my-org-agenda-to-appt</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> appt-time-msg-list nil</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="variable-name">org-deadline-warning-days</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">will be automatic in org 5.23
</span></span><span class="org-block">        </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-agenda-to-appt</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Run once, activate and schedule refresh
</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">my-org-agenda-to-appt</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">appt-activate</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">run-at-time</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"24:01"</span></span><span class="org-block"> nil </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">my-org-agenda-to-appt</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">5 minute warnings
</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> appt-message-warning-time </span><span class="org-block"><span class="highlight-numbers-number">15</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> appt-display-interval </span><span class="org-block"><span class="highlight-numbers-number">5</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">Update appt each time agenda opened.
</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-finalize-agenda-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">my-org-agenda-to-appt</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">Setup zenify, we tell appt to use window, and replace default function
</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> appt-display-format </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">window</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> appt-disp-window-function </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">function</span></span><span class="org-block"> my-appt-disp-window</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my-appt-disp-window</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">min-to-app new-time msg</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">save-window-excursion</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">shell-command</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block">
    </span><span class="org-block"><span class="string">"/usr/bin/zenity --info --title='Appointment' --text='"</span></span><span class="org-block">
    msg </span><span class="org-block"><span class="string">"' &amp;"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="warning-1">nil nil</span></span><span class="org-block"><span class="warning-1"><span class="rainbow-delimiters-depth-3">)</span></span></span><span class="org-block"><span class="warning-1"><span class="rainbow-delimiters-depth-2">)</span></span></span><span class="org-block"><span class="warning-1"><span class="rainbow-delimiters-depth-1">)</span></span></span><span class="org-block">
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Org and appointment notifications on Mac OS 10.8
</span>
Sarah Bagby <span class="kc-org-link-url"><a href="http://mid.gmane.org/EA76104A-9ACD-4141-8D33-2E4D810D9B5A@geol.ucsb.edu">posted some code</a></span> on how to get appointments notifications on
Mac OS 10.8 with <span class="kc-org-link-url"><a href="https://github.com/alloy/terminal-notifier">terminal-notifier</a></span>.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Org-Mode + gnome-osd
</span><span class="org-meta-line">#+index: Appointment!reminders</span>
<span class="org-meta-line">#+index: Appt!gnome-osd</span>
Richard Riley uses gnome-osd in interaction with Org-Mode to display
appointments.  You can look at the code on the <span class="kc-org-link-url"><a href="http://www.emacswiki.org/emacs-en/OrgMode-OSD">emacswiki</a></span>.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> txt2org convert text data to org-mode tables
</span>From Eric Schulte

I often find it useful to generate Org-mode tables on the command line
from tab-separated data.  The following awk script makes this easy to
do.  Text data is read from STDIN on a pipe and any command line
arguments are interpreted as rows at which to insert hlines.

Here are two usage examples.
<span class="org-list-dt">1.</span> running the following
   <span class="org-code">: $ cat &lt;&lt;EOF|~/src/config/bin/txt2org
</span>   <span class="org-code">: one 1
</span>   <span class="org-code">: two 2
</span>   <span class="org-code">: three 3
</span>   <span class="org-code">: twenty 20
</span>   <span class="org-code">: EOF
</span>   results in
   <span class="org-code">: |    one |  1 |
</span>   <span class="org-code">: |    two |  2 |
</span>   <span class="org-code">: |  three |  3 |
</span>   <span class="org-code">: | twenty | 20 |
</span>
<span class="org-list-dt">2.</span> and the following (notice the command line argument)
   <span class="org-code">: $ cat &lt;&lt;EOF|~/src/config/bin/txt2org 1
</span>   <span class="org-code">: strings numbers
</span>   <span class="org-code">: one 1
</span>   <span class="org-code">: two 2
</span>   <span class="org-code">: three 3
</span>   <span class="org-code">: twenty 20
</span>   <span class="org-code">: EOF
</span>   results in
   <span class="org-code">: | strings | numbers |
</span>   <span class="org-code">: |---------+---------|
</span>   <span class="org-code">: |     one |       1 |
</span>   <span class="org-code">: |     two |       2 |
</span>   <span class="org-code">: |   three |       3 |
</span>   <span class="org-code">: |  twenty |      20 |
</span>
Here is the script itself
<span class="org-block-begin-line">#+begin_src awk
</span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter"><span class="org-tag">#</span></span></span><span class="org-block"><span class="comment"><span class="org-tag">!/usr/bin/gawk</span></span></span><span class="org-block"><span class="comment"> -f
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">#</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">Read tab separated data from STDIN and output an Org-mode table.
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">#</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">Optional command line arguments specify row numbers at which to
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">insert hlines.
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">#</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block">  </span><span class="org-block"><span class="keyword">BEGIN</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">{</span></span><span class="org-block">
      </span><span class="org-block"><span class="keyword">for</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">i=</span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block">; i&lt;</span><span class="org-block"><span class="variable-name">ARGC</span></span><span class="org-block">; i++</span><span class="org-block"><span class="rainbow-delimiters-depth-2">){</span></span><span class="org-block">
          hlines</span><span class="org-block"><span class="rainbow-delimiters-depth-3">[</span></span><span class="org-block"><span class="variable-name">ARGV</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">[</span></span><span class="org-block">i</span><span class="org-block"><span class="rainbow-delimiters-depth-1">]</span></span><span class="org-block">+</span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">]</span></span><span class="org-block">=</span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block">; </span><span class="org-block"><span class="variable-name">ARGV</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">[</span></span><span class="org-block">i</span><span class="org-block"><span class="rainbow-delimiters-depth-3">]</span></span><span class="org-block"> = </span><span class="org-block"><span class="string">"-"</span></span><span class="org-block">; </span><span class="org-block"><span class="rainbow-delimiters-depth-2">}</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">}</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">{</span></span><span class="org-block">
      </span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="variable-name">NF</span></span><span class="org-block"> &gt; max_nf</span><span class="org-block"><span class="rainbow-delimiters-depth-2">){</span></span><span class="org-block"> max_nf = </span><span class="org-block"><span class="variable-name">NF</span></span><span class="org-block">; </span><span class="org-block"><span class="rainbow-delimiters-depth-2">}</span></span><span class="org-block">;
      </span><span class="org-block"><span class="keyword">for</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">f=</span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block">; f&lt;=</span><span class="org-block"><span class="variable-name">NF</span></span><span class="org-block">; f++</span><span class="org-block"><span class="rainbow-delimiters-depth-2">){</span></span><span class="org-block">
          </span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="preprocessor">length</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">$f</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> &gt; lengths</span><span class="org-block"><span class="rainbow-delimiters-depth-1">[</span></span><span class="org-block">f</span><span class="org-block"><span class="rainbow-delimiters-depth-1">]</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">){</span></span><span class="org-block"> lengths</span><span class="org-block"><span class="rainbow-delimiters-depth-1">[</span></span><span class="org-block">f</span><span class="org-block"><span class="rainbow-delimiters-depth-1">]</span></span><span class="org-block"> = </span><span class="org-block"><span class="preprocessor">length</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">$f</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">; </span><span class="org-block"><span class="rainbow-delimiters-depth-3">}</span></span><span class="org-block">;
          row</span><span class="org-block"><span class="rainbow-delimiters-depth-3">[</span></span><span class="org-block"><span class="variable-name">NR</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">][</span></span><span class="org-block">f</span><span class="org-block"><span class="rainbow-delimiters-depth-3">]</span></span><span class="org-block">=$f; </span><span class="org-block"><span class="rainbow-delimiters-depth-2">}</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">}</span></span><span class="org-block">

  </span><span class="org-block"><span class="keyword">END</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">{</span></span><span class="org-block">
      hline_str=</span><span class="org-block"><span class="string">"|"</span></span><span class="org-block">
      </span><span class="org-block"><span class="keyword">for</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">f=</span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block">; f&lt;=max_nf; f++</span><span class="org-block"><span class="rainbow-delimiters-depth-2">){</span></span><span class="org-block">
          </span><span class="org-block"><span class="keyword">for</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">i=</span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block">; i&lt;</span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">lengths</span><span class="org-block"><span class="rainbow-delimiters-depth-2">[</span></span><span class="org-block">f</span><span class="org-block"><span class="rainbow-delimiters-depth-2">]</span></span><span class="org-block"> + </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">; i++</span><span class="org-block"><span class="rainbow-delimiters-depth-3">){</span></span><span class="org-block"> hline_str=hline_str </span><span class="org-block"><span class="string">"-"</span></span><span class="org-block">; </span><span class="org-block"><span class="rainbow-delimiters-depth-3">}</span></span><span class="org-block">
          </span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"> f != max_nf</span><span class="org-block"><span class="rainbow-delimiters-depth-3">){</span></span><span class="org-block"> hline_str=hline_str </span><span class="org-block"><span class="string">"+"</span></span><span class="org-block">; </span><span class="org-block"><span class="rainbow-delimiters-depth-3">}</span></span><span class="org-block">
          </span><span class="org-block"><span class="keyword">else</span></span><span class="org-block">            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">{</span></span><span class="org-block"> hline_str=hline_str </span><span class="org-block"><span class="string">"|"</span></span><span class="org-block">; </span><span class="org-block"><span class="rainbow-delimiters-depth-3">}</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">}</span></span><span class="org-block">

      </span><span class="org-block"><span class="keyword">for</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">r=</span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block">; r&lt;=</span><span class="org-block"><span class="variable-name">NR</span></span><span class="org-block">; r++</span><span class="org-block"><span class="rainbow-delimiters-depth-2">){</span></span><span class="org-block"> </span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">rows
</span></span><span class="org-block">          </span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">hlines</span><span class="org-block"><span class="rainbow-delimiters-depth-1">[</span></span><span class="org-block">r</span><span class="org-block"><span class="rainbow-delimiters-depth-1">]</span></span><span class="org-block"> == </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">){</span></span><span class="org-block"> </span><span class="org-block"><span class="preprocessor">print</span></span><span class="org-block"> hline_str; </span><span class="org-block"><span class="rainbow-delimiters-depth-3">}</span></span><span class="org-block">
          </span><span class="org-block"><span class="preprocessor">printf</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"|"</span></span><span class="org-block">;
          </span><span class="org-block"><span class="keyword">for</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">f=</span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block">; f&lt;=max_nf; f++</span><span class="org-block"><span class="rainbow-delimiters-depth-3">){</span></span><span class="org-block"> </span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">columns
</span></span><span class="org-block">              cell=row</span><span class="org-block"><span class="rainbow-delimiters-depth-1">[</span></span><span class="org-block">r</span><span class="org-block"><span class="rainbow-delimiters-depth-1">][</span></span><span class="org-block">f</span><span class="org-block"><span class="rainbow-delimiters-depth-1">]</span></span><span class="org-block">; padding=</span><span class="org-block"><span class="string">""</span></span><span class="org-block">
              </span><span class="org-block"><span class="keyword">for</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">i=</span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block">; i&lt;</span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">lengths</span><span class="org-block"><span class="rainbow-delimiters-depth-3">[</span></span><span class="org-block">f</span><span class="org-block"><span class="rainbow-delimiters-depth-3">]</span></span><span class="org-block"> - </span><span class="org-block"><span class="preprocessor">length</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">cell</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">; i++</span><span class="org-block"><span class="rainbow-delimiters-depth-1">){</span></span><span class="org-block"> padding=padding </span><span class="org-block"><span class="string">" "</span></span><span class="org-block">; </span><span class="org-block"><span class="rainbow-delimiters-depth-1">}</span></span><span class="org-block">
              </span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">for now just print everything right-aligned
</span></span><span class="org-block">              </span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">if(cell ~ /[0-9.]/){ printf " %s%s |", cell, padding; }
</span></span><span class="org-block">              </span><span class="org-block"><span class="comment-delimiter"># </span></span><span class="org-block"><span class="comment">else{                printf " %s%s |", padding, cell; }
</span></span><span class="org-block">              </span><span class="org-block"><span class="preprocessor">printf</span></span><span class="org-block"> </span><span class="org-block"><span class="string">" %s%s |"</span></span><span class="org-block">, padding, cell; </span><span class="org-block"><span class="rainbow-delimiters-depth-3">}</span></span><span class="org-block">
          </span><span class="org-block"><span class="preprocessor">printf</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"\n"</span></span><span class="org-block">; </span><span class="org-block"><span class="rainbow-delimiters-depth-2">}</span></span><span class="org-block">

      </span><span class="org-block"><span class="keyword">if</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">hlines</span><span class="org-block"><span class="rainbow-delimiters-depth-3">[</span></span><span class="org-block"><span class="variable-name">NR</span></span><span class="org-block">+</span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">]</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">){</span></span><span class="org-block"> </span><span class="org-block"><span class="preprocessor">print</span></span><span class="org-block"> hline_str; </span><span class="org-block"><span class="rainbow-delimiters-depth-2">}</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">}</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> remind2org
</span><span class="org-meta-line">#+index: Agenda!Views</span>
<span class="org-meta-line">#+index: Agenda!and Remind (external program)</span>
From Detlef Steuer

<span class="kc-org-link-url"><a href="https://orgmode.org/list/20080112175502.0fb06b66@linux.site">https://orgmode.org/list/20080112175502.0fb06b66@linux.site</a></span>

<span class="org-block-begin-line">#+BEGIN_QUOTE
</span><span class="org-quote">Remind (</span><span class="org-quote"><span class="kc-org-link-url"><a href="http://www.roaringpenguin.com/products/remind">http://www.roaringpenguin.com/products/remin</a><a href="http://www.roaringpenguin.com/products/remind">d</a></span></span><span class="org-quote">) is a very powerful
command line calendaring program. Its features supersede the possibilities
of orgmode in the area of date specifying, so that I want to use it
combined with orgmode.

Using the script below I'm able use remind and incorporate its output in my
agenda views.  The default of using 13 months look ahead is easily
changed. It just happens I sometimes like to look a year into the
future. :-)
</span><span class="org-block-end-line">#+END_QUOTE
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Useful webjumps for conkeror
</span><span class="org-meta-line">#+index: Shortcuts!conkeror</span>
If you are using the <span class="kc-org-link-url"><a href="http://conkeror.org">conkeror browser</a></span>, maybe you want to put this into
your <span class="org-verbatim">~/.conkerorrc</span> file:

<span class="org-block-begin-line">#+begin_example
</span><span class="custom">define_webjump("orglist", "<a href="http://search.gmane.org/?query=%s&amp;group=gmane.emacs.orgmode">http://search.gmane.org/?query=%s&amp;group=gmane.emacs.orgmode</a>");
define_webjump("worg", "<a href="http://www.google.com/cse?cx=002987994228320350715%3Az4glpcrritm&amp;ie=UTF-8&amp;q=%s&amp;sa=Search&amp;siteurl=orgmode.org%2Fworg%2F">http://www.google.com/cse?cx=002987994228320350715%3Az4glpcrritm&amp;ie=UTF-8&amp;q=%s&amp;sa=Search&amp;siteurl=orgmode.org%2Fworg%2F</a>");
</span><span class="org-block-end-line">#+end_example
</span>
It creates two <span class="kc-org-link-url"><a href="http://conkeror.org/Webjumps">webjumps</a></span> for easily searching the Worg website and the
Org-mode mailing list.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Use MathJax for HTML export without requiring JavaScript
</span><span class="org-meta-line">#+index: Export!MathJax</span>
As of 2010-08-14, MathJax is the default method used to export math to HTML.

If you like the results but do not want JavaScript in the exported pages,
check out <span class="kc-org-link-url"><a href="http://www.jboecker.de/2010/08/15/staticmathjax.html">Static MathJax</a></span>, a XULRunner application which generates a static
HTML file from the exported version. It can also embed all referenced fonts
within the HTML file itself, so there are no dependencies to external files.

The download archive contains an elisp file which integrates it into the Org
export process (configurable per file with a "#+StaticMathJax:" line).

Read README.org and the comments in org-static-mathjax.el for usage instructions.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Use checkboxes and progress cookies in HTML generated from Org
</span><span class="org-meta-line">#+index: Export!HTML!Checkboxes</span>
If you want to have dynamically-updated progress cookies for lists
with checkboxes in an HTML document exported from Org, <span class="kc-org-link-url"><a href="https://lists.gnu.org/archive/html/emacs-orgmode/2020-06/msg00323.html">this mailing
list thread</a></span> contains a (partial) Javascript solution.

Note that the Javascript depends on the default HTML structure
generated by Org at the time (the maint branch somewhere between 9.3
and 9.4), so the code won't work without modification if you customize
HTML output or if Org's default HTML export changes.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Search Org files using lgrep
</span><span class="org-meta-line">#+index: search!lgrep</span>
Matt Lundin suggests this:

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my-org-grep</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">search</span></span><span class="org-block"> </span><span class="org-block"><span class="type">&amp;optional</span></span><span class="org-block"> context</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Search for word in org files.

Prefix argument determines number of lines."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"sSearch for: \nP"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="variable-name">grep-find-ignored-files</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="string">"#*"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">".#*"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="whitespace-tab">        </span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="variable-name">grep-template</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"grep &lt;X&gt; -i -nH "</span></span><span class="org-block">
</span><span class="whitespace-tab">                                </span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> context
</span><span class="whitespace-tab">                                </span><span class="org-block">   </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"-C"</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">number-to-string</span></span><span class="org-block"> context</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
</span><span class="whitespace-tab">                                </span><span class="org-block"> </span><span class="org-block"><span class="string">" -e &lt;R&gt; &lt;F&gt;"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">lgrep</span></span><span class="org-block"> search </span><span class="org-block"><span class="string">"*org*"</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"/home/matt/org/"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">global-set-key</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">kbd</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"&lt;f8&gt;"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">my-org-grep</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Automatic screenshot insertion
</span><span class="org-meta-line">#+index: Link!screenshot</span>
Suggested by Russell Adams

<span class="org-block-begin-line">#+begin_src emacs-lisp
</span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">my-org-screenshot</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Take a screenshot into a time stamped unique-named file in the
  same directory as the org-buffer and insert a link to this file."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">interactive</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> filename
          </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block">
           </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">make-temp-name</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="variable-name">buffer-file-name</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
                    </span><span class="org-block"><span class="string">"_"</span></span><span class="org-block">
                    </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">format-time-string</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"%Y%m%d_%H%M%S_"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">".png"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">call-process</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"import"</span></span><span class="org-block"> nil nil nil filename</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">insert</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"<a href="&quot; filename &quot;">[["</a></span></span><span class="org-block"><a href="&quot; filename &quot;"> filename </a></span><span class="org-block"><span class="string"><a href="&quot; filename &quot;">"]]</a>"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">org-display-inline-images</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Capture invitations/appointments from MS Exchange emails
</span><span class="org-meta-line">#+index: Appointment!MS Exchange</span>
Dirk-Jan C.Binnema <span class="kc-org-link-url"><a href="https://orgmode.org/list/20100718104515.4C21039C72A@djcbsoftware.nl">provided</a></span> code to do this.  Please check
<span class="org-link"><a href="file:code/elisp/org-exchange-capture.el">org-exchange-capture.el</a></span>

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Audio/video file playback within org mode
</span><span class="org-meta-line">#+index: Link!audio/video</span>
Paul Sexton provided code that makes <span class="org-verbatim">file:</span> links to audio or video files
(MP3, WAV, OGG, AVI, MPG, et cetera) play those files using the <span class="kc-org-link-url"><a href="https://github.com/dbrock/bongo">Bongo</a></span> Emacs
media player library. The user can pause, skip forward and backward in the
track, and so on from without leaving Emacs. Links can also contain a time
after a double colon -- when this is present, playback will begin at that
position in the track.

See the file <span class="org-link"><a href="file:code/elisp/org-player.el">org-player.el</a></span>

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Under X11 Keep a window with the current agenda items at all time
</span><span class="org-meta-line">#+index: Agenda!dedicated window</span>
I struggle to keep (in emacs) a window with the agenda at all times.
For a long time I have wanted a sticky window that keeps this
information, and then use my window manager to place it and remove its
decorations (I can also force its placement in the stack: top always,
for example).

I wrote a small program in qt that simply monitors an HTML file and
displays it. Nothing more. It does the work for me, and maybe somebody
else will find it useful. It relies on exporting the agenda as HTML
every time the org file is saved, and then this little program
displays the html file. The window manager is responsible of removing
decorations, making it sticky, and placing it in same place always.

Here is a screenshot (see window to the bottom right). The decorations
are removed by the window manager:

<span class="kc-org-link-url"><a href="http://turingmachine.org/hacking/org-mode/orgdisplay.png">http://turingmachine.org/hacking/org-mode/orgdisplay.png</a></span>

Here is the code. As I said, very, very simple, but maybe somebody will
find if useful.

<span class="kc-org-link-url"><a href="http://turingmachine.org/hacking/org-mode/">http://turingmachine.org/hacking/org-mode/</a></span>

--daniel german

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Script (thru procmail) to output emails to an Org file
</span><span class="org-meta-line">#+index: Conversion!email to org file</span>
Tycho Garen sent <span class="kc-org-link-url"><a href="http://comments.gmane.org/gmane.emacs.orgmode/44773">this</a></span>:

<span class="org-code">: I've [...] created some procmail and shell glue that takes emails and
: inserts them into an org-file so that I can capture stuff on the go using
: the email program.
</span>
Everything is documented <span class="kc-org-link-url"><a href="http://tychoish.com/code/org-mail/">here</a></span>.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Save File With Different Format for Headings (fileconversion)
</span>   <span class="org-drawer">:PROPERTIES:</span>
   <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">fileconversion</span>
   <span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Conversion!fileconversion</span>

Using hooks and on the fly
<span class="org-list-dt">-</span> When writing a buffer to the file: Replace the leading stars from
  headings with a file char.
<span class="org-list-dt">-</span> When reading a file into the buffer: Replace the file chars with
  leading stars for headings.

To change the file format just add or remove the keyword in the
<span class="org-code">#+STARTUP:</span> line in the Org buffer and save.

Now you can also change to Fundamental mode to see how the file looks
like on the level of the file, can go back to Org mode, reenter Org
mode or change to any other major mode and the conversion gets done
whenever necessary.

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Headings Without Leading Stars (hidestarsfile and nbspstarsfile)
</span>    <span class="org-drawer">:PROPERTIES:</span>
    <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">hidestarsfile</span>
    <span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Conversion!fileconversion hidestarsfile</span>

This is like "a cleaner outline view":
<span class="kc-org-link-url"><a href="https://orgmode.org/manual/Clean-view.html">https://orgmode.org/manual/Clean-view.html</a></span>

Example of the <span class="bold">file content</span> first with leading stars as usual and
below without leading stars through <span class="org-code">#+STARTUP: odd hidestars
hidestarsfile</span>:

<span class="org-block-begin-line">#+BEGIN_SRC org
</span><span class="org-block">  ,#+STARTUP: odd hidestars
  [...]
  *</span><span class="org-block"><span class="bold">***</span></span><span class="org-block">* TODO section
  *</span><span class="org-block"><span class="bold">*****</span></span><span class="org-block">* subsection
  *</span><span class="org-block"><span class="bold">*******</span></span><span class="org-block">* subsubsec
            </span><span class="org-list-dt"><span class="org-block"><span class="org-list-dt">-</span></span></span><span class="org-block"> bla bla
  *</span><span class="org-block"><span class="bold">***</span></span><span class="org-block">* section
        </span><span class="org-list-dt"><span class="org-block"><span class="org-list-dt">-</span></span></span><span class="org-block"> bla bla
  *</span><span class="org-block"><span class="bold">*****</span></span><span class="org-block">* subsection
</span><span class="org-block-end-line">#+END_SRC
</span>
<span class="org-block-begin-line">#+BEGIN_SRC org
</span><span class="org-block">  ,#+STARTUP: odd hidestars hidestarsfile
  [...]
      * TODO section
        * subsection
          * subsubsec
            </span><span class="org-list-dt"><span class="org-block"><span class="org-list-dt">-</span></span></span><span class="org-block"> bla bla
      * section
        </span><span class="org-list-dt"><span class="org-block"><span class="org-list-dt">-</span></span></span><span class="org-block"> bla bla
        * subsection
</span><span class="org-block-end-line">#+END_SRC
</span>
The latter is convenient for better human readability when an Org file,
additionally to Emacs, is read with a file viewer or, for smaller edits,
with an editor not capable of the Org file format.

<span class="org-code">hidestarsfile</span> is a hack and can not become part of the Org core:
<span class="org-list-dt">-</span> An Org file with <span class="org-code">hidestarsfile</span> can not contain list items with a
  star as bullet due to the syntax conflict at read time. Mark
  <span class="org-list-dt">E.</span> Shoulson suggested to use the non-breaking space which is now
  implemented in fileconversion as <span class="org-code">nbspstarsfile</span> as an alternative
  for <span class="org-code">hidestarsfile</span>. Although I don't recommend it because an editor
  like typically e. g. Emacs may render the non-breaking space
  differently from the space <span class="org-code">0x20</span>.
<span class="org-list-dt">-</span> An Org file with <span class="org-code">hidestarsfile</span> can almost not be edited with an
  Org mode without added functionality of hidestarsfile as long as the
  file is not converted back.

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Headings in Markdown Format (markdownstarsfile)
</span>    <span class="org-drawer">:PROPERTIES:</span>
    <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">markdownstarsfile</span>
    <span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Conversion!fileconversion markdownstarsfile</span>

Together with <span class="org-code">oddeven</span> you can use <span class="org-code">markdownstarsfile</span> to be readable
or even basically editable with Markdown (does not make much sense
with <span class="org-code">odd</span>, see <span class="org-code">org-convert-to-odd-levels</span> and
<span class="org-code">org-convert-to-oddeven-levels</span> for how to convert).

Example of the <span class="bold">file content</span>:

<span class="org-block-begin-line">#+BEGIN_SRC org
</span><span class="org-block">  ,#+STARTUP: oddeven markdownstarsfile
</span><span class="org-block"><span class="comment">  # section level 1</span></span><span class="org-block">
    </span><span class="org-list-dt"><span class="org-block"><span class="org-list-dt">1.</span></span></span><span class="org-block"> first item of numbered list (same format in Org and Markdown)
  </span><span class="org-block"><span class="org-tag"><span class="org-tag">##</span></span></span><span class="org-block"> section level 2
     </span><span class="org-list-dt"><span class="org-block"><span class="org-list-dt">-</span></span></span><span class="org-block"> first item of unordered list (same format in Org and Markdown)
  </span><span class="org-block"><span class="org-tag"><span class="org-tag">###</span></span></span><span class="org-block"> section level 3
      </span><span class="org-list-dt"><span class="org-block"><span class="org-list-dt">+</span></span></span><span class="org-block"> first item of unordered list (same format in Org and Markdown)
  </span><span class="org-block"><span class="org-tag"><span class="org-tag">####</span></span></span><span class="org-block"> section level 4
       * first item of unordered list (same format in Org and Markdown)
       * avoid this item type to be compatible with Org hidestarsfile
</span><span class="org-block-end-line">#+END_SRC
</span>
An Org file with <span class="org-code">markdownstarsfile</span> can not contain code comment
lines prefixed with <span class="org-code">#</span>, even not when within source blocks.

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> emacs-lisp code
</span>    <span class="org-drawer">:PROPERTIES:</span>
    <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">fileconversion-code</span>
    <span class="org-drawer">:END:</span>
<span class="org-meta-line">#+index: Conversion!fileconversion emacs-lisp code</span>

<span class="org-block-begin-line">#+BEGIN_SRC emacs-lisp
</span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- fileconversion version 0.10
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- DISCLAIMER: Make a backup of your Org files before trying
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">`</span></span><span class="org-block"><span class="comment"><span class="constant">f-org-fileconv-*</span></span></span><span class="org-block"><span class="comment">'. It is recommended to use a version control
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">system like git and to review and commit the changes in the Org
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">files regularly.
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- Supported "#+STARTUP:" formats: "hidestarsfile",
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">"nbspstarsfile", "markdownstarsfile".
</span></span><span class="org-block">
  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Design summary: fileconversion is a round robin of two states linked by
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">two actions:
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- State `</span></span><span class="org-block"><span class="comment"><span class="constant">v-org-fileconv-level-org-p</span></span></span><span class="org-block"><span class="comment">' is nil: The level is "file"
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">(encoded).
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- Action `</span></span><span class="org-block"><span class="comment"><span class="constant">f-org-fileconv-decode</span></span></span><span class="org-block"><span class="comment">': Replace file char with "*".
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- State `</span></span><span class="org-block"><span class="comment"><span class="constant">v-org-fileconv-level-org-p</span></span></span><span class="org-block"><span class="comment">' is non-nil: The level is "Org"
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">(decoded).
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- Action `</span></span><span class="org-block"><span class="comment"><span class="constant">f-org-fileconv-encode</span></span></span><span class="org-block"><span class="comment">': Replace "*" with file char.
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;;</span></span><span class="org-block"><span class="comment">
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Naming convention of prefix:
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- f-[...]: "my function", instead of the unspecific prefix `</span></span><span class="org-block"><span class="comment"><span class="constant">my-*</span></span></span><span class="org-block"><span class="comment">'.
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- v-[...]: "my variable", instead of the unspecific prefix `</span></span><span class="org-block"><span class="comment"><span class="constant">my-*</span></span></span><span class="org-block"><span class="comment">'.
</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">v-org-fileconv-level-org-p</span></span><span class="org-block"> nil
    </span><span class="org-block"><span class="doc">"Whether level of buffer is Org or only file.
  nil: level is file (encoded), non-nil: level is Org (decoded)."</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">make-variable-buffer-local</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">v-org-fileconv-level-org-p</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Survive a change of major mode that does `</span></span><span class="org-block"><span class="comment"><span class="constant">kill-all-local-variables</span></span></span><span class="org-block"><span class="comment">', e.
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">g. when reentering Org mode through "C-c C-c" on a #+STARTUP: line.
</span></span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">put</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">v-org-fileconv-level-org-p</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">permanent-local</span></span><span class="org-block"> t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">* Callback `</span></span><span class="org-block"><span class="comment"><span class="constant">f-org-fileconv-org-mode-beg</span></span></span><span class="org-block"><span class="comment">' before `</span></span><span class="org-block"><span class="comment"><span class="constant">org-mode</span></span></span><span class="org-block"><span class="comment">'
</span></span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defadvice</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">org-mode</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">before org-mode-advice-before-fileconv</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">f-org-fileconv-org-mode-beg</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">ad-activate</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">org-mode</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">f-org-fileconv-org-mode-beg</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- Reason to test `</span></span><span class="org-block"><span class="comment"><span class="constant">buffer-file-name</span></span></span><span class="org-block"><span class="comment">': Only when converting really
</span></span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">from/to an Org _file_, not e. g. for a temp Org buffer unrelated to a
</span></span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">file.
</span></span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- No `</span></span><span class="org-block"><span class="comment"><span class="constant">message</span></span></span><span class="org-block"><span class="comment">' to not wipe a possible "File mode specification error:".
</span></span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- `</span></span><span class="org-block"><span class="comment"><span class="constant">f-org-fileconv-decode</span></span></span><span class="org-block"><span class="comment">' in org-mode-hook would be too late for
</span></span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">performance reasons, see
</span></span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment"><a href="http://lists.gnu.org/archive/html/emacs-orgmode/2013-11/msg00920.html">http://lists.gnu.org/archive/html/emacs-orgmode/2013-11/msg00920.html</a>
</span></span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="variable-name">buffer-file-name</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">f-org-fileconv-decode</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">* Callback `</span></span><span class="org-block"><span class="comment"><span class="constant">f-org-fileconv-org-mode-end</span></span></span><span class="org-block"><span class="comment">' after `</span></span><span class="org-block"><span class="comment"><span class="constant">org-mode</span></span></span><span class="org-block"><span class="comment">'
</span></span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">org-mode-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">f-org-fileconv-org-mode-end</span></span><span class="org-block">
            nil   </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">_Prepend_ to hook to have it first.
</span></span><span class="org-block">            nil</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">Hook addition global.
</span></span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">f-org-fileconv-org-mode-end</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- Reason to test `</span></span><span class="org-block"><span class="comment"><span class="constant">buffer-file-name</span></span></span><span class="org-block"><span class="comment">': only when converting really
</span></span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">from/to an Org _file_, not e. g. for a temp Org buffer unrelated to a
</span></span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">file.
</span></span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- No `</span></span><span class="org-block"><span class="comment"><span class="constant">message</span></span></span><span class="org-block"><span class="comment">' to not wipe a possible "File mode specification error:".
</span></span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="variable-name">buffer-file-name</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- Adding this to `</span></span><span class="org-block"><span class="comment"><span class="constant">change-major-mode-hook</span></span></span><span class="org-block"><span class="comment">' or "defadvice before" of
</span></span><span class="org-block">      </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">org-mode would be too early and already trigger during find-file.
</span></span><span class="org-block">      </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- Argument 4: t to limit hook addition to buffer locally, this way
</span></span><span class="org-block">      </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">and as required the hook addition will disappear when the major
</span></span><span class="org-block">      </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">mode of the buffer changes.
</span></span><span class="org-block">      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">change-major-mode-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">f-org-fileconv-encode</span></span><span class="org-block"> nil t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">before-save-hook</span></span><span class="org-block">       </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">f-org-fileconv-encode</span></span><span class="org-block"> nil t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">add-hook</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="variable-name">after-save-hook</span></span><span class="org-block">        </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">f-org-fileconv-decode</span></span><span class="org-block"> nil t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">f-org-fileconv-re</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Check whether there is a #+STARTUP: line for fileconversion.
  If found then return the expressions required for the conversion."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">save-excursion</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point-min</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">`</span></span><span class="org-block"><span class="comment"><span class="constant">beginning-of-buffer</span></span></span><span class="org-block"><span class="comment">' is not allowed.
</span></span><span class="org-block">      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">re-list </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">count</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">while</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">re-search-forward</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"^[ \t]*#\\+STARTUP:"</span></span><span class="org-block"> nil t</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">#+STARTUP: hidestarsfile
</span></span><span class="org-block">          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">string-match-p</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"\\bhidestarsfile\\b"</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">thing-at-point</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">line</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Exclude e. g.:
</span></span><span class="org-block">            </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- Line starting with star for bold emphasis.
</span></span><span class="org-block">            </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- Line of stars to underline section title in loosely quoted
</span></span><span class="org-block">            </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">ASCII style (star at end of line).
</span></span><span class="org-block">            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> re-list </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="string">"</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">\\* </span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">"</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">common-re
</span></span><span class="org-block">                            ?\ </span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">         </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">file-char
</span></span><span class="org-block">            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> count </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">1+</span></span><span class="org-block"> count</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">#+STARTUP: nbspstarsfile
</span></span><span class="org-block">          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">string-match-p</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"\\bnbspstarsfile\\b"</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">thing-at-point</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">line</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> re-list </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="string">"</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string">\\* </span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">"</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">common-re
</span></span><span class="org-block">                            ?\xa0</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">       </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">file-char non-breaking space
</span></span><span class="org-block">            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> count </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">1+</span></span><span class="org-block"> count</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">#+STARTUP: markdownstarsfile
</span></span><span class="org-block">          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">string-match-p</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"\\bmarkdownstarsfile\\b"</span></span><span class="org-block">
                                </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">thing-at-point</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="highlight-quoted-symbol">line</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Exclude e. g. "#STARTUP:".
</span></span><span class="org-block">            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> re-list </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="string">"</span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">(</span></span></span><span class="org-block"><span class="string"> </span></span><span class="org-block"><span class="string"><span class="regexp-grouping-backslash">\\</span></span></span><span class="org-block"><span class="string"><span class="regexp-grouping-construct">)</span></span></span><span class="org-block"><span class="string">"</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">common-re
</span></span><span class="org-block">                            ?#</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">       </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">file-char
</span></span><span class="org-block">            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> count </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">1+</span></span><span class="org-block"> count</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">&gt;</span></span><span class="org-block"> count </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="function-name">error</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"More than one fileconversion found."</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        re-list</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">f-org-fileconv-decode</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"In headings replace file char with '*'."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">re-list </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">f-org-fileconv-re</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> re-list </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">not</span></span><span class="org-block"> v-org-fileconv-level-org-p</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">No `</span></span><span class="org-block"><span class="comment"><span class="constant">save-excursion</span></span></span><span class="org-block"><span class="comment">' to be able to keep point in case of error.
</span></span><span class="org-block">        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">common-re </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">nth</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"> re-list</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">file-char </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">nth</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"> re-list</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">file-re   </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"^"</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">string</span></span><span class="org-block"> file-char</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"+"</span></span><span class="org-block"> common-re</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">org-re    </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"^\\*+"</span></span><span class="org-block"> common-re</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
               len
               </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">p         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point-min</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">`</span></span><span class="org-block"><span class="comment"><span class="constant">beginning-of-buffer</span></span></span><span class="org-block"><span class="comment">' is not allowed.
</span></span><span class="org-block">          </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Syntax check.
</span></span><span class="org-block">          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">re-search-forward</span></span><span class="org-block"> org-re nil t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">match-beginning</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-reveal</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">error</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Org fileconversion decode: Syntax conflict at point."</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point-min</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">`</span></span><span class="org-block"><span class="comment"><span class="constant">beginning-of-buffer</span></span></span><span class="org-block"><span class="comment">' is not allowed.
</span></span><span class="org-block">          </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Substitution.
</span></span><span class="org-block">          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">with-silent-modifications</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">while</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">re-search-forward</span></span><span class="org-block"> file-re nil t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">match-beginning</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Faster than a lisp call of insert and delete on each single
</span></span><span class="org-block">              </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">char.
</span></span><span class="org-block">              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> len </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">-</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">match-beginning</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">match-beginning</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">insert-char</span></span><span class="org-block"> ?* len</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">delete-char</span></span><span class="org-block"> len</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> p</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">

          </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Notes for ediff when only one file has fileconversion:
</span></span><span class="org-block">          </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- The changes to the buffer with fileconversion until here are
</span></span><span class="org-block">          </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">not regarded by `</span></span><span class="org-block"><span class="comment"><span class="constant">ediff-files</span></span></span><span class="org-block"><span class="comment">' because the first call to diff is
</span></span><span class="org-block">          </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">made with the bare files directly. Only `</span></span><span class="org-block"><span class="comment"><span class="constant">ediff-update-diffs</span></span></span><span class="org-block"><span class="comment">'
</span></span><span class="org-block">          </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">and `</span></span><span class="org-block"><span class="comment"><span class="constant">ediff-buffers</span></span></span><span class="org-block"><span class="comment">' write the decoded buffers to temp files and
</span></span><span class="org-block">          </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">then call diff with them.
</span></span><span class="org-block">          </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">- Workarounds (choose one):
</span></span><span class="org-block">          </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">- After ediff-files first do a "!" (ediff-update-diffs) in the
</span></span><span class="org-block">          </span><span class="org-block"><span class="comment-delimiter">;;     </span></span><span class="org-block"><span class="comment">"*Ediff Control Panel*".
</span></span><span class="org-block">          </span><span class="org-block"><span class="comment-delimiter">;;   </span></span><span class="org-block"><span class="comment">- Instead of using `</span></span><span class="org-block"><span class="comment"><span class="constant">ediff-files</span></span></span><span class="org-block"><span class="comment">' first open the files and then
</span></span><span class="org-block">          </span><span class="org-block"><span class="comment-delimiter">;;     </span></span><span class="org-block"><span class="comment">run `</span></span><span class="org-block"><span class="comment"><span class="constant">ediff-buffers</span></span></span><span class="org-block"><span class="comment">' (better for e. g. a script that takes two
</span></span><span class="org-block">          </span><span class="org-block"><span class="comment-delimiter">;;     </span></span><span class="org-block"><span class="comment">files as arguments and uses "emacs --eval").
</span></span><span class="org-block">
    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">The level is Org most of all when no fileconversion is in effect.
</span></span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> v-org-fileconv-level-org-p t</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">

  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defun</span></span><span class="org-block"> </span><span class="org-block"><span class="function-name">f-org-fileconv-encode</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">()</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"In headings replace '*' with file char."</span></span><span class="org-block">
    </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">let</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">re-list </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block">f-org-fileconv-re</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
      </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">and</span></span><span class="org-block"> re-list v-org-fileconv-level-org-p</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
        </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">No `</span></span><span class="org-block"><span class="comment"><span class="constant">save-excursion</span></span></span><span class="org-block"><span class="comment">' to be able to keep point in case of error.
</span></span><span class="org-block">        </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">let*</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">common-re </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">nth</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"> re-list</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">file-char </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">nth</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"> re-list</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">file-re   </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"^"</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">string</span></span><span class="org-block"> file-char</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"+"</span></span><span class="org-block"> common-re</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
               </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">org-re    </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">concat</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"^\\*+"</span></span><span class="org-block"> common-re</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
               len
               </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block">p         </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">point</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point-min</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">`</span></span><span class="org-block"><span class="comment"><span class="constant">beginning-of-buffer</span></span></span><span class="org-block"><span class="comment">' is not allowed.
</span></span><span class="org-block">          </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Syntax check.
</span></span><span class="org-block">          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">when</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">re-search-forward</span></span><span class="org-block"> file-re nil t</span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">match-beginning</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">org-reveal</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="function-name">error</span></span><span class="org-block"> </span><span class="org-block"><span class="string">"Org fileconversion encode: Syntax conflict at point."</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">point-min</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">`</span></span><span class="org-block"><span class="comment"><span class="constant">beginning-of-buffer</span></span></span><span class="org-block"><span class="comment">' is not allowed.
</span></span><span class="org-block">          </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Substitution.
</span></span><span class="org-block">          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">with-silent-modifications</span></span><span class="org-block">
            </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="keyword">while</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">re-search-forward</span></span><span class="org-block"> org-re nil t</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">match-beginning</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">Faster than a lisp call of insert and delete on each single
</span></span><span class="org-block">              </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">char.
</span></span><span class="org-block">              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> len </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">-</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">match-beginning</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="constant">match-beginning</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">0</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">insert-char</span></span><span class="org-block"> file-char len</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
              </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">delete-char</span></span><span class="org-block"> len</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="constant">goto-char</span></span><span class="org-block"> p</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
          </span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="keyword">setq</span></span><span class="org-block"> v-org-fileconv-level-org-p nil</span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    nil</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">; </span></span><span class="org-block"><span class="comment">For the hook.
</span></span><span class="org-block-end-line">#+END_SRC
</span>
Michael Brand

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Meaningful diff for org files in a git repository
</span><span class="org-meta-line">#+index: git!diff org files</span>
Since most diff utilities are primarily meant for source code, it is
difficult to read diffs of text files like <span class="org-code">.org</span> files easily. If you
version your org directory with a SCM like git you will know what I
mean. However for git, there is a way around. You can use
<span class="org-verbatim">gitattributes</span> to define a custom diff driver for org files. Then a
regular expression can be used to configure how the diff driver
recognises a "function".

Put the following in your <span class="org-verbatim">&lt;org_dir&gt;/.gitattributes</span>.
<span class="org-code">: *.org</span><span class="whitespace-tab"> </span><span class="org-code">diff=org
</span>Then put the following lines in <span class="org-verbatim">&lt;org_dir&gt;/.git/config</span>
<span class="org-code">: [diff "org"]
: </span><span class="whitespace-tab">      </span><span class="org-code">xfuncname = "^(\\*+ [a-zA-Z0-9]+.+)$"
</span>
This will let you see diffs for org files with each hunk identified by
the unmodified headline closest to the changes. After the
configuration a diff should look something like the example below.

<span class="org-block-begin-line">#+begin_example
</span><span class="custom">diff --git a/org-hacks.org b/org-hacks.org
index a0672ea..92a08f7 100644
--- a/org-hacks.org
+++ b/org-hacks.org
</span><span class="custom"><span class="org-formula">@@</span></span><span class="custom"> -2495,6 +2495,22 </span><span class="custom"><span class="org-formula">@@</span></span><span class="custom"> ** Script (thru procmail) to output emails to an Org file

 Everything is documented <a href="http://tychoish.com/code/org-mail/">[[http://tychoish.com/code/org-mail/][here]]</a>.

+** Meaningful diff for org files in a git repository
+
+Since most diff utilities are primarily meant for source code, it is
+difficult to read diffs of text files like ~.org~ files easily. If you
+version your org directory with a SCM like git you will know what I
+mean. However for git, there is a way around. You can use
+=gitattributes= to define a custom diff driver for org files. Then a
+regular expression can be used to configure how the diff driver
+recognises a "function".
+
+Put the following in your =&lt;org_dir&gt;/.gitattributes=.
+: *.org</span><span class="whitespace-tab">        </span><span class="custom">diff=org
+Then put the following lines in =&lt;org_dir&gt;/.git/config=
+: [diff "org"]
+: </span><span class="whitespace-tab">     </span><span class="custom">xfuncname = "^(\\*+ [a-zA-Z0-9]+.+)$"
+
 * Musings

 ** Cooking?  Brewing?
</span><span class="org-block-end-line">#+end_example
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Opening devonthink links
</span>
John Wiegley wrote <span class="kc-org-link-url"><a href="https://github.com/jwiegley/dot-emacs/blob/master/lisp/org-devonthink.el">org-devonthink.el</a></span>, which lets you handle devonthink
links from org-mode.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Memacs - Org-mode collecting meta-data from the disk and cloud
</span>
Karl Voit designed Memacs (<span class="kc-org-link-url"><a href="https://en.wikipedia.org/wiki/Memex">Memex</a></span> and Emacs) which is a collection of
modules that are able to get meta-data from different kind of
sources. Memacs then generates output files containing meta-data in
Org-mode format. Those files a most likely integrated as <span class="org-code">*.org_archive</span>
files in your agenda.

This way, you can get a pretty decent overview of your (digital) life:
<span class="org-list-dt">-</span> file name timestamps (<span class="kc-org-link-url"><a href="https://en.wikipedia.org/wiki/Iso_date">ISO 8601</a></span>; like "2013-10-11 Product Demonstration.odp")
<span class="org-list-dt">-</span> emails (IMAP, POP, Maildir, mbox)
<span class="org-list-dt">-</span> RSS feeds (blog updates, ... <span class="bold">lots</span> of possibilities there!)
<span class="org-list-dt">-</span> version system commits (SVN, git)
<span class="org-list-dt">-</span> calendar (iCal, CSV)
<span class="org-list-dt">-</span> text messages from your phone (Android)
<span class="org-list-dt">-</span> phone calls (Android)
<span class="org-list-dt">-</span> photographs (EXIF)
<span class="org-list-dt">-</span> bank accounts (<span class="kc-org-link-url"><a href="http://easybank.at">easybank</a></span>)
<span class="org-list-dt">-</span> usenet postings (slrn, mbox, ...)
<span class="org-list-dt">-</span> XML (a sub-set of easy-to-parse XML files can be parsed with minimal
  effort)

General idea: you set up the module(s) you would like to use once and
they are running in the background. As long as the data source does
not change, you should not have to worry about the module again.

It is hard to explain the vast amount of (small) benefits you get once
you have set up your Memacs modules.

There is <span class="kc-org-link-url"><a href="http://arxiv.org/abs/1304.1332">a whitepaper which describes Memacs</a></span> and its implications.

Memacs is <span class="kc-org-link-url"><a href="https://github.com/novoid/Memacs">hosted on github</a></span> and is written in Python.

You can use Memacs to write your own Memacs module: an example module
demonstrates how to write modules with very low effort. Please
consider a pull request on github so that other people can use your
module as well!

<span class="kc-org-link-url"><a href="https://github.com/novoid/twitter-json_to_orgmode">Twitter JSON to Org-mode</a></span> generates Memacs-like output files for
<span class="kc-org-link-url"><a href="https://blog.twitter.com/2012/your-twitter-archive">Twitter export archives</a></span> (JSON) but is independent of Memacs.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Displaying Vega and Vega lite graphs with org
</span>
See <span class="kc-org-link-url"><a href="https://github.com/vladkotu/vladkotu.github.io/blob/source/blog/org-clj-plot/clj-plot.org#vega-vega-lite-wrappers">this example</a></span>.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Emacs as an Org capture server
</span>
<span class="org-block-begin-line">#+begin_quote
</span><span class="org-quote">The general idea is to run an Emacs server as a daemon which clients
can quickly connect to via a bash script. The client executes
org-capture and the frame closes upon finalizing or aborting the
capture.
</span><span class="org-block-end-line">#+end_quote
</span>
See No Wayman's <span class="kc-org-link-url"><a href="https://orgmode.org/list/87a6xz3lnd.fsf@gmail.com/">message on the list</a></span> and <span class="kc-org-link-url"><a href="https://gist.github.com/progfolio/af627354f87542879de3ddc30a31adc1">this gist</a></span> for details.

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Musings
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Cooking?  Brewing?
</span><span class="org-meta-line">#+index: beer!brewing</span>
<span class="org-meta-line">#+index: cooking!conversions</span>
See <span class="kc-org-link-url"><a href="https://orgmode.org/list/87livkco7y.wl%egh@e6h.org">this message</a></span> from Erik Hetzner:

It currently does metric/english conversion, and a few other tricks.
Basically I just use calc&#8217;s units code.  I think scaling recipes, or
turning percentages into weights would be pretty easy.

  <span class="kc-org-link-url"><a href="https://gitorious.org/org-cook/org-cook">https://gitorious.org/org-cook/org-cook</a></span>

There is also, for those interested:

  <span class="kc-org-link-url"><a href="https://gitorious.org/org-brew/org-brew">https://gitorious.org/org-brew/org-brew</a></span>

for brewing beer. This is again, mostly just calc functions, including
hydrometer correction, abv calculation, priming sugar for a given CO_2
volume, etc. More integration with org-mode should be possible: for
instance it would be nice to be able to use a lookup table (of ingredients)
to calculate target original gravity, IBUs, etc.
</pre>
  </body>
</html>
