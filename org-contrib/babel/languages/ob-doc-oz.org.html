<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.56 in css mode. -->
<html>
  <head>
    <title>ob-doc-oz.org</title>
    <style type="text/css">
    <!--
      body {
        color: #d6d6d4;
        background-color: #161719;
      }
      .custom {
        /* (:foreground "#f0c613" :weight bold :underline t) */
        color: #f0c613;
        font-weight: bold;
        text-decoration: underline;
      }
      .error {
        /* error */
        color: #e74c3c;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b6e63e;
      }
      .highlight-numbers-number {
        /* highlight-numbers-number */
        color: #9c91e4;
        font-weight: bold;
      }
      .kc-org-link-url {
        /* kc-org-link-url */
        color: #d02090;
        text-decoration: underline;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #eb4509;
      }
      .org-block {
        /* org-block */
        background-color: #000000;
      }
      .org-block-begin-line {
        /* org-block-begin-line */
        color: #696969;
      }
      .org-block-end-line {
        /* org-block-end-line */
        color: #696969;
      }
      .org-code {
        /* org-code */
        color: #dfd05e;
      }
      .org-document-info {
        /* org-document-info */
        color: #fd971f;
      }
      .org-document-info-keyword {
        /* org-document-info-keyword */
        color: #555556;
      }
      .org-document-title {
        /* org-document-title */
        color: #fd971f;
        font-weight: bold;
      }
      .org-hide {
        /* org-hide */
        color: #161719;
      }
      .org-level-1 {
        /* org-level-1 */
        color: #eb4509;
        font-weight: bold;
      }
      .org-level-2 {
        /* org-level-2 */
        color: #f0b144;
        font-weight: bold;
      }
      .org-level-3 {
        /* org-level-3 */
        color: #8ec298;
        font-weight: bold;
      }
      .org-list-dt {
        /* org-list-dt */
        color: #e2c770;
      }
      .org-meta-line {
        /* org-meta-line */
        color: #7f7f80;
      }
      .org-superstar-header-bullet {
      }
      .org-tag {
        /* org-tag */
        color: #e2c770;
      }
      .org-target {
        /* org-target */
        text-decoration: underline;
      }
      .org-verbatim {
        /* org-verbatim */
        color: #b6e63e;
      }
      .string {
        /* font-lock-string-face */
        color: #e2c770;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #fd971f;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
<span class="org-meta-line">#+OPTIONS:    H:3 num:nil toc:2 \n:nil ::t |:t ^:{} -:t f:t *:t tex:t d:(HIDE) tags:not-in-toc</span>
<span class="org-meta-line">#+STARTUP:    align fold nodlcheck hidestars oddeven lognotestate hideblocks</span>
<span class="org-meta-line">#+SEQ_TODO:   TODO(t) INPROGRESS(i) WAITING(w@) | DONE(d) CANCELED(c@)</span>
<span class="org-meta-line">#+TAGS:       Write(w) Update(u) Fix(f) Check(c) noexport(n)</span>
<span class="org-document-info-keyword">#+TITLE:</span>      <span class="org-document-title">Org-babel-Oz
</span><span class="org-document-info-keyword">#+AUTHOR:</span>     <span class="org-document-info">Torsten Anders, Eric Schulte
</span><span class="org-meta-line">#+LANGUAGE:   en</span>
<span class="org-meta-line">#+HTML_LINK_UP:    index.html</span>
<span class="org-meta-line">#+HTML_LINK_HOME:  <a href="https://orgmode.org/worg/">https://orgmode.org/worg/</a></span>

<span class="org-block-begin-line">#+begin_export html
</span><span class="org-block">  &lt;</span><span class="org-block"><span class="function-name">div</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">id</span></span><span class="org-block">=</span><span class="org-block"><span class="string">"subtitle"</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">style</span></span><span class="org-block">=</span><span class="org-block"><span class="string">"float: center; text-align: center;"</span></span><span class="org-block">&gt;
  &lt;</span><span class="org-block"><span class="function-name">p</span></span><span class="org-block">&gt;
  Org-babel support for
  &lt;</span><span class="org-block"><span class="function-name">a</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">href</span></span><span class="org-block">=</span><span class="org-block"><span class="string">"<a href="http://mozart.github.io/">http://mozart.github.io/</a>"</span></span><span class="org-block">&gt;Oz&lt;/</span><span class="org-block"><span class="function-name">a</span></span><span class="org-block">&gt;
  &lt;/</span><span class="org-block"><span class="function-name">p</span></span><span class="org-block">&gt;
  &lt;</span><span class="org-block"><span class="function-name">p</span></span><span class="org-block">&gt;
  &lt;</span><span class="org-block"><span class="function-name">a</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">href</span></span><span class="org-block">=</span><span class="org-block"><span class="string">"<a href="http://mozart.github.io/">http://mozart.github.io/</a>"</span></span><span class="org-block">&gt;
  &lt;</span><span class="org-block"><span class="function-name">img</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">src</span></span><span class="org-block">=</span><span class="org-block"><span class="string">"<a href="http://mozart.github.io/img/mozart-logos/logo_new.png&quot;/">http://mozart.github.io/img/mozart-logos/logo_new.png"</a></span></span><span class="org-block"><a href="http://mozart.github.io/img/mozart-logos/logo_new.png&quot;/">/</a>&gt;
  &lt;/</span><span class="org-block"><span class="function-name">a</span></span><span class="org-block">&gt;
  &lt;/</span><span class="org-block"><span class="function-name">p</span></span><span class="org-block">&gt;
  &lt;/</span><span class="org-block"><span class="function-name">div</span></span><span class="org-block">&gt;
</span><span class="org-block-end-line">#+end_export
</span>
<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> </span><span class="org-level-1"><span class="custom">TODO</span></span><span class="org-level-1"> Notes                                                       </span><span class="org-level-1"><span class="org-tag">:noexport:</span></span><span class="org-level-1">
</span>
  <span class="org-list-dt">-</span> Make <span class="org-verbatim">:results output</span> the default, so <span class="org-verbatim">:results value</span> must be
    specified explicitly. Currently this is the other way round.

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Introduction
</span>
org-babel-oz extends org-babel by support for executing Oz source
code. Oz code is executed by sending it to the Oz Programming
Environment (OPI), the Emacs mode and compiler interface for Oz
programs.

Oz distinguishes between statements and expressions. org-babel-oz
supports both of them, but the org-babel header argument <span class="org-verbatim">:results</span>
must be set accordingly. <span class="org-verbatim">:results output</span> requires the respective
code block to be an Oz statement and <span class="org-verbatim">:results value</span> requires an Oz
expression. org-babel inserts the result of expressions automatically
into an org buffer, as usual. A statement has no result (i.e. the
result of :results output is always nil), but it can produce output as
a side effect (e.g., use the Oz browser or output a file).

The OPI keeps running in the background between executing multiple
code blocks (e.g., it remembers variable values). Therefore,
org-babel-oz always runs in session mode (the org-babel <span class="org-verbatim">:session</span>
header argument is ignored). In practice, non-session code blocks are
handled equally well by the session mode. However, only a single
session is supported.

Expression evaluation happens synchronously. Therefore there is an
additional header argument <span class="org-verbatim">:wait-time</span> &lt;number&gt;, which specifies the
maximum time to wait for the result of a given expression. <span class="org-verbatim">nil</span> means
to wait as long as it takes to get a result (potentially wait
forever).

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Requirements
</span>
org-babel-oz requires the Mozart Programming System. Mozart is the
implementation of the Oz programming language
(<span class="kc-org-link-url"><a href="http://www.mozart-oz.org/">http://www.mozart-oz.org/</a></span>), which includes the major mode mozart for
editing Oz programs.

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Enabling org-babel-oz
</span>
Add the following to your <span class="org-verbatim">~/.emacs</span> file.

<span class="org-code">: (require 'ob-oz)
</span>
<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Feeding statements with </span><span class="org-level-1"><span class="org-verbatim">:results output</span></span><span class="org-level-1">
</span>
  The top-level expression of a typical Oz program is a statement (not
  an expression). The following code block calls the Oz browser for
  printing the Oz atom 'Hello org-babel!' (as usual, execute the block
  with <span class="org-verbatim">C-c C-c</span>).

<span class="org-code">: #+begin_src oz :results output
:   {Browse 'Hello org-babel!'}
: #+end_src
</span>
  This code does not return anything (no result is shown in the org
  buffer) -- it only feeds a statement to the OPI compiler. Note that
  <span class="org-verbatim">:results output</span> is a required header argument (the default is
  <span class="org-verbatim">:results value</span>).

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Feeding expressions and getting back results with </span><span class="org-level-1"><span class="org-verbatim">:results value</span></span><span class="org-level-1">
</span>
Oz expressions are executed with the org-babel header argument
<span class="org-verbatim">:results value</span>. org-babel inserts the the result of an expression
into an org buffer, as usual.

<span class="org-code">: #+begin_src oz :results value
:   39 + 3
: #+end_src
</span>
<span class="org-meta-line">#+results:</span>
<span class="org-code">: 42
</span>
Oz does not distinguish between lists of integers and strings. The
interface is currently set to output virtual strings "as is". This
approach works fine for plain strings, on the one hand. ...

<span class="org-code">: #+begin_src oz :results value
:   "Bla"
: #+end_src
</span>
<span class="org-meta-line">#+results:</span>
<span class="org-code">: Bla
</span>
..., and for concatenated virtual strings, on the other hand.

<span class="org-code">: #+begin_src oz :results value
:   foo#bar
: #+end_src
</span>
<span class="org-meta-line">#+results:</span>
<span class="org-code">: foobar
</span>
However, list of integers are translated into the corresponding string
by org-babel.

<span class="org-code">: #+begin_src oz :results value
:   [60 61 62 63]
: #+end_src
</span>
<span class="org-meta-line">#+results:</span>
<span class="org-code">: &lt;=&gt;?
</span>
As a workaround, a list of integers can explicitly be translated into
a string.

<span class="org-code">: #+begin_src oz :results value
:   {Value.toVirtualString [60 61 62 63]
:    100 100}
: #+end_src
</span>
<span class="org-meta-line">#+results:</span>
<span class="org-code">: [60 61 62 63]
</span>
Nested data structures are supported as well. However, they are not
pretty printed.

<span class="org-code">: #+begin_src oz :results value
:   seq([note(duration:2
:             pitch:60
:             amplitude:80)
:        note(duration:2
:             pitch:64
:             amplitude:60)
:        note(duration:2
:             pitch:67
:             amplitude:50)
:        note(duration:6
:             pitch:72
:             amplitude:100)]
:       startTime: 0
:       timeUnits: beats(4))
: #+end_src
</span>
<span class="org-meta-line">#+results:</span>
<span class="org-code">: seq([note(amplitude:80 duration:2 pitch:60) note(amplitude:60 duration:2 pitch:64) note(amplitude:50 duration:2 pitch:67) note(amplitude:100 duration:6 pitch:72)] startTime:0 timeUnits:beats(4))
</span>
Oz objects without a literal representation are returned as they would
be shown, e.g., in the Oz emulator. This example creates a Strasheela
score object (so Strasheela must be installed).

<span class="org-code">: #+begin_src oz :results value
:   {Score.make seq
:    unit}
: #+end_src
</span>
<span class="org-meta-line">#+results:</span>
<span class="org-code">: &lt;O: Sequential&gt;
</span>
<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Org-babel variables
</span>
Code blocks can contain variables in org-babel that are bound with the
code block header argument <span class="org-verbatim">:var</span>. The variable syntax must comply
with the syntax of variables for the programming language in
question. Oz variables always start with a capital letter.

Variables can also be bound with the result of Emacs lisp code. In the
following example, the path of the directory of the present file is
browsed.

<span class="org-code">: #+begin_src oz :results output :var Path=(format "'%s%s'" (file-name-directory (buffer-file-name)) "")
: {Browse Path}
: #+end_src
</span>
Any Oz code can be expressed by wrapping it into an (Emacs lisp)
string. In the following example, the variable <span class="org-verbatim">Foo</span> is bound to the
(result of the) Oz expression 2+3.

<span class="org-code">: #+begin_src oz :results output :var Foo="2+3"
: {Browse Foo}
: #+end_src
</span>
Another use for variables is for the Library of Babel. When the
following code block is executed (<span class="org-verbatim">C-c C-c</span>), it calls the code block
<span class="org-verbatim">browse</span> defined below. Arguments must be valid binding statements for
Oz variables (e.g., X=3).

<span class="org-code">: #+lob: browse(X=3)
</span>
<span class="org-code">: #+lob: browse(X="This is a test")
</span>
You can see in the Oz Compiler buffer the actual Oz code generated
from such calls (org-babel-oz automatically surrounds the code block
by a <span class="org-verbatim">local</span> statement, i.e. declares these variables).

<span class="org-code">: #+name: browse(X)
: #+begin_src oz
:   {Browse X}
: #+end_src
</span>
Multiple variables are separated by commas (which is org-babel and not
Oz syntax).

<span class="org-code">: #+lob: browse2(X=3, Y=7)
</span>
<span class="org-code">: #+name: browse2(X, Y)
: #+begin_src oz :results output
:   {Browse X#Y}
: #+end_src
</span>
<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Literate example
</span>
Org-babel supports literate programming, and org-babel-oz inherits
this functionality. An example is shown below. The following code
block contains the code <span class="org-target"><span class="org-verbatim">&lt;&lt;declaration&gt;&gt;</span></span>, which expands to the code
block named <span class="org-verbatim">declaration</span> shown below. Code blocks with such noweb
syntax require the header argument <span class="org-verbatim">:noweb yes</span>. Interactive execution
of literate programs that are split into multiple chunks works like
the interactive execution plain code blocks (i.e. using <span class="org-verbatim">C-c C-c</span>)

<span class="org-code">: #+begin_src oz :results output :tangle LP-test :noweb yes
:   &lt;&lt;declaration&gt;&gt;
:   {Browse X+Y}
: #+end_src
</span>
A complete Oz source file combining code chucks is created when
calling <span class="org-verbatim">org-babel-tangle</span>. The a resulting file name (without
extension) is given to the header argument <span class="org-verbatim">:tangle</span>.

Following is the named code block <span class="org-verbatim">declaration</span>, which is used as a
chunk in this literate programming example. Note that the order of
code block definitions is not the order in which these code blocks
(chunks) appear in the resulting program!

<span class="org-code">: #+name: declaration
: #+begin_src oz :results output
:   declare
:   X = 7
:   Y = 3
: #+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> </span><span class="org-level-2"><span class="custom">TODO</span></span><span class="org-level-2"> Ideas for Improving Literate Programming Support of Org-Babel
</span>
   <span class="org-list-dt">-</span> Important: the names of literate programming code blocks must
     appear in the exported files (e.g., HTML), otherwise the
     resulting literate program is incomprehensible (e.g., using a
     notation like <span class="org-target">&lt;&lt;code block name&gt;&gt;</span> = &lt;code&gt;). These code names
     should likely be created automatically, but there seems to be
     also no strait-forward manual way to name code blocks (e.g.,
     <span class="org-verbatim">#+CAPTION:</span> does not work for code blocks).

   <span class="org-list-dt">-</span> Important: every "call" to a code block (e.g., <span class="org-target">&lt;&lt;my code block&gt;&gt;</span>)
     should somehow directly link to its definition (e.g., HTML link,
     or ref to section number)

   <span class="org-list-dt">-</span> Less important: Noweb syntax of chord block insertion is also
     valid Oz syntax (macro call) -- the different should be somehow
     made clear to avoid confusion

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Session-based evaluation
</span>
As mentioned above, org-babel-oz always runs in session mode. Sessions
can consist of statements and expressions. In the following statement,
the variable <span class="org-verbatim">X</span> is declared.

<span class="org-code">: #+begin_src oz :results output
:   declare
:   X = 7
: #+end_src
</span>
In a later code block, the variable <span class="org-verbatim">X</span> is browsed (also a statement).

<span class="org-code">: #+begin_src oz :results output
:   {Browse X}
: #+end_src
</span>
The value of this variable can also be returned (expression).

<span class="org-code">: #+begin_src oz :results value
:   X
: #+end_src
</span>
<span class="org-meta-line">#+resname:</span>
<span class="org-code">: 7
</span>
<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Inline source blocks
</span>
  The following code example is only shown in the source, while the
  export contains the result: src_oz{2+1}. Nevertheless, the code can
  also be evaluated interactively.

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Getting different result types                                   </span><span class="org-level-1"><span class="org-tag">:noexport:</span></span><span class="org-level-1">
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> file
</span>
Create a Strasheela score and output it as MIDI file (requires
installation of Strasheela and midicsv).

<span class="org-code">: #+begin_src oz :results output
:    declare
:    MyTestScore = {Score.makeScore
:                   seq(items:[note(duration:2
:                                   pitch:60
:                                   amplitude:80)
:                              note(duration:2
:                                   pitch:64
:                                   amplitude:60)
:                              note(duration:2
:                                   pitch:67
:                                   amplitude:50)
:                              note(duration:6
:                                   pitch:72
:                                   amplitude:100)
:                             ]
:                       startTime:0
:                       timeUnit:beats(4))
:                   unit}
:    File = test
:   {Out.midi.renderAndPlayMidiFile MyTestScore
:    unit(file: File)}
: #+end_src
</span>
<span class="org-code">: #+begin_src oz :results value file :exports none
:    {Init.getStrasheelaEnv defaultMidiDir}#File#".mid"
: #+end_src
</span>
<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> </span><span class="org-level-3"><span class="custom">TODO</span></span><span class="org-level-3"> </span><span class="org-level-3"><span class="org-verbatim">:exports none</span></span><span class="org-level-3"> and </span><span class="org-level-3"><span class="org-verbatim">:exports results</span></span><span class="org-level-3"> are swapped
</span>
    Meaning of these two args is swapped.

<span class="org-hide">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> </span><span class="org-level-3"><span class="custom">TODO</span></span><span class="org-level-3"> File output problems
</span>
    <span class="org-list-dt">-</span> Are file names always absolute? I assume this depends on the
      file name returned by the code block...

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Handling Oz Exceptions
</span>
In case an Oz statement results in an exception, then this exception
is shown in the Oz Compiler buffer, as usual (it does not block the Oz
compiler).

<span class="org-code">: #+begin_src oz :results output
:   {Bla} % undefined procedure
: #+end_src
</span>
For Oz expressions that result in an exception, the exception is shown
and additionally the result <span class="org-verbatim">error</span> returned.

<span class="org-code">: #+begin_src oz :results value
:    1 div 0 % division by 0 error
: #+end_src
</span>
<span class="org-meta-line">#+resname:</span>
<span class="org-code">: error
</span>
Note that some exceptions are not caught by the Oz interface and thus
block Emacs. In the following example, the variable Bla is not
declared and Emacs is blocked for the default value of the header
argument <span class="org-verbatim">:wait-time</span> (1 sec).

<span class="org-code">: #+begin_src oz :results value
:    Bla
: #+end_src
</span>
<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Bugs
</span>
  While evaluating Oz statements with <span class="org-verbatim">:results output</span> is stable,
  evaluating Oz expressions with <span class="org-verbatim">:results value</span> is not. In
  particular, when Oz is halted and restarted, then [sometimes?] the
  connection between org-babel-oz and Oz is broken.  Workaround:
  execute the Emacs Lisp code <span class="org-verbatim">(org-babel-oz-create-socket)</span> (problem:
  "Address already in use").

  Whenever an Oz expression is evaluated (:results value), the
  printing of the result is delayed by one evaluation. In other words,
  if the expression is changed and re-evaluated, then the result of
  the previous evaluation is inserted into the buffer and so forth.

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Convenience extensions                                           </span><span class="org-level-1"><span class="org-tag">:noexport:</span></span><span class="org-level-1">
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Using yasnippet with org-mode
</span>
   YASnippet is a template system for Emacs.
   <span class="kc-org-link-url"><a href="http://code.google.com/p/yasnippet/">http://code.google.com/p/yasnippet/</a></span>

   <span class="org-list-dt">-</span> Start typing <span class="org-verbatim">begin</span>
   <span class="org-list-dt">-</span> Press <span class="org-verbatim">C-&#167;</span> (the yas/trigger-key)
   <span class="org-list-dt">-</span> Type rest of block keyword (e.g., <span class="org-verbatim">src</span> to get a <span class="org-verbatim">begin_src</span> block)
   <span class="org-list-dt">-</span> Press <span class="org-verbatim">TAB</span>
   <span class="org-list-dt">-</span> Type header args
   <span class="org-list-dt">-</span> Press <span class="org-verbatim">TAB</span>
   <span class="org-list-dt">-</span> Fill in body of block (e.g., press <span class="org-verbatim">C-'</span> and edit code)

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> TMP Tests                                                        </span><span class="org-level-1"><span class="org-tag">:noexport:</span></span><span class="org-level-1">
</span>
<span class="org-code">: #+begin_src oz :results output :var Path=(buffer-file-name)
:   {Browse Path}
: #+end_src
</span>

<span class="org-code">: #+begin_src sh :file blue.png
:   echo "test"
: #+end_src
</span>
<span class="org-meta-line">#+results:</span>
<span class="error"><a href="file:test">file:test</a></span>




<span class="org-block-begin-line">#+begin_src python :results output
</span><span class="org-block"><span class="keyword">import</span></span><span class="org-block"> time
</span><span class="org-block-end-line">#+end_src
</span>

<span class="org-block-begin-line">#+begin_src python :results value
</span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block"> + </span><span class="org-block"><span class="highlight-numbers-number">2</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-meta-line">#+results:</span>
<span class="org-code">: None
</span>
</pre>
  </body>
</html>
