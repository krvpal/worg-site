<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.56 in css mode. -->
<html>
  <head>
    <title>ob-doc-screen.org</title>
    <style type="text/css">
    <!--
      body {
        color: #d6d6d4;
        background-color: #161719;
      }
      .builtin {
        /* font-lock-builtin-face */
        color: #fd971f;
      }
      .comment {
        /* font-lock-comment-face */
        color: #696969;
      }
      .comment-delimiter {
        /* font-lock-comment-delimiter-face */
        color: #696969;
      }
      .constant {
        /* font-lock-constant-face */
        color: #fd971f;
      }
      .doc {
        /* font-lock-doc-face */
        color: #7f7f80;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b6e63e;
      }
      .highlight-quoted-quote {
        /* highlight-quoted-quote */
        color: #9c91e4;
      }
      .italic {
        /* italic */
        font-style: italic;
      }
      .kc-org-link-url {
        /* kc-org-link-url */
        color: #d02090;
        text-decoration: underline;
      }
      .keyword {
        /* font-lock-keyword-face */
        color: #eb4509;
      }
      .org-block {
        /* org-block */
        background-color: #000000;
      }
      .org-block-begin-line {
        /* org-block-begin-line */
        color: #696969;
      }
      .org-block-end-line {
        /* org-block-end-line */
        color: #696969;
      }
      .org-code {
        /* org-code */
        color: #dfd05e;
      }
      .org-document-info {
        /* org-document-info */
        color: #fd971f;
      }
      .org-document-info-keyword {
        /* org-document-info-keyword */
        color: #555556;
      }
      .org-document-title {
        /* org-document-title */
        color: #fd971f;
        font-weight: bold;
      }
      .org-drawer {
        /* org-drawer */
        color: #cd3278;
      }
      .org-footnote {
        /* org-footnote */
        color: #fd971f;
      }
      .org-hide {
        /* org-hide */
        color: #161719;
      }
      .org-level-1 {
        /* org-level-1 */
        color: #eb4509;
        font-weight: bold;
      }
      .org-level-2 {
        /* org-level-2 */
        color: #f0b144;
        font-weight: bold;
      }
      .org-link {
        /* org-link */
        color: #fd971f;
        font-weight: bold;
        text-decoration: underline;
      }
      .org-list-dt {
        /* org-list-dt */
        color: #e2c770;
      }
      .org-meta-line {
        /* org-meta-line */
        color: #7f7f80;
      }
      .org-property-value {
        /* org-property-value */
        color: #7f7f80;
      }
      .org-special-keyword {
        /* org-special-keyword */
        color: #7f7f80;
      }
      .org-superstar-header-bullet {
      }
      .org-verbatim {
        /* org-verbatim */
        color: #b6e63e;
      }
      .rainbow-delimiters-depth-1 {
        /* rainbow-delimiters-depth-1-face */
        color: #eb4509;
      }
      .rainbow-delimiters-depth-2 {
        /* rainbow-delimiters-depth-2-face */
        color: #fd971f;
      }
      .rainbow-delimiters-depth-3 {
        /* rainbow-delimiters-depth-3-face */
        color: #b6e63e;
      }
      .string {
        /* font-lock-string-face */
        color: #e2c770;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #fd971f;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
<span class="org-meta-line">#+OPTIONS:    H:3 num:nil toc:2 \n:nil ::t |:t ^:{} -:t f:t *:t tex:t d:(HIDE) tags:not-in-toc</span>
<span class="org-meta-line">#+STARTUP:    align fold nodlcheck hidestars oddeven lognotestate hideblocks</span>
<span class="org-meta-line">#+SEQ_TODO:   TODO(t) INPROGRESS(i) WAITING(w@) | DONE(d) CANCELED(c@)</span>
<span class="org-meta-line">#+TAGS:       Write(w) Update(u) Fix(f) Check(c)</span>
<span class="org-document-info-keyword">#+TITLE:</span>      <span class="org-document-title">org-babel-screen
</span><span class="org-document-info-keyword">#+AUTHOR:</span>     <span class="org-document-info">Benjamin Andresen
</span><span class="org-document-info-keyword">#+EMAIL:</span>      <span class="org-document-info">b.andresen@gmail.com
</span><span class="org-meta-line">#+LANGUAGE:   en</span>

<span class="org-block-begin-line">#+begin_export html
</span><span class="org-block">  &lt;</span><span class="org-block"><span class="function-name">div</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">id</span></span><span class="org-block">=</span><span class="org-block"><span class="string">"subtitle"</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">style</span></span><span class="org-block">=</span><span class="org-block"><span class="string">"float: center; text-align: center;"</span></span><span class="org-block">&gt;
    &lt;</span><span class="org-block"><span class="function-name">p</span></span><span class="org-block">&gt;Org-babel support for interactive terminals&lt;/</span><span class="org-block"><span class="function-name">p</span></span><span class="org-block">&gt;
  &lt;/</span><span class="org-block"><span class="function-name">div</span></span><span class="org-block">&gt;
</span><span class="org-block-end-line">#+end_export
</span>
<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Introduction
</span>  <span class="org-drawer">:PROPERTIES:</span>
  <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">introduction</span>
  <span class="org-drawer">:END:</span>
  org-babel-screen is an extension to <span class="org-link"><a href="file:../index.org">Org-babel</a></span> and was inspired by
  <span class="kc-org-link-url"><a href="http://angg.twu.net/">Eduardo Ochs</a></span>'s <span class="kc-org-link-url"><a href="http://angg.twu.net/eev-article.html">eev</a></span>.

  org-babel-screen provides the ability to write interactive <span class="kc-org-link-url"><a href="https://en.wikipedia.org/wiki/Make_(software)">Makefiles</a></span>
  that can be called from inside <span class="kc-org-link-url"><a href="http://www.gnu.org/software/emacs/">Emacs</a></span>. Now before you get your hopes
  up: The whole point of Makefiles is that they should run automatic.
  org-babel-screen doesn't do that! I guess the only thing they have
  in common is that they both do certain things. And that they can be
  grouped.

  I admit, the analogy is not great. But to explain why I still think
  it's useful I will go and show a few examples in this document.

  First install org-babel according to the directions given in the
  <span class="org-link"><a href="file:../index.org::#getting-started">org-babel manual</a></span>. Then come back here.

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Setup
</span>  Now that you've installed org-babel, add the following after the
  other org-babel related statements.
<span class="org-block-begin-line">  #+begin_src emacs-lisp
</span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">require</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="constant">org-babel-screen</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">    </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">requires screen, terminal
</span></span><span class="org-block-end-line">  #+end_src
</span>
  There are two important variables that you might want to review
  before using org-babel-screen:
  <span class="italic">org-babel-screen-location</span> and <span class="italic">org-babel-default-header-args:screen</span>

  If <span class="kc-org-link-url"><a href="http://www.gnu.org/software/screen/">GNU Screen</a></span> is installed and recognized by your PATH you can
  ignore <span class="italic">org-babel-screen-location</span>, otherwise change the value of
  that variable to the absolute path of the screen binary.

  The default headers arguments are a bit more interesting. If you
  don't have <span class="kc-org-link-url"><a href="http://invisible-island.net/xterm/">XTerm</a></span> installed or you don't wish to use it, you need to
  edit the value of <span class="italic">org-babel-default-header-args:screen</span>.

  This is the default:
<span class="org-block-begin-line">  #+begin_src emacs-lisp
</span><span class="org-block">    </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="keyword">defvar</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">org-babel-default-header-args:screen</span></span><span class="org-block">
    </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">(</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="builtin">:results</span></span><span class="org-block"> . </span><span class="org-block"><span class="string">"silent"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="builtin">:session</span></span><span class="org-block"> . </span><span class="org-block"><span class="string">"default"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="builtin">:cmd</span></span><span class="org-block"> . </span><span class="org-block"><span class="string">"sh"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"> </span><span class="org-block"><span class="rainbow-delimiters-depth-3">(</span></span><span class="org-block"><span class="builtin">:terminal</span></span><span class="org-block"> . </span><span class="org-block"><span class="string">"xterm"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-3">)</span></span><span class="org-block"><span class="rainbow-delimiters-depth-2">)</span></span><span class="org-block">
    </span><span class="org-block"><span class="doc">"Default arguments to use when running screen source blocks."</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">  #+end_src
</span>
  The <span class="italic">:session</span>, <span class="italic">:cmd</span> &amp; <span class="italic">:terminal</span> keys are the only thing that
  matter in this mode.

  You can test the default setup by executing <span class="org-verbatim">M-x org-babel-screen-test RET</span>.
  The minibuffer will echo if the test has succeeded or not. <span class="org-footnote">[fn:1]</span>

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Example 1: Creating a gif out of a video file
</span>  <span class="org-drawer">:PROPERTIES:</span>
  <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Example1</span>
  <span class="org-drawer">:END:</span>
  Let's get on with the examples though: I'm going to use <span class="kc-org-link-url"><a href="http://www.mplayerhq.hu">MPlayer</a></span>, <span class="kc-org-link-url"><a href="http://spiegl.de/qiv/">QIV</a></span>
  &amp; <span class="kc-org-link-url"><a href="http://www.imagemagick.org">ImageMagick</a></span> for this. But you can follow this example without
  them.

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Set the correct settings
</span>    I'm setting the session name of <span class="italic">create-gif</span> so I can have other
    interactive terminals running without interference. Example 2 will
    go further into this.

    The <span class="italic">:cmd</span> is zsh, because that's my favorite shell and I know how
    to do globbing with it.

    This example is very verbose, but here it goes:

<span class="org-code">:    #+begin_src screen :cmd zsh :session create-gif
:      TMPDIR=/tmp/gif
:      VIDEOFILE=~/TMP/DubistTerrorist_de_divx_HD.avi
:    #+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Create TMPDIR and change directory to it
</span>   The <span class="italic">:session</span> parameter has to be the same as the one used in the
   first step, the <span class="italic">:cmd</span> parameter can be ignored though.
<span class="org-code">:   #+begin_src screen :session create-gif
:     mkdir -p $TMPDIR
:     cd $TMPDIR
:   #+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Copy video to TMPDIR
</span><span class="org-code">:   #+begin_src screen :session create-gif
:     cp -v $VIDEOFILE .
:     VIDEOFILE=$VIDEOFILE:t
:   #+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Skip through the video file to find the spot you want to extract
</span>   This is the first interactive step. Find the position in the video
   of the section you want to extract. This information will be used
   in the next step.
<span class="org-code">:   #+begin_src screen :session create-gif
:     mplayer -ao null -osdlevel 3 $VIDEOFILE
:   #+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Extract those frames from the  video
</span>   Change the value of <span class="italic">START</span> and optionally <span class="italic">SECS</span>.
   For this video I've chosen 1:10 with a 10 seconds window.
<span class="org-code">:   #+begin_src screen :session create-gif
:     START=1:00
:     SECS=10
:
:     mplayer -ao null -vo png $VIDEOFILE -ss $START -endpos $SECS
:   #+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Delete the frames you don't want
</span>   This is the second interactive part.

   You delete the frames by pressing 'd' in qiv.
<span class="org-code">:   #+begin_src screen :session create-gif
:     qiv .
:   #+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Resize pictures
</span>   256 x the corresponding aspect ratio is a good size.
<span class="org-code">:   #+begin_src screen :session create-gif
:     SCALE=25%
:
:     mkdir Small/
:     for img (*.png) { convert -scale $SCALE $img Small/$img }
:     file Small/*.png([1])
:   #+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Inspect down-scaled size
</span>   If the size isn't alright, redo the previous step with a different SCALE.

<span class="org-code">:   #+begin_src screen :session create-gif
:     qiv Small/*.png
:   #+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Generate gif file
</span>   The settings here are for an endless looping gif. If the gif plays
   to fast or too slow, you can just change the command line options
   as you normally would.
<span class="org-code">:   #+begin_src screen :session create-gif
:     convert -delay 10 -loop 0 Small/* animation.gif
:   #+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Look at the resulting gif
</span>   I use opera for this. If the gif is not satisfactory, repeat the
   above steps as necessary.
<span class="org-code">:   #+begin_src screen :session create-gif
:     opera animation.gif
:   #+end_src
</span>
<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Example 2: Semi-parallel communication via netcat
</span>  <span class="org-drawer">:PROPERTIES:</span>
  <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">Example2</span>
  <span class="org-drawer">:END:</span>
  This is a very small example<span class="org-footnote">[fn:2]</span>, but expands on the concept of sessions
  well. The objective is to send a message via TCP to someone else.
  (We fake this by doing everything via localhost The principle is the same.)

<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Listen for message
</span>   Set up <span class="kc-org-link-url"><a href="http://netcat.sourceforge.net/">netcat</a></span> to listen to port 1234.

   Notice the <span class="italic">:session</span> parameter. Specifying <span class="org-verbatim">receiver</span> here and
   <span class="org-verbatim">sender</span> below allows us to run this example from a single source
   but with two interactive seesions.
<span class="org-code">:   #+begin_src screen :session receiver
:     netcat -l -p 1234
:   #+end_src
</span>
<span class="org-hide">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Send the message
</span>   Use the default shell (<span class="italic">:cmd</span> has been omitted.) to generate a
   message and send it to the port that is listening for it.
<span class="org-code">:   #+begin_src screen :session sender
:     {
:      echo hi
:      sleep 1
:      echo bye
:      sleep 1
:     } | netcat -c localhost 1234
:   #+end_src
</span>
  After you've invoked both examples, you can see how the <span class="org-verbatim">receiver</span>
  session sees the message send by <span class="org-verbatim">sender</span>.

  How this might be useful: You could take this example further and
  test an app that communicated via a network interface. You wouldn't
  have a fully automatic setup yet, but the <span class="org-link"><a href="file:../index.org::#reproducible-research">Reproducible Research</a></span>
  concept still applies.

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Header Arguments
</span>  <span class="org-drawer">:PROPERTIES:</span>
  <span class="org-special-keyword">:CUSTOM_ID:</span> <span class="org-property-value">header-arguments</span>
  <span class="org-drawer">:END:</span>
  Here's a general overview of header arguments:

<span class="org-list-dt">-</span> <span class="org-list-dt">session ::</span> session name that is used by screen
  <span class="org-list-dt">-</span> <span class="org-list-dt">default value ::</span> default

<span class="org-list-dt">-</span> <span class="org-list-dt">cmd ::</span> argument must be a shell of some sort
  <span class="org-list-dt">-</span> <span class="org-list-dt">default value ::</span> sh
  <span class="org-list-dt">-</span> <span class="org-list-dt">examples ::</span> sh, zsh, irb, python, sqlite3

<span class="org-list-dt">-</span> <span class="org-list-dt">terminal ::</span> must support -T 'title' and -e 'command'
  <span class="org-list-dt">-</span> <span class="org-list-dt">default value ::</span> xterm
  <span class="org-list-dt">-</span> <span class="org-list-dt">examples ::</span> xterm, urxvt, aterm, Eterm

<span class="org-list-dt">-</span> <span class="org-list-dt">results ::</span> argument currently ignored
  <span class="org-list-dt">-</span> <span class="org-list-dt">default value ::</span> silent

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Footnotes
</span>
<span class="org-footnote">[fn:1]</span> It does this by generating a random string, writing it via
org-screen-babel to /tmp/testfile and reading it back via Emacs. If
the validation fails, the setup is deemed broken.

<span class="org-footnote">[fn:2]</span> The example is taken from Eev as well: <span class="kc-org-link-url"><a href="http://angg.twu.net/eev-current/anim/channels.anim.html">channels.anim</a></span>
</pre>
  </body>
</html>
