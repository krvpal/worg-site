<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.56 in css mode. -->
<html>
  <head>
    <title>Rpackage.org</title>
    <style type="text/css">
    <!--
      body {
        color: #d6d6d4;
        background-color: #161719;
      }
      .bold {
        /* bold */
        font-weight: bold;
      }
      .comment {
        /* font-lock-comment-face */
        color: #696969;
      }
      .comment-delimiter {
        /* font-lock-comment-delimiter-face */
        color: #696969;
      }
      .constant {
        /* font-lock-constant-face */
        color: #fd971f;
      }
      .custom {
      }
      .error {
        /* error */
        color: #e74c3c;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #b6e63e;
      }
      .highlight-numbers-number {
        /* highlight-numbers-number */
        color: #9c91e4;
        font-weight: bold;
      }
      .highlight-quoted-quote {
        /* highlight-quoted-quote */
        color: #9c91e4;
      }
      .italic {
        /* italic */
        font-style: italic;
      }
      .kc-org-link-url {
        /* kc-org-link-url */
        color: #d02090;
        text-decoration: underline;
      }
      .org-archived {
        /* org-archived */
        color: #7f7f80;
      }
      .org-block {
        /* org-block */
        background-color: #000000;
      }
      .org-block-begin-line {
        /* org-block-begin-line */
        color: #696969;
      }
      .org-block-end-line {
        /* org-block-end-line */
        color: #696969;
      }
      .org-code {
        /* org-code */
        color: #dfd05e;
      }
      .org-document-info {
        /* org-document-info */
        color: #fd971f;
      }
      .org-document-info-keyword {
        /* org-document-info-keyword */
        color: #555556;
      }
      .org-document-title {
        /* org-document-title */
        color: #fd971f;
        font-weight: bold;
      }
      .org-level-1 {
        /* org-level-1 */
        color: #eb4509;
        font-weight: bold;
      }
      .org-level-2 {
        /* org-level-2 */
        color: #f0b144;
        font-weight: bold;
      }
      .org-level-3 {
        /* org-level-3 */
        color: #8ec298;
        font-weight: bold;
      }
      .org-level-4 {
        /* org-level-4 */
        color: #5ca8dd;
        font-weight: bold;
      }
      .org-link {
        /* org-link */
        color: #fd971f;
        font-weight: bold;
        text-decoration: underline;
      }
      .org-list-dt {
        /* org-list-dt */
        color: #e2c770;
      }
      .org-meta-line {
        /* org-meta-line */
        color: #7f7f80;
      }
      .org-superstar-header-bullet {
      }
      .org-superstar-leading {
        /* org-superstar-leading */
        color: #bebebe;
        background-color: #010000;
      }
      .org-table {
        /* org-table */
        color: #9c91e4;
      }
      .org-tag {
        /* org-tag */
        color: #e2c770;
      }
      .org-target {
        /* org-target */
        text-decoration: underline;
      }
      .org-verbatim {
        /* org-verbatim */
        color: #b6e63e;
      }
      .rainbow-delimiters-depth-1 {
        /* rainbow-delimiters-depth-1-face */
        color: #eb4509;
      }
      .sh-quoted-exec {
        /* sh-quoted-exec */
        color: #9c91e4;
        font-weight: bold;
      }
      .string {
        /* font-lock-string-face */
        color: #e2c770;
      }
      .type {
        /* font-lock-type-face */
        color: #66d9ef;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #fd971f;
      }
      .whitespace-tab {
        /* whitespace-tab */
        color: #4e4e4e;
        background-color: #2d2e2e;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
<span class="org-meta-line">#+OPTIONS:    H:3 num:nil toc:2 \n:nil ::t |:t ^:{} -:t f:t *:t tex:t d:(HIDE) tags:not-in-toc</span>
<span class="org-document-info-keyword">#+TITLE:</span>     <span class="org-document-title">Rpackage.org
</span><span class="org-document-info-keyword">#+AUTHOR:</span>    <span class="org-document-info">Charles C. Berry    
</span><span class="org-document-info-keyword">#+EMAIL:</span>     <span class="org-document-info">cberry@tajo.ucsd.edu
</span><span class="org-document-info-keyword">#+DATE:</span>      <span class="org-document-info">2010-12-08 Thur
</span><span class="org-meta-line">#+DESCRIPTION: R Package Development Helpers</span>

<span class="org-meta-line">#+PROPERTY: exports none</span>

<span class="org-block-begin-line">#+begin_export html
</span><span class="org-block">  &lt;</span><span class="org-block"><span class="function-name">div</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">id</span></span><span class="org-block">=</span><span class="org-block"><span class="string">"subtitle"</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">style</span></span><span class="org-block">=</span><span class="org-block"><span class="string">"float: center; text-align: center;"</span></span><span class="org-block">&gt;
  &lt;</span><span class="org-block"><span class="function-name">p</span></span><span class="org-block">&gt;
Org-babel support for building 
  &lt;</span><span class="org-block"><span class="function-name">a</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">href</span></span><span class="org-block">=</span><span class="org-block"><span class="string">"<a href="http://www.r-project.org/">http://www.r-project.org/</a>"</span></span><span class="org-block">&gt;R&lt;/</span><span class="org-block"><span class="function-name">a</span></span><span class="org-block">&gt; packages
  &lt;/</span><span class="org-block"><span class="function-name">p</span></span><span class="org-block">&gt;
  &lt;</span><span class="org-block"><span class="function-name">p</span></span><span class="org-block">&gt;
  &lt;</span><span class="org-block"><span class="function-name">a</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">href</span></span><span class="org-block">=</span><span class="org-block"><span class="string">"<a href="http://www.r-project.org/">http://www.r-project.org/</a>"</span></span><span class="org-block">&gt;
  &lt;</span><span class="org-block"><span class="function-name">img</span></span><span class="org-block"> </span><span class="org-block"><span class="variable-name">src</span></span><span class="org-block">=</span><span class="org-block"><span class="string">"<a href="http://www.r-project.org/Rlogo.jpg&quot;/">http://www.r-project.org/Rlogo.jpg"</a></span></span><span class="org-block"><a href="http://www.r-project.org/Rlogo.jpg&quot;/">/</a>&gt;
  &lt;/</span><span class="org-block"><span class="function-name">a</span></span><span class="org-block">&gt;
  &lt;/</span><span class="org-block"><span class="function-name">p</span></span><span class="org-block">&gt;
  &lt;/</span><span class="org-block"><span class="function-name">div</span></span><span class="org-block">&gt;
</span><span class="org-block-end-line">#+end_export
</span>

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Document Purpose 
</span>
This document contains  
<span class="org-list-dt">-</span> tools useful for writing R extensions called <span class="italic">packages</span>
<span class="org-list-dt">-</span> source code to create a simple R package.

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> R packages
</span>
<span class="org-list-dt">-</span> The <span class="kc-org-link-url"><a href="http://www.r-project.org">R language and environment</a></span> for statistical computation and
  graphics has a powerful system for developing and distributing
  software enhancements and datasets called <span class="italic">packages</span>.
<span class="org-list-dt">-</span> A vast archive of such packages ---called <span class="kc-org-link-url"><a href="http://cran.r-project.org/">CRAN</a></span> --- is available.
<span class="org-list-dt">-</span> Users can create their own packages by following instructions in
  <span class="kc-org-link-url"><a href="http://cran.r-project.org/doc/manuals/R-exts.html">Writing R Extensions</a></span>.

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Some notes on this document and </span><span class="org-level-1"><span class="org-verbatim">org-babel</span></span><span class="org-level-1">
</span>
<span class="org-list-dt">-</span> This document provides tools for R package development using org-mode.

<span class="org-list-dt">-</span> There are two somewhat contrary philosophies about how R packages are
  managed using <span class="org-verbatim">org-babel</span>. 
  <span class="org-list-dt">-</span> One camp holds that all of the code for a package should be kept
    in one master <span class="org-verbatim">*.org</span> document, which when tangled produces the source
    directory files needed. The <span class="org-verbatim">.org</span> document also holds notes, utility
    functions, navigation tools, and code snippets. A very simple R
    package is included below, and it can be checked, installed, and
    run from this <span class="org-verbatim">.org</span> document.
  <span class="org-list-dt">-</span> The other camp leaves the <span class="org-verbatim">R</span> and <span class="org-verbatim">Rd</span> code and other package
    files in the package directory subfolders and edits them
    there. 
  <span class="org-list-dt">-</span> The tools shown here support either approach.

<span class="org-list-dt">-</span> Some introductory tips at <span class="org-link"><a href="file:../languages/ob-doc-R.org">ob-doc-R</a></span> show how to enable full editing
  support for R code with ESS (<span class="kc-org-link-url"><a href="http://ess.r-project.org/">http://ess.r-project.org/</a></span>).

<span class="org-list-dt">-</span> This document is to be put in the top level source directory of an R
 package (i.e. at the same level as the DESCRIPTION file). To try it
  out using the built in package, create a fresh diretory named
  <span class="org-verbatim">countRows</span> and just put it there.

<span class="org-list-dt">-</span> version control blocks here use svn calls, and you may need to
  replace these with your own.

<span class="org-list-dt">-</span> <span class="org-verbatim">#+begin_src sh ... #+end_src</span> shell blocks work on systems that
  support unix-like shells. On Windows systems these blocks would
  likely need to be changed.

<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Typical Workflow
</span> <span class="org-list-dt">-</span> <span class="kc-org-link-url"><a href="https://code.orgmode.org/bzg/worg/src/master/org-contrib/babel/examples/Rpackage.org">Download</a></span> the <span class="org-verbatim">.org</span> version of this document
 <span class="org-list-dt">-</span> Create a package directory (naming it like the package is convenient)
  <span class="org-list-dt">-</span> Copy the <span class="org-verbatim">.org</span> version of this document into that directory
  <span class="org-list-dt">-</span> Move point to the  <span class="org-verbatim">set up .Rbuildignore</span> headline and execute it
    (see <span class="org-link"><a href="howrun">1</a></span>)  
  <span class="org-list-dt">-</span> Create some package files, <span class="bold">or</span> create src blocks as outlined in
    this document and run <span class="org-verbatim">org-babel-tangle</span> to create the package
    files.
  <span class="org-list-dt">-</span> Repeat these  steps:
    <span class="org-list-dt">-</span> Either 
      <span class="org-list-dt">-</span> INSTALL the package<span class="org-link"><a href="howrun">1</a></span> or
      <span class="org-list-dt">-</span> check the package<span class="org-link"><a href="howrun">1</a></span>
      <span class="org-list-dt">-</span> Load some code (i.e. for a function) using ESS and try it out.
      <span class="org-list-dt">-</span> Inspect a formatted help page
    <span class="org-list-dt">-</span> Edit the code. Re-tangle as, and if, needed.
  <span class="org-list-dt">-</span> Once the package is ready, build it or INSTALL it to a permanent
    location
<span class="org-target">&lt;&lt;howrun&gt;&gt;</span> 
<span class="org-code">:    1. moving point to the corresponding headline, then
:       typing 'C-c C-v C-s y' or 
:       'M-x org-babel-execute-subtree'
:       will execute each tool.
</span>
<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> R procedures
</span>
<span class="org-superstar-leading">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> check package
</span>
<span class="org-list-dt">-</span> Environment variables like these may be added in the next src block:
   <span class="org-list-dt">-</span> <span class="org-verbatim">export R_LIBS=Rlib</span>
   <span class="org-list-dt">-</span> <span class="org-verbatim">export R_ARCH=x86_64</span>

<span class="org-block-begin-line">#+begin_src sh :results output
</span><span class="org-block"><span class="variable-name">CWD</span></span><span class="org-block">=</span><span class="org-block"><span class="sh-quoted-exec">`</span></span><span class="org-block"><span class="type"><span class="sh-quoted-exec">pwd</span></span></span><span class="org-block"><span class="sh-quoted-exec">`</span></span><span class="org-block">
</span><span class="org-block"><span class="type">cd</span></span><span class="org-block"> ..; R CMD check $</span><span class="org-block"><span class="variable-name">CWD</span></span><span class="org-block"> | sed </span><span class="org-block"><span class="string">'s/^*/ */'</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-code">: #+begin_src sh :results output
: CWD=`pwd`
: cd ..; R CMD check $CWD | sed 's/^*/ */'
: #+end_src
</span>
<span class="org-superstar-leading">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> INSTALL package
</span>
<span class="org-list-dt">-</span> customize the <span class="org-verbatim">rckopts</span> variable, possibly "rckopts="
<span class="org-list-dt">-</span> Variables may be also added next src block
  -- <span class="org-verbatim">export R_ARCH=x86_64</span>

<span class="org-block-begin-line">#+begin_src sh :results output :var rckopts="--library=./Rlib"
</span><span class="org-block"><span class="variable-name">CWD</span></span><span class="org-block">=</span><span class="org-block"><span class="sh-quoted-exec">`</span></span><span class="org-block"><span class="type"><span class="sh-quoted-exec">pwd</span></span></span><span class="org-block"><span class="sh-quoted-exec">`</span></span><span class="org-block">
</span><span class="org-block"><span class="type">cd</span></span><span class="org-block"> ..; R CMD INSTALL $</span><span class="org-block"><span class="variable-name">rckopts</span></span><span class="org-block"> $</span><span class="org-block"><span class="variable-name">CWD</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-code">: #+begin_src sh :results output :var rckopts="--library=./Rlib"
: CWD=`pwd`
: cd ..; R CMD INSTALL $rckopts $CWD
: #+end_src
</span>
<span class="org-superstar-leading">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> build package
</span>
<span class="org-block-begin-line">#+begin_src sh :results output
</span><span class="org-block"><span class="variable-name">CWD</span></span><span class="org-block">=</span><span class="org-block"><span class="sh-quoted-exec">`</span></span><span class="org-block"><span class="type"><span class="sh-quoted-exec">pwd</span></span></span><span class="org-block"><span class="sh-quoted-exec">`</span></span><span class="org-block">
</span><span class="org-block"><span class="type">cd</span></span><span class="org-block"> ..; R CMD build $</span><span class="org-block"><span class="variable-name">CWD</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-code">: #+begin_src sh :results output
: CWD=`pwd`
: cd ..; R CMD build $CWD
: #+end_src
</span>
<span class="org-superstar-leading">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> help pages
</span>
<span class="org-list-dt">-</span> The src block adds enough asterisks to the line listing each
  filename to turn it into a headline at the next level down. This is
  helpful if you have a lot of help pages and want to fold them up for
  browsing.

<span class="org-block-begin-line">#+begin_src R :results output :var hdlev=(car (org-heading-components))
</span>  linestart &lt;- paste( c( "\n", rep('*<span class="bold">', hdlev+1 ) ), collapse='')
  rd.files &lt;- Sys.glob("man/</span>*.Rd")
  for ( ird in rd.files ){
    hlp.txt &lt;- capture.output(tools:::Rd2txt( ird ) )
    hlp.txt &lt;- gsub( "_\b","", hlp.txt)
    headline &lt;- paste( linestart, ird ,'\n' )
    cat( headline, hlp.txt , sep='\n')
  }
<span class="org-block-end-line">#+end_src
</span>
<span class="org-code">: #+begin_src R :results output :var hdlev=(car (org-heading-components))
:   linestart &lt;- paste( c( "\n", rep('*', hdlev+1 ) ), collapse='')
:   rd.files &lt;- Sys.glob("man/*.Rd")
:   for ( ird in rd.files ){
:     hlp.txt &lt;- capture.output(tools:::Rd2txt( ird ) )
:     hlp.txt &lt;- gsub( "_\b","", hlp.txt)
:     headline &lt;- paste( linestart, ird ,'\n' )
:     cat( headline, hlp.txt , sep='\n')
:   }
: #+end_src
</span>  

<span class="org-superstar-leading">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> load library
</span>
<span class="org-block-begin-line">#+begin_src R :session :results output :var libname=(file-name-directory buffer-file-name)
</span><span class="org-tag">##</span> customize the next line as needed: 
.libPaths(new = file.path(getwd(),"Rlib") )
require( basename(libname), character.only=TRUE)
<span class="org-block-end-line">#+end_src
</span>
<span class="org-list-dt">-</span> this loads the library into an R session
<span class="org-list-dt">-</span> customize or delete the <span class="org-verbatim">.libPaths</span> line as desired 


<span class="org-code">: #+begin_src R :session :var libname=(file-name-directory buffer-file-name)
: .libPaths(new = file.path(getwd(),"Rlib") )
: require( basename(libname), character.only=TRUE)
: #+end_src
</span>
<span class="org-superstar-leading">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> grep require( 
</span>
<span class="org-list-dt">-</span> if you keep all your source code in this <span class="org-verbatim">.org</span> document, then you do not
  need to do this - instead just type <span class="org-verbatim">C-s require(</span>
<span class="org-list-dt">-</span> list package dependencies that might need to be dealt with

<span class="org-block-begin-line">#+begin_src sh :results output
</span><span class="org-block"><span class="type">grep</span></span><span class="org-block"> </span><span class="org-block"><span class="string">'require('</span></span><span class="org-block"> R/*
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-code">: #+begin_src sh :results output
: grep 'require(' R/*
: #+end_src
</span>
<span class="org-superstar-leading">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> set up .Rbuildignore and man, R, and Rlib directories
</span>
<span class="org-list-dt">-</span> This document sits in the top level source directory. So, ignore it
  and its offspring when checking, installing and building.
<span class="org-list-dt">-</span> List all files to ignore under <span class="org-verbatim">#+results: rbi</span>  (including this
  one!). Regular expressions are allowed.
<span class="org-list-dt">-</span> Rlib is optional. If you want to INSTALL in the system directory,
  you won't need it.

<span class="org-code">: #+results: rbi
</span><span class="org-meta-line">#+results: rbi</span>
<span class="org-code">: Rpackage.*
</span>
Only need to run this once (unless you add more ignorable files).

<span class="org-block-begin-line">#+begin_src R :results output silent :var rbld=rbi 
</span>cat(rbld,'\n', file=".Rbuildignore")
dir.create("man")
dir.create("R")
dir.create("../Rlib")
<span class="org-block-end-line">#+end_src
</span>
<span class="org-code">: #+begin_src R :results output silent :var rbld=rbi 
: cat(rbld,'\n', file=".Rbuildignore")
: dir.create("man")
: dir.create("R")
: dir.create("../Rlib")
: #+end_src
</span>
<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Project Specific Entries
</span>
Package specific notes and blocks go here. It is a good idea to have
several second level headlines --- possibly including the package code
--- to group things by topic/idea, then a third level headline for
almost every src block and TODO item.

<span class="org-superstar-leading">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> </span><span class="org-level-2"><span class="org-archived">Package structure and src languages</span></span><span class="whitespace-tab">                          </span><span class="org-level-2"><span class="org-archived">    </span></span><span class="org-level-2"><span class="org-tag"><span class="org-archived">:ARCHIVE:noexport:</span></span></span><span class="org-level-2">
</span>
<span class="org-list-dt">-</span> The top level directory may contain these files (and others):

<span class="org-table">| filename    | filetype      |</span>
<span class="org-table">|-------------+---------------|</span>
<span class="org-table">| INDEX       | text          |</span>
<span class="org-table">| NAMESPACE   | R-like script |</span>
<span class="org-table">| configure   | Bourne shell  |</span>
<span class="org-table">| cleanup     | Bourne shell  |</span>
<span class="org-table">| LICENSE     | text          |</span>
<span class="org-table">| LICENCE     | text          |</span>
<span class="org-table">| COPYING     | text          |</span>
<span class="org-table">| NEWS        | text          |</span>
<span class="org-table">| DESCRIPTION | </span><span class="kc-org-link-url"><a href="http://www.debian.org/doc/debian-policy/ch-controlfields.html">DCF</a></span><span class="org-table">           |</span>
<span class="org-table">|-------------+---------------|</span>


 
   and subdirectories
<span class="org-table">| direname | types of files                                   |</span>
<span class="org-table">|----------+--------------------------------------------------|</span>
<span class="org-table">| R        | R                                                |</span>
<span class="org-table">| data     | various                                          |</span>
<span class="org-table">| demo     | R                                                |</span>
<span class="org-table">| exec     | various                                          |</span>
<span class="org-table">| inst     | various                                          |</span>
<span class="org-table">| man      | Rd                                               |</span>
<span class="org-table">| po       | poEdit                                           |</span>
<span class="org-table">| src      | .c, .cc or .cpp, .f, .f90, .f95, .m, .mm, .M, .h |</span>
<span class="org-table">| tests    | R, Rout                                          |</span>
<span class="org-table">|----------+--------------------------------------------------|</span>

<span class="org-superstar-leading">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Example: The countRows package
</span>
<span class="org-list-dt">-</span> This example illustrates how to use the <span class="org-verbatim">.org</span> document as the source code
  master. By navigating to the <span class="org-verbatim">INSTALL package</span> headline and entering
  <span class="org-verbatim">C-c C-v C-s y</span>, the INSTALL command is run. Likewise for <span class="org-verbatim">check
  package</span>, <span class="org-verbatim">help pages</span>, and the other tools.

<span class="org-list-dt">-</span> The <span class="org-verbatim">countRows</span> package implements a simple, but quick way to count the rows of
  a <span class="org-verbatim">data.frame</span>. It is akin to <span class="org-verbatim">sort | uniq -c</span> in a Unix-alike shell.

<span class="org-list-dt">-</span> The package is based on a function that was posted in this <span class="kc-org-link-url"><a href="https://stat.ethz.ch/pipermail/r-help/2008-January/151489.html">reply</a></span> to
  a <span class="kc-org-link-url"><a href="https://stat.ethz.ch/pipermail/r-help/2008-January/151372.html">query</a></span> on the R-help list.

<span class="org-superstar-leading">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> The DESCRIPTION File
</span>
<span class="org-list-dt">-</span> The DESCRIPTION file is obligatory
<span class="org-list-dt">-</span> It follows Debian Control File format.
<span class="org-list-dt">-</span> Required and optional fields are described in <span class="kc-org-link-url"><a href="http://cran.r-project.org/doc/manuals/R-exts.html">Writing R Extensions</a></span>.

<span class="org-block-begin-line">#+begin_src sh :results silent :tangle DESCRIPTION :eval nil
</span><span class="org-block">  Package: countRows
  Type: Package
  Title: Count Rows of a data.frame
  Version: </span><span class="org-block"><span class="highlight-numbers-number">1.0</span></span><span class="org-block">
  Date: 2010-12-08
  Author: Charles C. Berry
  Maintainer: Charles Berry <a href="mailto:cberry%40tajo.ucsd.edu">&lt;cberry@tajo.ucsd.edu&gt;</a>
  Description: One of many ways to count the rows of a data.frame. 
          Akin to </span><span class="org-block"><span class="string">'sort | uniq -c'</span></span><span class="org-block"> shell command
  License: GPL-3
  LazyLoad: yes
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-code">: #+begin_src sh :results silent :tangle DESCRIPTION :eval nil
: Package: countRows
: Type: Package
: Title: Count Rows of a data.frame
: Version: 1.0
: Date: 2010-12-08
: Author: Charles C. Berry
: Maintainer: Charles Berry <a href="mailto:cberry%40tajo.ucsd.edu">&lt;cberry@tajo.ucsd.edu&gt;</a>
: Description: One of many ways to count the rows of a data.frame. 
:         Akin to 'sort | uniq -c' shell command
: License: GPL-3
: LazyLoad: yes
: #+end_src 
</span>
<span class="org-superstar-leading">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> R code
</span>
<span class="org-list-dt">-</span> Each <span class="org-verbatim">#+begin_src R</span> block defines one or more functions. 
<span class="org-list-dt">-</span> The <span class="org-verbatim">:tangle</span> header tells where to place the code

<span class="org-superstar-leading">***</span><span class="org-level-4"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-4"> count.rows function
</span>
<span class="org-block-begin-line">#+begin_src R :eval nil :tangle R/count.rows.R
</span>  count.rows &lt;-
    function( x )
    {
      order.x &lt;- do.call( order, as.data.frame(x) )
      equal.to.previous &lt;-
        rowSums( x[tail(order.x,-1),] != x[head(order.x,-1),] )==0
       tf.runs &lt;- rle(equal.to.previous)
       counts &lt;- c(1,
                   unlist(mapply( function(x,y) if (y) x+1 else (rep(1,x)),
                                 tf.runs$length, tf.runs$value )))
       counts &lt;- counts[ c( diff( counts ) &lt;= 0, TRUE ) ]
       unique.rows &lt;- which( c(TRUE, !equal.to.previous ) )
       cbind( counts, x[ order.x[ unique.rows ], ,drop=FALSE ] )
     }
<span class="org-block-end-line">#+end_src
</span>

<span class="org-code">: #+begin_src R :eval nil :exports code :tangle R/count.rows.R  
:   count.rows &lt;-
:     function( x )
:     {
:       order.x &lt;- do.call( order, as.data.frame(x) )
:       equal.to.previous &lt;-
:         rowSums( x[tail(order.x,-1),] != x[head(order.x,-1),] )==0
:        tf.runs &lt;- rle(equal.to.previous)
:        counts &lt;- c(1,
:                    unlist(mapply( function(x,y) if (y) x+1 else (rep(1,x)),
:                                  tf.runs$length, tf.runs$value )))
:        counts &lt;- counts[ c( diff( counts ) &lt;= 0, TRUE ) ]
:        unique.rows &lt;- which( c(TRUE, !equal.to.previous ) )
:        cbind( counts, x[ order.x[ unique.rows ], ,drop=FALSE ] )
:      }
: #+end_src 
</span>
<span class="org-superstar-leading">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Rd help page markup
</span>
<span class="org-list-dt">-</span> There is usually one <span class="org-verbatim">#+begin_src Rd</span> block for each help page
<span class="org-list-dt">-</span> Usually one page covers the package as a whole and other cover the
  functions and datasets it includes.

<span class="org-superstar-leading">***</span><span class="org-level-4"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-4"> count.rows
</span><span class="org-block-begin-line">#+begin_src Rd :eval nil :tangle man/count.rows.Rd
</span>  \name{count.rows}
  \alias{count.rows}
  \title{ Count \code{data.frame} rows }
  \description{ Counts the unique rows of a \code{data.frame} }
  \usage{ count.rows(x) }
  \arguments{
    \item{x}{
      Just a \code{data.frame} or \code{matrix}
    }
  }
  \details{
    Basically, this function tries to be smart about counting
    rows. It relies on the \code{\link{order}} function and basic logic to
    do the heavy lifting.  
  }
  \value{
    A \code{data.frame} with a column named \code{counts}, all the olumns
    of \code{x} and the rows that would appear in \code{unique( x )}. 
  }
  \author{
    Charles C. Berry \email{ccberry@ucsd.tajo.edu }
  }
  \examples{
  hec.frame &lt;- as.data.frame( HairEyeColor )
  hec.frame &lt;-
    hec.frame[ rep(1:nrow(hec.frame), hec.frame$Freq ), ]
  hec.counts &lt;- count.rows( hec.frame )
  all.equal( hec.counts$counts, hec.counts$Freq )
  hec.counts
  
  }
   \keyword{ manip }
<span class="org-block-end-line">#+end_src
</span>
<span class="org-code">: #+begin_src Rd :eval nil :tangle man/count.rows.Rd
:   \name{count.rows}
:   \alias{count.rows}
:   \title{ Count \code{data.frame} rows }
:   \description{ Counts the unique rows of a \code{data.frame} }
:   \usage{ count.rows(x) }
:   \arguments{
:     \item{x}{
:       Just a \code{data.frame} or \code{matrix}
:     }
:   }
:   \details{
:     Basically, this function tries to be smart about counting
:     rows. It relies on the \code{\link{order}} function and basic logic to
:     do the heavy lifting.  
:   }
:   \value{
:     A \code{data.frame} with a column named \code{counts}, all the olumns
:     of \code{x} and the rows that would appear in \code{unique( x )}. 
:   }
:   \author{
:     Charles C. Berry \email{ccberry@ucsd.tajo.edu }
:   }
:   \examples{
:   hec.frame &lt;- as.data.frame( HairEyeColor )
:   hec.frame &lt;-
:     hec.frame[ rep(1:nrow(hec.frame), hec.frame$Freq ), ]
:   hec.counts &lt;- count.rows( hec.frame )
:   all.equal( hec.counts$counts, hec.counts$Freq )
:   hec.counts
:   
:   }
:    \keyword{ manip }
: #+end_src 
</span>
<span class="org-superstar-leading">***</span><span class="org-level-4"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-4"> countRows-package
</span>
<span class="org-block-begin-line">#+begin_src Rd :eval nil :tangle man/countRows-package.Rd
</span>  \name{countRows-package}
  \alias{countRows-package}
  \alias{countRows}
  \docType{package}
  \title{Count \code{data.frame} rows }
  \description{  Counts the unique rows of a \code{data.frame} }
  \details{
  \tabular{ll}{
  Package: \tab countRows\cr
  Type: \tab Package\cr
  Version: \tab 1.0\cr
  Date: \tab 2010-12-08\cr
  License: \tab GPL-3\cr
  LazyLoad: \tab yes\cr
  }
  
  There is only one function in this package, \code{count.rows} and it
  does what it says.
  }
  \author{
  Charles C. Berry \email{cberry@ucsd.tajo.edu}
  }
  \keyword{ package }
<span class="org-block-end-line">#+end_src
</span>
<span class="org-code">: #+begin_src Rd :eval nil :tangle man/countRows-package.Rd
:   \name{countRows-package}
:   \alias{countRows-package}
:   \alias{countRows}
:   \docType{package}
:   \title{Count \code{data.frame} rows }
:   \description{  Counts the unique rows of a \code{data.frame} }
:   \details{
:   \tabular{ll}{
:   Package: \tab countRows\cr
:   Type: \tab Package\cr
:   Version: \tab 1.0\cr
:   Date: \tab 2010-12-08\cr
:   License: \tab GPL-3\cr
:   LazyLoad: \tab yes\cr
:   }
:   
:   There is only one function in this package, \code{count.rows} and it
:   does what it says.
:   }
:   \author{
:   Charles C. Berry \email{cberry@ucsd.tajo.edu}
:   }
:   \keyword{ package }
: #+end_src 
</span>
<span class="org-superstar-leading">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> Tests and Tryouts
</span>
<span class="org-list-dt">-</span> As part of developing a package one must try out some code and
  perhaps develop some tests to be sure it does what it is supposed to
  do.
<span class="org-list-dt">-</span> Here is an easy-to-read tryout of the <span class="org-verbatim">count.rows</span> function:
<span class="org-list-dt">-</span> You may need to edit or delete the <span class="org-verbatim">.libPaths</span> call to suit your
  setup

<span class="org-code">: #+begin_src R :session :results output :exports both
:  .libPaths( new = "./Rlib")
:   require( countRows ) 
:   simple.df &lt;- data.frame( diag(1:4), row.names=letters[ 1:4 ])
:   repeated.df &lt;- simple.df[ rep( 1:4, 4:1 ), ]
:   simple.df
:   count.rows( repeated.df )  
: #+end_src
</span>
<span class="org-block-begin-line">#+begin_src R :session :results output :exports results
</span>  .libPaths( new = "./Rlib")
  require( countRows ) 
  simple.df &lt;- data.frame( diag(1:4), row.names=letters[ 1:4 ])
  repeated.df &lt;- simple.df[ rep( 1:4, 4:1 ), ]
  simple.df
  count.rows( repeated.df )  
<span class="org-block-end-line">#+end_src
</span>
<span class="org-meta-line">#+results:</span>
<span class="org-block-begin-line">#+begin_example
</span><span class="custom">Loading required package: countRows
  X1 X2 X3 X4
a  1  0  0  0
b  0  2  0  0
c  0  0  3  0
d  0  0  0  4
  counts X1 X2 X3 X4
d      1  0  0  0  4
c      2  0  0  3  0
b      3  0  2  0  0
a      4  1  0  0  0
</span><span class="org-block-end-line">#+end_example
</span>
<span class="org-level-1"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-1"> Version Control, Navigation, and setup tasks
</span><span class="org-superstar-leading">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> list files for convenient navigation 
</span>
<span class="org-list-dt">-</span> Use this if you do not use the <span class="org-verbatim">.org</span> document to keep the master for the
 source code
<span class="org-list-dt">-</span> It is useful when in a terminal window on a remote machine, and speedbar
  is not a good option. <span class="org-verbatim">C-u C-c C-o</span> or <span class="org-verbatim">Mouse-1</span> will open the file
  point is on.

<span class="org-block-begin-line">#+begin_src R :results output verbatim :var cwd="."
</span>  cat(paste("<span class="error"><a href="file:&quot;,list.files">file:",list.files</a></span>(cwd,".*",recursive=TRUE),sep=''),sep='\n')
<span class="org-block-end-line">#+end_src
</span>
<span class="org-code">: #+begin_src R :results output verbatim :var cwd="."
:   cat(paste("<a href="file:&quot;,list.files">file:",list.files</a>(cwd,".*",recursive=TRUE),sep=''),sep='\n')
: #+end_src
</span>
<span class="org-superstar-leading">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Speedbar navigation
</span>
<span class="org-list-dt">-</span> Use this if you do not use the <span class="org-verbatim">.org</span> document to keep the master for the
  source code
<span class="org-list-dt">-</span> Make speedbar stick to the package source directory by typing 't' in
  its frame after executing this block:

<span class="org-block-begin-line">#+begin_src emacs-lisp :results output silent
</span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="constant">require</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-quoted-quote">'</span></span><span class="org-block"><span class="constant">speedbar</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">ess-S-initialize-speedbar</span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">uncomment this line if it isn't in ~/.emacs:
</span></span><span class="org-block">  </span><span class="org-block"><span class="comment-delimiter">;; </span></span><span class="org-block"><span class="comment">(add-to-list 'auto-mode-alist '("\\.Rd\\'" . Rd-mode))
</span></span><span class="org-block">  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">speedbar-add-supported-extension </span><span class="org-block"><span class="string">".Rd"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">speedbar-add-supported-extension </span><span class="org-block"><span class="string">"NAMESPACE"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block">speedbar-add-supported-extension </span><span class="org-block"><span class="string">"DESCRIPTION"</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
  </span><span class="org-block"><span class="rainbow-delimiters-depth-1">(</span></span><span class="org-block"><span class="function-name">speedbar</span></span><span class="org-block"> </span><span class="org-block"><span class="highlight-numbers-number">1</span></span><span class="org-block"><span class="rainbow-delimiters-depth-1">)</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>


<span class="org-code">: #+begin_src emacs-lisp :results output silent
:   (require 'speedbar)
:   (ess-S-initialize-speedbar)
:   ;; uncomment this line if it isn't in ~/.emacs:
:   ;; (add-to-list 'auto-mode-alist '("\\.Rd\\'" . Rd-mode))
:   (speedbar-add-supported-extension ".Rd")
:   (speedbar-add-supported-extension "NAMESPACE")
:   (speedbar-add-supported-extension "DESCRIPTION")
:   (speedbar 1)
: #+end_src
</span>

<span class="org-superstar-leading">*</span><span class="org-level-2"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-2"> Version Control
</span>
<span class="org-list-dt">-</span> If you don't use svn, substitute the relevant version control
  command in each block in this section

<span class="org-list-dt">-</span> Each of these can be run by putting point on the headline then
  keying <span class="org-verbatim">C-c C-v C-s y</span>

<span class="org-list-dt">-</span> Possibly add --username=&lt;&gt; --password=&lt;&gt; to the svn commands

<span class="org-superstar-leading">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> svn list 
</span>
<span class="org-list-dt">-</span> Show what files are version controlled

<span class="org-block-begin-line">#+begin_src sh :results output
</span><span class="org-block">svn list --recursive 
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-code">: #+begin_src sh :results output
: svn list --recursive 
: #+end_src
</span>
<span class="org-superstar-leading">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> svn update 
</span>
<span class="org-list-dt">-</span> Use at the start of each session to sync changes from other machines

<span class="org-block-begin-line">#+begin_src sh :results output
</span><span class="org-block">svn update 
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-code">: #+begin_src sh :results output
: svn update 
: #+end_src
</span>
<span class="org-superstar-leading">**</span><span class="org-level-3"><span class="org-superstar-header-bullet">*</span></span><span class="org-level-3"> svn commit
</span>
<span class="org-list-dt">-</span> At the end of a day's work commit the changes

<span class="org-block-begin-line">#+begin_src sh :results output
</span><span class="org-block">svn commit  -m </span><span class="org-block"><span class="string">"edits"</span></span><span class="org-block">
</span><span class="org-block-end-line">#+end_src
</span>
<span class="org-code">: #+begin_src sh :results output
: svn commit  -m "edits"
: #+end_src
</span>

</pre>
  </body>
</html>
